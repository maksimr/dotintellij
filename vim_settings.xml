<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/image-editor/test/controller/image-editor-overlay.js" timestamp="1527076877705">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="132" column="0" />
        <mark key="]" line="132" column="0" />
        <mark key="^" line="82" column="43" />
        <mark key="." line="132" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/issue.js" timestamp="1527781353082">
        <mark key="'" line="177" column="0" />
      </file>
      <file name="/yt-issue-stream-comment.js" timestamp="1528121666666">
        <mark key="'" line="119" column="65" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-search-issues.js" timestamp="1527781566956">
        <mark key="'" line="21" column="20" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/test/service/edit-attachment-dialog.js" timestamp="1527076053011">
        <mark key="'" line="66" column="0" />
        <mark key="[" line="41" column="44" />
        <mark key="]" line="42" column="3" />
        <mark key="." line="42" column="3" />
        <mark key="^" line="42" column="3" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/image-editor/controller/image-editor-overlay.js" timestamp="1527076883178">
        <mark key="'" line="13" column="0" />
        <mark key="[" line="1" column="105" />
        <mark key="]" line="1" column="104" />
        <mark key="^" line="1" column="104" />
        <mark key="." line="1" column="104" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/InputField.dart" timestamp="1528233063343">
        <mark key="'" line="10" column="6" />
        <mark key="[" line="17" column="31" />
        <mark key="]" line="17" column="34" />
        <mark key="^" line="17" column="34" />
        <mark key="." line="17" column="34" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/App.dart" timestamp="1527716682887">
        <mark key="'" line="21" column="53" />
        <mark key="[" line="21" column="46" />
        <mark key="]" line="21" column="53" />
        <mark key="." line="21" column="53" />
        <mark key="^" line="21" column="53" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/javascript/extLibs/http_code.jquery.com_jquery-2.2.4.js" timestamp="1528373516724">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/LoginLogo.dart" timestamp="1527545344981">
        <mark key="'" line="17" column="1" />
        <mark key="[" line="0" column="15" />
        <mark key="]" line="0" column="21" />
        <mark key="^" line="0" column="21" />
        <mark key="." line="0" column="21" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/package.json" timestamp="1528976821764">
        <mark key="'" line="67" column="29" />
        <mark key="[" line="42" column="31" />
        <mark key="]" line="42" column="32" />
        <mark key="." line="42" column="32" />
        <mark key="^" line="42" column="32" />
      </file>
      <file name="$USER_HOME$/www/dart/bar/lib/main.dart" timestamp="1528227497769">
        <mark key="'" line="21" column="39" />
        <mark key="[" line="15" column="25" />
        <mark key="]" line="15" column="26" />
        <mark key="^" line="15" column="25" />
        <mark key="." line="15" column="26" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-links-list/directive/yt-issue-links-list-content.js" timestamp="1527801154450">
        <mark key="'" line="77" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-priority-issue-sign.js" timestamp="1528928434022">
        <mark key="'" line="22" column="15" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-similar-issues.html" timestamp="1528923653140">
        <mark key="'" line="3" column="0" />
        <mark key="[" line="38" column="29" />
        <mark key="]" line="38" column="29" />
        <mark key="^" line="10" column="60" />
        <mark key="." line="38" column="33" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/UsersList.dart" timestamp="1528229395399">
        <mark key="'" line="41" column="0" />
        <mark key="[" line="36" column="6" />
        <mark key="]" line="36" column="5" />
        <mark key="^" line="36" column="5" />
        <mark key="." line="36" column="5" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-links-list/directive/yt-issue-links-list.js" timestamp="1527804834692">
        <mark key="'" line="257" column="2" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/test/e2e/e2e-test-utils.js" timestamp="1528116593270">
        <mark key="'" line="137" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-attachments.html" timestamp="1528119631087">
        <mark key="'" line="28" column="30" />
        <mark key="[" line="11" column="43" />
        <mark key="]" line="11" column="45" />
        <mark key="." line="11" column="45" />
        <mark key="^" line="11" column="45" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/rendering/box.dart" timestamp="1528838418071">
        <mark key="'" line="1816" column="7" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-vote.html" timestamp="1527692269047">
        <mark key="'" line="17" column="3" />
        <mark key="[" line="6" column="20" />
        <mark key="]" line="6" column="18" />
        <mark key="^" line="6" column="18" />
        <mark key="." line="6" column="18" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/loader/test/directive/yt-loader.js" timestamp="1526980793140">
        <mark key="'" line="37" column="2" />
        <mark key="[" line="42" column="25" />
        <mark key="]" line="42" column="30" />
        <mark key="^" line="42" column="30" />
        <mark key="." line="42" column="30" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/scroll/test/service/yt-scroll.js" timestamp="1527165934194">
        <mark key="'" line="6" column="0" />
        <mark key="[" line="42" column="15" />
        <mark key="]" line="42" column="18" />
        <mark key="^" line="42" column="18" />
        <mark key="." line="42" column="18" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issues-more-actions.html" timestamp="1527761129642">
        <mark key="'" line="7" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/auth/auth.js" timestamp="1528893127076">
        <mark key="'" line="527" column="13" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/keyboard-list-navigator/test/service/yt-navigation.js" timestamp="1527498750773">
        <mark key="'" line="15" column="14" />
        <mark key="[" line="0" column="10" />
        <mark key="]" line="0" column="21" />
        <mark key="." line="0" column="21" />
        <mark key="^" line="0" column="21" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/header/directive/yt-header-navigation-menu.js" timestamp="1527517194782">
        <mark key="'" line="105" column="12" />
        <mark key="[" line="87" column="25" />
        <mark key="]" line="88" column="18" />
        <mark key="." line="88" column="18" />
        <mark key="^" line="88" column="18" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-summary.html" timestamp="1527689415213">
        <mark key="'" line="3" column="1" />
        <mark key="[" line="5" column="33" />
        <mark key="]" line="5" column="38" />
        <mark key="^" line="5" column="38" />
        <mark key="." line="5" column="38" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/template/yt-drafts-dropdown.html" timestamp="1527794846568">
        <mark key="'" line="92" column="45" />
        <mark key="[" line="41" column="44" />
        <mark key="]" line="41" column="68" />
        <mark key="." line="41" column="44" />
        <mark key="^" line="41" column="64" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/LoginHint.dart" timestamp="1527545489539">
        <mark key="'" line="14" column="0" />
        <mark key="[" line="41" column="8" />
        <mark key="]" line="41" column="11" />
        <mark key="^" line="41" column="11" />
        <mark key="." line="41" column="11" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/directive/yt-code-editor.js" timestamp="1528976826804">
        <mark key="'" line="165" column="0" />
        <mark key="[" line="48" column="0" />
        <mark key="]" line="48" column="0" />
        <mark key="." line="48" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/ring-ui/components/island/content.js" timestamp="1528970824239">
        <mark key="'" line="121" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/sticky/test/sticky-panel.js" timestamp="1527155419011">
        <mark key="'" line="5" column="0" />
        <mark key="[" line="7" column="27" />
        <mark key="]" line="7" column="53" />
        <mark key="." line="7" column="27" />
        <mark key="^" line="0" column="15" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/test/controller/new-issue.js" timestamp="1528283868991">
        <mark key="'" line="536" column="14" />
        <mark key="[" line="536" column="31" />
        <mark key="]" line="536" column="54" />
        <mark key="." line="536" column="54" />
        <mark key="^" line="536" column="54" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/controller/issue.js" timestamp="1527521550507">
        <mark key="'" line="259" column="22" />
        <mark key="[" line="259" column="16" />
        <mark key="]" line="259" column="22" />
        <mark key="." line="259" column="22" />
        <mark key="^" line="259" column="22" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/comment/directive/yt-add-comment.js" timestamp="1527077550036">
        <mark key="'" line="359" column="2" />
        <mark key="[" line="44" column="36" />
        <mark key="]" line="47" column="59" />
        <mark key="." line="47" column="59" />
        <mark key="^" line="47" column="59" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/admin/template/mail-box/rule-form.html" timestamp="1527678766844">
        <mark key="'" line="66" column="6" />
        <mark key="[" line="67" column="0" />
        <mark key="]" line="67" column="0" />
        <mark key="." line="67" column="0" />
        <mark key="^" line="66" column="27" />
      </file>
      <file name="$USER_HOME$/www/js/foo/src/caretPosition.js" timestamp="1528367589828">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="72" column="0" />
        <mark key="." line="59" column="17" />
        <mark key="^" line="59" column="17" />
      </file>
      <file name="$USER_HOME$/www/dart/hn_app/lib/main.dart" timestamp="1527627784009">
        <mark key="'" line="49" column="0" />
        <mark key="[" line="41" column="15" />
        <mark key="]" line="41" column="20" />
        <mark key="^" line="41" column="19" />
        <mark key="." line="41" column="20" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/ring-ui/components/title-ng/title-ng.js" timestamp="1527263429537">
        <mark key="'" line="82" column="52" />
        <mark key="[" line="114" column="50" />
        <mark key="]" line="114" column="50" />
        <mark key="^" line="114" column="50" />
        <mark key="." line="114" column="50" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/agile-board/controller/agile-board.js" timestamp="1528204829298">
        <mark key="'" line="1284" column="10" />
        <mark key="[" line="1805" column="18" />
        <mark key="]" line="1805" column="24" />
        <mark key="." line="1805" column="24" />
        <mark key="^" line="1805" column="24" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/mention/service/mention-helper.js" timestamp="1528301834149">
        <mark key="'" line="74" column="27" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/main.dart" timestamp="1528931389916">
        <mark key="'" line="4" column="0" />
        <mark key="[" line="68" column="0" />
        <mark key="]" line="68" column="0" />
        <mark key="^" line="67" column="43" />
        <mark key="." line="68" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/styles/yt-code-editor.scss" timestamp="1528975984374">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="4" column="19" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/sticky/sticky.js" timestamp="1527155416008">
        <mark key="'" line="74" column="0" />
        <mark key="[" line="0" column="33" />
        <mark key="]" line="0" column="58" />
        <mark key="." line="4" column="0" />
        <mark key="^" line="1" column="33" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/App.dart" timestamp="1527630559645">
        <mark key="'" line="2" column="31" />
        <mark key="[" line="10" column="27" />
        <mark key="]" line="10" column="26" />
        <mark key="^" line="10" column="26" />
        <mark key="." line="10" column="26" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" timestamp="1528971460398">
        <mark key="'" line="145" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="95" column="19" />
        <mark key="^" line="95" column="19" />
        <mark key="." line="95" column="19" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/custom-fields/custom-fields.js" timestamp="1528921714678">
        <mark key="'" line="2" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/navigation.js" timestamp="1528205834516">
        <mark key="'" line="6" column="7" />
        <mark key="[" line="24" column="11" />
        <mark key="]" line="24" column="17" />
        <mark key="." line="24" column="17" />
        <mark key="^" line="24" column="17" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/profile/service/show-user-profile-card-tooltip.js" timestamp="1528547799386">
        <mark key="'" line="45" column="48" />
        <mark key="[" line="45" column="45" />
        <mark key="]" line="45" column="48" />
        <mark key="." line="45" column="48" />
        <mark key="^" line="45" column="48" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/service/create-issue-event-source.js" timestamp="1528892898622">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/Users.dart" timestamp="1527416283335">
        <mark key="'" line="1" column="24" />
        <mark key="[" line="39" column="0" />
        <mark key="]" line="50" column="8" />
        <mark key="^" line="58" column="38" />
        <mark key="." line="4" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/test/service/issue-attachment.js" timestamp="1527074420260">
        <mark key="'" line="238" column="31" />
        <mark key="[" line="243" column="70" />
        <mark key="]" line="243" column="73" />
        <mark key="." line="243" column="73" />
        <mark key="^" line="243" column="73" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/template/yt-draft-issue-toolbar.html" timestamp="1527590856959">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="45" column="26" />
        <mark key="]" line="45" column="36" />
        <mark key="^" line="45" column="25" />
        <mark key="." line="45" column="26" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/resources/test/service/request-pool.js" timestamp="1527598731260">
        <mark key="'" line="7" column="0" />
        <mark key="[" line="41" column="0" />
        <mark key="]" line="41" column="20" />
        <mark key="." line="41" column="0" />
        <mark key="^" line="37" column="19" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/Carousel.dart" timestamp="1528228068847">
        <mark key="'" line="7" column="2" />
        <mark key="[" line="87" column="68" />
        <mark key="]" line="87" column="75" />
        <mark key="^" line="87" column="75" />
        <mark key="." line="87" column="75" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-webdriver-tests/src/test/kotlin/jetbrains/youtrack/webdriver/dashboard/DashboardTest.kt" timestamp="1528110838035">
        <mark key="'" line="63" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/styles/app.scss" timestamp="1528207595245">
        <mark key="'" line="429" column="0" />
        <mark key="[" line="430" column="3" />
        <mark key="]" line="430" column="9" />
        <mark key="." line="430" column="9" />
        <mark key="^" line="430" column="9" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/projects/test/controller/projects.js" timestamp="1527517689033">
        <mark key="'" line="52" column="1" />
        <mark key="[" line="52" column="3" />
        <mark key="]" line="52" column="1" />
        <mark key="^" line="52" column="1" />
        <mark key="." line="52" column="1" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/q/q.dart" timestamp="1527116147362">
        <mark key="'" line="4" column="0" />
        <mark key="[" line="5" column="30" />
        <mark key="]" line="5" column="30" />
        <mark key="." line="5" column="30" />
        <mark key="^" line="5" column="30" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/service/image-editor-overlay.js" timestamp="1526989880185">
        <mark key="'" line="11" column="14" />
        <mark key="[" line="4" column="0" />
        <mark key="]" line="4" column="0" />
        <mark key="^" line="3" column="4" />
        <mark key="." line="4" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.js" timestamp="1528977312877">
        <mark key="'" line="33344" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="8" column="15" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/UsersSearch.dart" timestamp="1527542963425">
        <mark key="'" line="87" column="0" />
        <mark key="[" line="21" column="0" />
        <mark key="]" line="21" column="0" />
        <mark key="." line="21" column="0" />
        <mark key="^" line="25" column="47" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/resources/service/issue-resource.js" timestamp="1528928409302">
        <mark key="'" line="366" column="10" />
        <mark key="[" line="104" column="0" />
        <mark key="]" line="104" column="19" />
        <mark key="." line="366" column="56" />
        <mark key="^" line="366" column="56" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/blankshield/blankshield.js" timestamp="1527865349782">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/material/colors.dart" timestamp="1528924066278">
        <mark key="'" line="1721" column="10" />
        <mark key="[" line="1741" column="0" />
        <mark key="]" line="1754" column="5" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-links-list/template/issue-linking-dialog.html" timestamp="1527804017715">
        <mark key="'" line="7" column="63" />
        <mark key="[" line="22" column="0" />
        <mark key="]" line="28" column="23" />
        <mark key="^" line="8" column="31" />
        <mark key="." line="8" column="31" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/test/widget_test.dart" timestamp="1528491200393">
        <mark key="'" line="13" column="36" />
        <mark key="[" line="14" column="32" />
        <mark key="]" line="14" column="33" />
        <mark key="^" line="14" column="33" />
        <mark key="." line="14" column="33" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-similar-issues.js" timestamp="1527586881371">
        <mark key="'" line="4" column="14" />
        <mark key="[" line="5" column="16" />
        <mark key="]" line="5" column="16" />
        <mark key="." line="5" column="16" />
        <mark key="^" line="5" column="16" />
      </file>
      <file name="$USER_HOME$/www/js/foo/src/index.js" timestamp="1528364539910">
        <mark key="'" line="2" column="0" />
        <mark key="[" line="2" column="9" />
        <mark key="]" line="2" column="14" />
        <mark key="." line="2" column="14" />
        <mark key="^" line="2" column="14" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/shortcuts/service/yt-shortcuts.js" timestamp="1528204850207">
        <mark key="'" line="19" column="13" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/issue.js" timestamp="1528283910790">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="10" column="0" />
        <mark key="]" line="10" column="71" />
        <mark key="^" line="214" column="36" />
        <mark key="." line="214" column="36" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/collapsible/directive/yt-collapsible.js" timestamp="1527679716630">
        <mark key="'" line="13" column="5" />
        <mark key="[" line="11" column="8" />
        <mark key="]" line="11" column="15" />
        <mark key="." line="7" column="33" />
        <mark key="^" line="7" column="31" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/main.dart" timestamp="1528230833829">
        <mark key="'" line="14" column="21" />
        <mark key="[" line="29" column="44" />
        <mark key="]" line="29" column="51" />
        <mark key="." line="29" column="51" />
        <mark key="^" line="29" column="51" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields.scss" timestamp="1528924302480">
        <mark key="'" line="32" column="15" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/collapsible/template/yt-collapsible.html" timestamp="1527699399590">
        <mark key="'" line="17" column="0" />
        <mark key="[" line="19" column="10" />
        <mark key="]" line="19" column="11" />
        <mark key="." line="19" column="11" />
        <mark key="^" line="19" column="11" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/service/edit-attachment-dialog.js" timestamp="1527075388175">
        <mark key="'" line="13" column="24" />
        <mark key="[" line="10" column="44" />
        <mark key="]" line="10" column="47" />
        <mark key="." line="10" column="47" />
        <mark key="^" line="10" column="47" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/widgets/scroll_view.dart" timestamp="1528225731814">
        <mark key="'" line="577" column="6" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/issue-menu-create-button.html" timestamp="1528546612551">
        <mark key="'" line="24" column="0" />
        <mark key="[" line="3" column="15" />
        <mark key="]" line="3" column="15" />
        <mark key="." line="3" column="15" />
        <mark key="^" line="3" column="68" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/material/animated_icons/animated_icons.dart" timestamp="1527888500715">
        <mark key="'" line="298" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/README.md" timestamp="1527605363996">
        <mark key="'" line="40" column="4" />
        <mark key="[" line="278" column="5" />
        <mark key="]" line="278" column="103" />
        <mark key="^" line="279" column="50" />
        <mark key="." line="279" column="50" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/ring-ui/components/user-agreement/user-agreement.js" timestamp="1528218440075">
        <mark key="'" line="45" column="2" />
      </file>
      <file name="$USER_HOME$/www/js/foo/src/index.css" timestamp="1528363615965">
        <mark key="'" line="50" column="9" />
        <mark key="[" line="37" column="0" />
        <mark key="]" line="37" column="0" />
        <mark key="^" line="31" column="9" />
        <mark key="." line="37" column="0" />
      </file>
      <file name="$USER_HOME$/www/js/foo/src/main.js" timestamp="1528393106572">
        <mark key="'" line="49" column="0" />
        <mark key="[" line="69" column="79" />
        <mark key="]" line="69" column="79" />
        <mark key="." line="69" column="86" />
        <mark key="^" line="69" column="59" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/painting/image_cache.dart" timestamp="1528722455559">
        <mark key="'" line="27" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/mention/directive/yt-mention.js" timestamp="1528301428802">
        <mark key="'" line="251" column="28" />
        <mark key="[" line="258" column="0" />
        <mark key="]" line="259" column="65" />
        <mark key="^" line="425" column="30" />
        <mark key="." line="415" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/LinkTextSpan.dart" timestamp="1527112301831">
        <mark key="'" line="8" column="22" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="48" />
        <mark key="^" line="14" column="1" />
        <mark key="." line="14" column="1" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/reports/_reports/_color-coding.scss" timestamp="1528923708290">
        <mark key="'" line="77" column="10" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" timestamp="1528971953251">
        <mark key="'" line="3636" column="41" />
      </file>
      <file name="$USER_HOME$/.pub-cache/hosted/pub.dartlang.org/rxdart-0.17.0/lib/streams.dart" timestamp="1528715571868">
        <mark key="'" line="9" column="40" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/markup/directive/yt-markup.js" timestamp="1527887510337">
        <mark key="'" line="245" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/icon/icon.js" timestamp="1526981676217">
        <mark key="'" line="65" column="0" />
        <mark key="[" line="21" column="0" />
        <mark key="]" line="22" column="4" />
        <mark key="^" line="19" column="1" />
        <mark key="." line="19" column="1" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/template/issue.html" timestamp="1527170101008">
        <mark key="'" line="7" column="2" />
        <mark key="[" line="1" column="39" />
        <mark key="]" line="1" column="40" />
        <mark key="." line="1" column="40" />
        <mark key="^" line="1" column="40" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/feature-flags/service/feature-flags-initializer.js" timestamp="1527778345052">
        <mark key="'" line="87" column="20" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/template/edit-attachment-dialog.html" timestamp="1527075439703">
        <mark key="'" line="21" column="16" />
        <mark key="[" line="23" column="28" />
        <mark key="]" line="23" column="28" />
        <mark key="." line="23" column="28" />
        <mark key="^" line="23" column="28" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/CurrentUserDrawer.dart" timestamp="1527280315566">
        <mark key="'" line="39" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="32" column="17" />
        <mark key="." line="12" column="13" />
        <mark key="^" line="12" column="13" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/prettify/prettify.js" timestamp="1527872592243">
        <mark key="'" line="7" column="11" />
        <mark key="[" line="7" column="117" />
        <mark key="]" line="7" column="116" />
        <mark key="." line="7" column="116" />
        <mark key="^" line="7" column="116" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/UserAvatar.dart" timestamp="1528229202734">
        <mark key="'" line="18" column="1" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="^" line="18" column="1" />
        <mark key="." line="2" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-application/src/main/kotlin/jetbrains/charisma/persistent/issue/IssueWatchers.kt" timestamp="1528879299515">
        <mark key="'" line="24" column="16" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-common/style/yt-issue.scss" timestamp="1527807816153">
        <mark key="'" line="50" column="16" />
        <mark key="[" line="84" column="18" />
        <mark key="]" line="84" column="19" />
        <mark key="^" line="50" column="5" />
        <mark key="." line="84" column="19" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/user/service/get-current-user.js" timestamp="1528112097669">
        <mark key="'" line="6" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/icon/test/icon.js" timestamp="1526981351387">
        <mark key="'" line="6" column="0" />
        <mark key="[" line="12" column="0" />
        <mark key="]" line="12" column="0" />
        <mark key="." line="12" column="0" />
        <mark key="^" line="26" column="29" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/admin/template/teamcity-integration/branch-settings.html" timestamp="1527678646903">
        <mark key="'" line="68" column="31" />
        <mark key="[" line="6" column="6" />
        <mark key="]" line="6" column="25" />
        <mark key="." line="6" column="25" />
        <mark key="^" line="6" column="25" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/sticky/style/yt-sticky.scss" timestamp="1528975979304">
        <mark key="'" line="33" column="0" />
        <mark key="[" line="10" column="0" />
        <mark key="]" line="11" column="20" />
        <mark key="." line="8" column="25" />
        <mark key="^" line="8" column="25" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/ring-ui/components/title-ng/title-ng.test.js" timestamp="1528218357384">
        <mark key="'" line="17" column="15" />
        <mark key="[" line="7" column="8" />
        <mark key="]" line="7" column="7" />
        <mark key="." line="7" column="7" />
        <mark key="^" line="7" column="7" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-webdriver-tests/src/test/kotlin/jetbrains/youtrack/webdriver/newIssue/NewIssueTest.kt" timestamp="1528881642077">
        <mark key="'" line="251" column="40" />
        <mark key="[" line="138" column="0" />
        <mark key="]" line="138" column="36" />
        <mark key="." line="138" column="35" />
        <mark key="^" line="138" column="35" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-view.html" timestamp="1527256123514">
        <mark key="'" line="10" column="53" />
        <mark key="[" line="8" column="55" />
        <mark key="]" line="8" column="73" />
        <mark key="." line="8" column="73" />
        <mark key="^" line="8" column="73" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/lang.dart" timestamp="1527026032202">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="19" column="9" />
        <mark key="]" line="19" column="27" />
        <mark key="." line="19" column="60" />
        <mark key="^" line="19" column="60" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/bin/cache/pkg/sky_engine/lib/async/stream_controller.dart" timestamp="1528408626132">
        <mark key="'" line="414" column="16" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/screens/Connect.dart" timestamp="1528233110549">
        <mark key="'" line="85" column="23" />
        <mark key="[" line="77" column="0" />
        <mark key="]" line="77" column="42" />
        <mark key="." line="77" column="0" />
        <mark key="^" line="134" column="40" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/admin/service/workflows/workflow-editing.js" timestamp="1528971560109">
        <mark key="'" line="183" column="2" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/projects/template/projects.html" timestamp="1527857090941">
        <mark key="'" line="12" column="4" />
        <mark key="[" line="14" column="7" />
        <mark key="]" line="14" column="8" />
        <mark key="^" line="18" column="6" />
        <mark key="." line="14" column="8" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/dialog/dialog.js" timestamp="1526986714040">
        <mark key="'" line="0" column="53" />
        <mark key="[" line="4" column="51" />
        <mark key="]" line="4" column="59" />
        <mark key="." line="4" column="59" />
        <mark key="^" line="4" column="59" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/sticky/directive/yt-sticky.js" timestamp="1527789683773">
        <mark key="'" line="8" column="19" />
        <mark key="[" line="9" column="8" />
        <mark key="]" line="9" column="8" />
        <mark key="." line="9" column="8" />
        <mark key="^" line="9" column="8" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/template/new-issue.html" timestamp="1528283747581">
        <mark key="'" line="73" column="36" />
        <mark key="[" line="84" column="74" />
        <mark key="]" line="84" column="74" />
        <mark key="." line="84" column="74" />
        <mark key="^" line="84" column="74" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/event/directive/yt-event-delete-issue.js" timestamp="1527795078836">
        <mark key="'" line="1" column="72" />
        <mark key="[" line="16" column="0" />
        <mark key="]" line="16" column="0" />
        <mark key="^" line="29" column="44" />
        <mark key="." line="16" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-links-list/template/yt-issue-links-toolbar.html" timestamp="1527805004789">
        <mark key="'" line="33" column="31" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/markup/markup.js" timestamp="1528283915507">
        <mark key="'" line="14" column="30" />
        <mark key="[" line="1" column="0" />
        <mark key="]" line="1" column="71" />
        <mark key="^" line="4" column="30" />
        <mark key="." line="1" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/markup/test/directive/yt-markup.js" timestamp="1527870051232">
        <mark key="'" line="29" column="7" />
        <mark key="[" line="38" column="26" />
        <mark key="]" line="39" column="27" />
        <mark key="^" line="39" column="27" />
        <mark key="." line="39" column="27" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/image-tool/directive/yt-image-tool.js" timestamp="1526997573765">
        <mark key="'" line="152" column="2" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="64" column="0" />
        <mark key="^" line="64" column="32" />
        <mark key="." line="64" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/comment/test/directive/yt-add-comment.js" timestamp="1527077312197">
        <mark key="'" line="292" column="0" />
        <mark key="[" line="206" column="0" />
        <mark key="]" line="206" column="0" />
        <mark key="." line="206" column="0" />
        <mark key="^" line="206" column="43" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/oauth.js" timestamp="1528919773845">
        <mark key="'" line="52" column="7" />
        <mark key="[" line="53" column="38" />
        <mark key="]" line="53" column="54" />
        <mark key="^" line="53" column="54" />
        <mark key="." line="53" column="54" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/styles/variables.scss" timestamp="1528972713287" />
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/directive/yt-navigation-item.js" timestamp="1528295590799">
        <mark key="'" line="0" column="47" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="1" column="34" />
        <mark key="." line="40" column="64" />
        <mark key="^" line="40" column="64" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/service/keyboard-list-navigator.js" timestamp="1527801100725">
        <mark key="'" line="11" column="11" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-attachments.js" timestamp="1528119581145">
        <mark key="'" line="88" column="2" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/directive/yt-navigation-zone.js" timestamp="1528208690480">
        <mark key="'" line="15" column="22" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="18" />
        <mark key="." line="24" column="18" />
        <mark key="^" line="24" column="18" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/collapsible/test/directive/yt-collapsible.js" timestamp="1527699596151">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="53" column="41" />
        <mark key="]" line="53" column="40" />
        <mark key="." line="53" column="40" />
        <mark key="^" line="53" column="40" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/UsersList.dart" timestamp="1527415588210">
        <mark key="'" line="36" column="0" />
        <mark key="[" line="31" column="3" />
        <mark key="]" line="32" column="1" />
        <mark key="." line="32" column="1" />
        <mark key="^" line="32" column="1" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/image-editor/test/image-editor.js" timestamp="1526982837950">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="9" column="2" />
        <mark key="." line="5" column="0" />
        <mark key="^" line="7" column="51" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/utils/service/yt-utils.js" timestamp="1528883996429">
        <mark key="'" line="39" column="8" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-vote.js" timestamp="1527692498083">
        <mark key="'" line="11" column="6" />
        <mark key="[" line="45" column="45" />
        <mark key="]" line="46" column="7" />
        <mark key="." line="46" column="7" />
        <mark key="^" line="46" column="7" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/service/issue-attachment.js" timestamp="1527595926130">
        <mark key="'" line="58" column="15" />
        <mark key="[" line="151" column="81" />
        <mark key="]" line="151" column="89" />
        <mark key="^" line="350" column="26" />
        <mark key="." line="349" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/index.html" timestamp="1527249243669">
        <mark key="'" line="11" column="35" />
        <mark key="[" line="11" column="85" />
        <mark key="]" line="11" column="83" />
        <mark key="^" line="11" column="83" />
        <mark key="." line="11" column="83" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/projects/test/projects.js" timestamp="1527516758648">
        <mark key="'" line="58" column="10" />
        <mark key="[" line="57" column="4" />
        <mark key="]" line="57" column="4" />
        <mark key="^" line="57" column="4" />
        <mark key="." line="57" column="4" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-fields-panel.html" timestamp="1528207040870">
        <mark key="'" line="99" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/global/global.scss" timestamp="1528970894239">
        <mark key="'" line="21" column="13" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/material/circle_avatar.dart" timestamp="1527413499979">
        <mark key="'" line="101" column="0" />
        <mark key="[" line="184" column="24" />
        <mark key="]" line="184" column="32" />
        <mark key="." line="184" column="32" />
        <mark key="^" line="184" column="32" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/test/service/yt-navigation.js" timestamp="1527767223751">
        <mark key="'" line="200" column="0" />
        <mark key="[" line="23" column="0" />
        <mark key="]" line="25" column="7" />
        <mark key="." line="71" column="10" />
        <mark key="^" line="71" column="10" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue-links-list/template/yt-issue-links-list-content.html" timestamp="1527804777637">
        <mark key="'" line="20" column="13" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/service/get-similar-issues.js" timestamp="1527597633694">
        <mark key="'" line="6" column="3" />
        <mark key="[" line="1" column="28" />
        <mark key="]" line="1" column="30" />
        <mark key="." line="1" column="30" />
        <mark key="^" line="1" column="30" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/sticky/sticky-panel.js" timestamp="1527153311835">
        <mark key="'" line="4" column="0" />
        <mark key="[" line="0" column="59" />
        <mark key="]" line="0" column="58" />
        <mark key="." line="0" column="58" />
        <mark key="^" line="0" column="58" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/auth-ng/auth-ng.js" timestamp="1528893169972">
        <mark key="'" line="137" column="6" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/controller/edit-attachment-dialog.js" timestamp="1527072655082">
        <mark key="'" line="12" column="25" />
        <mark key="[" line="21" column="0" />
        <mark key="]" line="21" column="0" />
        <mark key="." line="21" column="0" />
        <mark key="^" line="14" column="15" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-fields-panel.js" timestamp="1528206836188">
        <mark key="'" line="15" column="6" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/select-ng/select-ng.js" timestamp="1528283934894">
        <mark key="'" line="98" column="6" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/user-card/card.js" timestamp="1528879007912">
        <mark key="'" line="91" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields-mapping.scss" timestamp="1528929602666">
        <mark key="'" line="3" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="36" column="5" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/event/event.js" timestamp="1528295560255">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="1" column="0" />
        <mark key="]" line="18" column="4" />
        <mark key="." line="25" column="41" />
        <mark key="^" line="25" column="41" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/template/yt-attachment.html" timestamp="1526998699752">
        <mark key="'" line="45" column="21" />
        <mark key="[" line="54" column="22" />
        <mark key="]" line="54" column="21" />
        <mark key="." line="54" column="21" />
        <mark key="^" line="54" column="21" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" timestamp="1528925040286">
        <mark key="'" line="2" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="39" column="1" />
        <mark key="." line="3" column="18" />
        <mark key="^" line="3" column="18" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/test/directive/yt-similar-issues.js" timestamp="1527587338376">
        <mark key="'" line="12" column="0" />
        <mark key="[" line="0" column="1" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
        <mark key="^" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issues/template/issues.html" timestamp="1527781544588">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="10" column="15" />
        <mark key="]" line="10" column="15" />
        <mark key="." line="10" column="20" />
        <mark key="^" line="10" column="25" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/pubspec.yaml" timestamp="1527545148601">
        <mark key="'" line="2" column="0" />
        <mark key="[" line="14" column="13" />
        <mark key="]" line="14" column="19" />
        <mark key="^" line="14" column="19" />
        <mark key="." line="14" column="19" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/test/e2e/issue.spec.js" timestamp="1528116669573">
        <mark key="'" line="7" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/palette/palette.scss" timestamp="1528924310207">
        <mark key="'" line="14" column="0" />
        <mark key="[" line="8" column="25" />
        <mark key="]" line="8" column="28" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-webdriver-tests/build.gradle" timestamp="1528109100353">
        <mark key="'" line="152" column="12" />
        <mark key="[" line="224" column="16" />
        <mark key="]" line="224" column="24" />
        <mark key="." line="224" column="24" />
        <mark key="^" line="224" column="24" />
      </file>
      <file name="$USER_HOME$/www/js/foo/index.html" timestamp="1528392913804">
        <mark key="'" line="41" column="0" />
        <mark key="[" line="14" column="0" />
        <mark key="]" line="15" column="145" />
        <mark key="^" line="28" column="59" />
        <mark key="." line="28" column="59" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.min.js" timestamp="1528977331471">
        <mark key="'" line="5" column="12" />
        <mark key="[" line="5" column="0" />
        <mark key="]" line="332" column="38" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/codemirror/service/XXXCodeMirror-patch.js" timestamp="1528971928430">
        <mark key="'" line="6" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/shortcuts/service/yt-shortcuts-convert-serverside.js" timestamp="1528204949702">
        <mark key="'" line="27" column="26" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-webdriver-tests/src/main/kotlin/jetbrains/youtrack/webdriver/page/NewCreateIssuePage.kt" timestamp="1528881617695">
        <mark key="'" line="111" column="13" />
        <mark key="[" line="169" column="0" />
        <mark key="]" line="170" column="0" />
        <mark key="." line="300" column="28" />
        <mark key="^" line="300" column="28" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/widgets/form.dart" timestamp="1528224683079">
        <mark key="'" line="247" column="28" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-stream-comment.html" timestamp="1528121179025">
        <mark key="'" line="107" column="15" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/style/yt-drafts-dropdown.scss" timestamp="1527690259500">
        <mark key="'" line="25" column="8" />
        <mark key="[" line="21" column="0" />
        <mark key="]" line="23" column="6" />
        <mark key="." line="26" column="0" />
        <mark key="^" line="25" column="14" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/api/hub.dart" timestamp="1528230478836">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="25" column="9" />
        <mark key="]" line="25" column="13" />
        <mark key="." line="25" column="13" />
        <mark key="^" line="25" column="13" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/packages/flutter/lib/src/widgets/framework.dart" timestamp="1528405767158">
        <mark key="'" line="1854" column="62" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issues-more-actions.js" timestamp="1527761028891">
        <mark key="'" line="126" column="51" />
        <mark key="[" line="120" column="19" />
        <mark key="]" line="126" column="50" />
        <mark key="." line="186" column="64" />
        <mark key="^" line="186" column="64" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/scroll/service/yt-scroll.js" timestamp="1527789691121">
        <mark key="'" line="80" column="0" />
        <mark key="[" line="52" column="0" />
        <mark key="]" line="55" column="15" />
        <mark key="." line="41" column="0" />
        <mark key="^" line="41" column="21" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/attachments/attachments.js" timestamp="1527073681481">
        <mark key="'" line="35" column="35" />
        <mark key="[" line="13" column="21" />
        <mark key="]" line="13" column="26" />
        <mark key="." line="13" column="26" />
        <mark key="^" line="13" column="26" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/navigation/directive/keyboard-list-navigator.js" timestamp="1527800823062">
        <mark key="'" line="92" column="17" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/constants/color-mapping.js" timestamp="1528921845576">
        <mark key="'" line="48" column="8" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/shortcuts/service/yt-shortcuts-map.js" timestamp="1528204891192">
        <mark key="'" line="9" column="19" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/test/service/get-similar-issues.js" timestamp="1527597629279">
        <mark key="'" line="6" column="0" />
        <mark key="[" line="11" column="46" />
        <mark key="]" line="11" column="48" />
        <mark key="." line="11" column="48" />
        <mark key="^" line="11" column="48" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-similar-issues.js" timestamp="1527586360896">
        <mark key="'" line="32" column="4" />
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
        <mark key="^" line="2" column="3" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/code-editor.js" timestamp="1528971920566">
        <mark key="'" line="33" column="23" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/feature-flags/service/feature-flags.js" timestamp="1527778488039">
        <mark key="'" line="69" column="22" />
        <mark key="[" line="75" column="48" />
        <mark key="]" line="75" column="60" />
        <mark key="." line="75" column="60" />
        <mark key="^" line="75" column="60" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/multiselect-with-badges/style/multi-select-with-badges.scss" timestamp="1527067060965">
        <mark key="'" line="11" column="21" />
        <mark key="[" line="1" column="0" />
        <mark key="]" line="1" column="0" />
        <mark key="^" line="3" column="0" />
        <mark key="." line="1" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/screens/App.dart" timestamp="1528233937781">
        <mark key="'" line="3" column="0" />
        <mark key="[" line="23" column="9" />
        <mark key="]" line="23" column="7" />
        <mark key="^" line="23" column="7" />
        <mark key="." line="23" column="7" />
      </file>
      <file name="/yt-issue-feed-work-item.html" timestamp="1528123787692">
        <mark key="'" line="16" column="41" />
      </file>
      <file name="$USER_HOME$/www/dart/flutter/bin/cache/pkg/sky_engine/lib/ui/painting.dart" timestamp="1528924511809">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="79" column="27" />
        <mark key="]" line="79" column="34" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/directive/yt-color-picker.js" timestamp="1528923584038">
        <mark key="'" line="1" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-picker.scss" timestamp="1528922202044">
        <mark key="'" line="62" column="0" />
      </file>
      <file name="$USER_HOME$/www/dart/hub/lib/components/Input.dart" timestamp="1528143063477">
        <mark key="'" line="10" column="8" />
        <mark key="[" line="10" column="0" />
        <mark key="]" line="10" column="0" />
        <mark key="^" line="10" column="6" />
        <mark key="." line="10" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-toolbar.html" timestamp="1527763038875">
        <mark key="'" line="34" column="19" />
        <mark key="[" line="27" column="86" />
        <mark key="]" line="27" column="86" />
        <mark key="^" line="27" column="86" />
        <mark key="." line="27" column="86" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-body.js" timestamp="1527696901739">
        <mark key="'" line="101" column="42" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/issue/controller/new-issue.js" timestamp="1528283776018">
        <mark key="'" line="63" column="10" />
        <mark key="[" line="63" column="53" />
        <mark key="]" line="64" column="45" />
        <mark key="." line="64" column="45" />
        <mark key="^" line="64" column="45" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/profile/service/update-user-appearance-profile.js" timestamp="1527698301141">
        <mark key="'" line="18" column="45" />
        <mark key="[" line="39" column="21" />
        <mark key="]" line="39" column="46" />
        <mark key="^" line="39" column="46" />
        <mark key="." line="39" column="46" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/jshint/src/jshint.js" timestamp="1528977370653">
        <mark key="'" line="33" column="0" />
        <mark key="[" line="33" column="0" />
        <mark key="]" line="5540" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/event-source/service/yt-event-source.js" timestamp="1528892960555">
        <mark key="'" line="86" column="17" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/Provider.dart" timestamp="1527013266233">
        <mark key="'" line="54" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="8" column="0" />
        <mark key="^" line="8" column="0" />
        <mark key="." line="8" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/image-editor/service/image-editor-overlay.js" timestamp="1526993723571">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="2" column="45" />
        <mark key="]" line="2" column="48" />
        <mark key="." line="2" column="48" />
        <mark key="^" line="2" column="48" />
      </file>
      <file name="$USER_HOME$/www/dart/foo/lib/components/Connect.dart" timestamp="1528143306801">
        <mark key="'" line="70" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="12" column="70" />
        <mark key="^" line="61" column="9" />
        <mark key="." line="61" column="9" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-issue-view.js" timestamp="1527605958628">
        <mark key="'" line="218" column="60" />
        <mark key="[" line="237" column="0" />
        <mark key="]" line="239" column="10" />
        <mark key="." line="238" column="24" />
        <mark key="^" line="238" column="24" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/header/directive/yt-help-popup-container.js" timestamp="1528205131042">
        <mark key="'" line="41" column="12" />
        <mark key="[" line="19" column="0" />
        <mark key="]" line="19" column="0" />
        <mark key="^" line="18" column="9" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/template/yt-issue-stream-work-item.html" timestamp="1528191396126">
        <mark key="'" line="13" column="6" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/command-dialog/service/command-dialog.js" timestamp="1528201946602">
        <mark key="'" line="27" column="8" />
        <mark key="[" line="55" column="41" />
        <mark key="]" line="56" column="41" />
        <mark key="." line="56" column="41" />
        <mark key="^" line="56" column="41" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/prettify/lib/prettify.js" timestamp="1527865934621">
        <mark key="'" line="1511" column="67" />
        <mark key="[" line="65" column="0" />
        <mark key="]" line="66" column="0" />
        <mark key="^" line="1689" column="5" />
        <mark key="." line="1689" column="5" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/components.gradle" timestamp="1527871306219">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="25" column="18" />
        <mark key="]" line="25" column="28" />
        <mark key="^" line="25" column="28" />
        <mark key="." line="25" column="28" />
      </file>
      <file name="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" timestamp="1528971466376">
        <mark key="'" line="26" column="31" />
      </file>
    </filemarks>
    <jumps>
      <jump line="86" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="46" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="0" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="37" column="61" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="7" column="36" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="3" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="39" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="4" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="2" column="0" filename="$USER_HOME$/www/dart/foo/lib/ColorPalette.dart" />
      <jump line="3" column="38" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="58" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="97" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="114" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="116" column="18" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="78" column="4" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="91" column="25" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="39" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="122" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="14" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="5" column="7" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="75" column="59" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="0" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="132" column="35" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="49" column="54" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="53" column="20" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="35" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="130" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="133" column="35" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="23" column="37" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="88" column="17" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="93" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="76" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="134" column="31" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="94" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="74" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="52" column="25" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="142" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="27" column="10" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-priority-issue-sign.js" />
      <jump line="68" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="22" column="15" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/issue/directive/yt-priority-issue-sign.js" />
      <jump line="81" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="47" column="12" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="15" column="1" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields-mapping.scss" />
      <jump line="34" column="2" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields-mapping.scss" />
      <jump line="101" column="2" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="2" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields-mapping.scss" />
      <jump line="3" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/color-picker/style/color-fields-mapping.scss" />
      <jump line="127" column="12" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="69" column="45" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="156" column="7" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="172" column="47" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="4" column="0" filename="$USER_HOME$/www/dart/foo/lib/main.dart" />
      <jump line="5" column="5" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="86" column="13" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="80" column="22" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="78" column="7" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="67" column="13" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="61" column="22" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="59" column="7" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="48" column="15" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="42" column="24" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="40" column="9" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="32" column="15" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="25" column="24" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="24" column="35" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="58" column="24" filename="$USER_HOME$/www/jetbrains/ring-ui/components/island/content.js" />
      <jump line="120" column="0" filename="$USER_HOME$/www/jetbrains/ring-ui/components/island/content.js" />
      <jump line="21" column="13" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/@jetbrains/ring-ui/components/global/global.scss" />
      <jump line="94" column="19" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" />
      <jump line="144" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" />
      <jump line="11" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" />
      <jump line="14" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" />
      <jump line="145" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/.tmp/foo.js" />
      <jump line="26" column="31" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/theme/style/themify.scss" />
      <jump line="7" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/admin/service/workflows/workflow-editing.js" />
      <jump line="183" column="2" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/pages/admin/service/workflows/workflow-editing.js" />
      <jump line="33" column="23" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/code-editor.js" />
      <jump line="6" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/codemirror/service/XXXCodeMirror-patch.js" />
      <jump line="2" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="308" column="4" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="315" column="49" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="1746" column="62" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2317" column="14" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2320" column="28" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2498" column="19" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2558" column="18" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2651" column="18" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="2805" column="57" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="3396" column="56" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="3549" column="18" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="3636" column="41" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/codemirror/lib/codemirror.js" />
      <jump line="42" column="32" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/package.json" />
      <jump line="67" column="29" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/package.json" />
      <jump line="48" column="20" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/directive/yt-code-editor.js" />
      <jump line="165" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/app/components/code-editor/directive/yt-code-editor.js" />
      <jump line="7" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.js" />
      <jump line="8" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.js" />
      <jump line="33344" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.js" />
      <jump line="5" column="12" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/angular/angular.min.js" />
      <jump line="33" column="0" filename="$USER_HOME$/www/jetbrains/youtrack/charisma/youtrack-frontend/node_modules/jshint/src/jshint.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">dmFyIF8gICAgICAgICAgICA9IHJlcXVpcmUoImxvZGFzaCIpOwp2YXIgZXZlbnRzICAgICAgID0gcmVxdWlyZSgiZXZlbnRzIik7CnZhciB2YXJzICAgICAgICAgPSByZXF1aXJlKCIuL3ZhcnMuanMiKTsKdmFyIG1lc3NhZ2VzICAgICA9IHJlcXVpcmUoIi4vbWVzc2FnZXMuanMiKTsKdmFyIExleGVyICAgICAgICA9IHJlcXVpcmUoIi4vbGV4LmpzIikuTGV4ZXI7CnZhciByZWcgICAgICAgICAgPSByZXF1aXJlKCIuL3JlZy5qcyIpOwp2YXIgc3RhdGUgICAgICAgID0gcmVxdWlyZSgiLi9zdGF0ZS5qcyIpLnN0YXRlOwp2YXIgc3R5bGUgICAgICAgID0gcmVxdWlyZSgiLi9zdHlsZS5qcyIpOwp2YXIgb3B0aW9ucyAgICAgID0gcmVxdWlyZSgiLi9vcHRpb25zLmpzIik7CnZhciBzY29wZU1hbmFnZXIgPSByZXF1aXJlKCIuL3Njb3BlLW1hbmFnZXIuanMiKTsKCi8vIFdlIG5lZWQgdGhpcyBtb2R1bGUgaGVyZSBiZWNhdXNlIGVudmlyb25tZW50cyBzdWNoIGFzIElFIGFuZCBSaGlubwovLyBkb24ndCBuZWNlc3NhcmlsbHkgZXhwb3NlIHRoZSAnY29uc29sZScgQVBJIGFuZCBicm93c2VyaWZ5IHVzZXMKLy8gaXQgdG8gbG9nIHRoaW5ncy4gSXQncyBhIHNhZCBzdGF0ZSBvZiBhZmZhaXIsIHJlYWxseS4KdmFyIGNvbnNvbGUgPSByZXF1aXJlKCJjb25zb2xlLWJyb3dzZXJpZnkiKTsKCi8vIFdlIGJ1aWxkIHRoZSBhcHBsaWNhdGlvbiBpbnNpZGUgYSBmdW5jdGlvbiBzbyB0aGF0IHdlIHByb2R1Y2Ugb25seSBhIHNpbmdsZXRvbgovLyB2YXJpYWJsZS4gVGhhdCBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgaW1tZWRpYXRlbHksIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzCi8vIHRoZSBKU0hJTlQgZnVuY3Rpb24gaXRzZWxmLgoKdmFyIEpTSElOVCA9IChmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBhcGksIC8vIEV4dGVuc2lvbiBBUEkKCiAgICAvLyBUaGVzZSBhcmUgb3BlcmF0b3JzIHRoYXQgc2hvdWxkIG5vdCBiZSB1c2VkIHdpdGggdGhlICEgb3BlcmF0b3IuCiAgICBiYW5nID0gewogICAgICAiPCIgIDogdHJ1ZSwKICAgICAgIjw9IiA6IHRydWUsCiAgICAgICI9PSIgOiB0cnVlLAogICAgICAiPT09IjogdHJ1ZSwKICAgICAgIiE9PSI6IHRydWUsCiAgICAgICIhPSIgOiB0cnVlLAogICAgICAiPiIgIDogdHJ1ZSwKICAgICAgIj49IiA6IHRydWUsCiAgICAgICIrIiAgOiB0cnVlLAogICAgICAiLSIgIDogdHJ1ZSwKICAgICAgIioiICA6IHRydWUsCiAgICAgICIvIiAgOiB0cnVlLAogICAgICAiJSIgIDogdHJ1ZQogICAgfSwKCiAgICBkZWNsYXJlZCwgLy8gR2xvYmFscyB0aGF0IHdlcmUgZGVjbGFyZWQgdXNpbmcgLypnbG9iYWwgLi4uICovIHN5bnRheC4KCiAgICBmdW5jdGlvbmljaXR5ID0gWwogICAgICAiY2xvc3VyZSIsICJleGNlcHRpb24iLCAiZ2xvYmFsIiwgImxhYmVsIiwKICAgICAgIm91dGVyIiwgInVudXNlZCIsICJ2YXIiCiAgICBdLAoKICAgIGZ1bmN0aW9ucywgLy8gQWxsIG9mIHRoZSBmdW5jdGlvbnMKCiAgICBpbmJsb2NrLAogICAgaW5kZW50LAogICAgbG9va2FoZWFkLAogICAgbGV4LAogICAgbWVtYmVyLAogICAgbWVtYmVyc09ubHksCiAgICBwcmVkZWZpbmVkLCAgICAvLyBHbG9iYWwgdmFyaWFibGVzIGRlZmluZWQgYnkgb3B0aW9uCgogICAgc3RhY2ssCiAgICB1cmxzLAoKICAgIGV4dHJhTW9kdWxlcyA9IFtdLAogICAgZW1pdHRlciA9IG5ldyBldmVudHMuRXZlbnRFbWl0dGVyKCk7CgogIGZ1bmN0aW9uIGNoZWNrT3B0aW9uKG5hbWUsIHQpIHsKICAgIG5hbWUgPSBuYW1lLnRyaW0oKTsKCiAgICBpZiAoL15bKy1dV1xkezN9JC9nLnRlc3QobmFtZSkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgaWYgKG9wdGlvbnMudmFsaWROYW1lcy5pbmRleE9mKG5hbWUpID09PSAtMSkgewogICAgICBpZiAodC50eXBlICE9PSAianNsaW50IiAmJiAhXy5oYXMob3B0aW9ucy5yZW1vdmVkLCBuYW1lKSkgewogICAgICAgIGVycm9yKCJFMDAxIiwgdCwgbmFtZSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBpc1N0cmluZyhvYmopIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gIltvYmplY3QgU3RyaW5nXSI7CiAgfQoKICBmdW5jdGlvbiBpc0lkZW50aWZpZXIodGtuLCB2YWx1ZSkgewogICAgaWYgKCF0a24pCiAgICAgIHJldHVybiBmYWxzZTsKCiAgICBpZiAoIXRrbi5pZGVudGlmaWVyIHx8IHRrbi52YWx1ZSAhPT0gdmFsdWUpCiAgICAgIHJldHVybiBmYWxzZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQodG9rZW4pIHsKICAgIGlmICghdG9rZW4ucmVzZXJ2ZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIG1ldGEgPSB0b2tlbi5tZXRhOwoKICAgIGlmIChtZXRhICYmIG1ldGEuaXNGdXR1cmVSZXNlcnZlZFdvcmQpIHsKICAgICAgaWYgKG1ldGEubW9kdWxlT25seSAmJiAhc3RhdGUub3B0aW9uLm1vZHVsZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHN0YXRlLmluRVM1KCkpIHsKICAgICAgICAvLyBFUzMgRnV0dXJlUmVzZXJ2ZWRXb3JkIGluIGFuIEVTNSBlbnZpcm9ubWVudC4KICAgICAgICBpZiAoIW1ldGEuZXM1KSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBTb21lIEVTNSBGdXR1cmVSZXNlcnZlZFdvcmQgaWRlbnRpZmllcnMgYXJlIGFjdGl2ZSBvbmx5CiAgICAgICAgLy8gd2l0aGluIGEgc3RyaWN0IG1vZGUgZW52aXJvbm1lbnQuCiAgICAgICAgaWYgKG1ldGEuc3RyaWN0T25seSkgewogICAgICAgICAgaWYgKCFzdGF0ZS5vcHRpb24uc3RyaWN0ICYmICFzdGF0ZS5pc1N0cmljdCgpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0b2tlbi5pc1Byb3BlcnR5KSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBzdXBwbGFudChzdHIsIGRhdGEpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvXHsoW157fV0qKVx9L2csIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgdmFyIHIgPSBkYXRhW2JdOwogICAgICByZXR1cm4gdHlwZW9mIHIgPT09ICJzdHJpbmciIHx8IHR5cGVvZiByID09PSAibnVtYmVyIiA/IHIgOiBhOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBjb21iaW5lKGRlc3QsIHNyYykgewogICAgT2JqZWN0LmtleXMoc3JjKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgaWYgKF8uaGFzKEpTSElOVC5ibGFja2xpc3QsIG5hbWUpKSByZXR1cm47CiAgICAgIGRlc3RbbmFtZV0gPSBzcmNbbmFtZV07CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NlbmZvcmNlYWxsKCkgewogICAgaWYgKHN0YXRlLm9wdGlvbi5lbmZvcmNlYWxsKSB7CiAgICAgIGZvciAodmFyIGVuZm9yY2VvcHQgaW4gb3B0aW9ucy5ib29sLmVuZm9yY2luZykgewogICAgICAgIGlmIChzdGF0ZS5vcHRpb25bZW5mb3JjZW9wdF0gPT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAhb3B0aW9ucy5ub2VuZm9yY2VhbGxbZW5mb3JjZW9wdF0pIHsKICAgICAgICAgIHN0YXRlLm9wdGlvbltlbmZvcmNlb3B0XSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIHJlbGF4b3B0IGluIG9wdGlvbnMuYm9vbC5yZWxheGluZykgewogICAgICAgIGlmIChzdGF0ZS5vcHRpb25bcmVsYXhvcHRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHN0YXRlLm9wdGlvbltyZWxheG9wdF0gPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFzc3VtZSgpIHsKICAgIHZhciBiYWRFU09wdCA9IG51bGw7CiAgICBwcm9jZXNzZW5mb3JjZWFsbCgpOwoKICAgIC8qKgogICAgICogVE9ETzogUmVtb3ZlIGluIEpTSGludCAzCiAgICAgKi8KICAgIGJhZEVTT3B0ID0gc3RhdGUuaW5mZXJFc1ZlcnNpb24oKTsKICAgIGlmIChiYWRFU09wdCkgewogICAgICBxdWl0KCJFMDU5Iiwgc3RhdGUudG9rZW5zLm5leHQsICJlc3ZlcnNpb24iLCBiYWRFU09wdCk7CiAgICB9CgogICAgaWYgKHN0YXRlLmluRVM1KCkpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLmVjbWFJZGVudGlmaWVyc1s1XSk7CiAgICB9CgogICAgaWYgKHN0YXRlLmluRVM2KCkpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLmVjbWFJZGVudGlmaWVyc1s2XSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgYGluYCB0byBjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGFueSBleHBsaWNpdGx5LXNwZWNpZmllZCB2YWx1ZSBmb3IKICAgICAqIGBnbG9iYWxzdHJpY3RgIGJlY2F1c2UgYm90aCBgdHJ1ZWAgYW5kIGBmYWxzZWAgc2hvdWxkIHRyaWdnZXIgYW4gZXJyb3IuCiAgICAgKi8KICAgIGlmIChzdGF0ZS5vcHRpb24uc3RyaWN0ID09PSAiZ2xvYmFsIiAmJiAiZ2xvYmFsc3RyaWN0IiBpbiBzdGF0ZS5vcHRpb24pIHsKICAgICAgcXVpdCgiRTA1OSIsIHN0YXRlLnRva2Vucy5uZXh0LCAic3RyaWN0IiwgImdsb2JhbHN0cmljdCIpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ubW9kdWxlKSB7CiAgICAgIC8qKgogICAgICAgKiBUT0RPOiBFeHRlbmQgdGhpcyByZXN0cmljdGlvbiB0byAqYWxsKiBFUzYtc3BlY2lmaWMgb3B0aW9ucy4KICAgICAgICovCiAgICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICAgIHdhcm5pbmcoIlcxMzQiLCBzdGF0ZS50b2tlbnMubmV4dCwgIm1vZHVsZSIsIDYpOwogICAgICB9CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5jb3VjaCkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuY291Y2gpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ucXVuaXQpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLnF1bml0KTsKICAgIH0KCiAgICBpZiAoc3RhdGUub3B0aW9uLnJoaW5vKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy5yaGlubyk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5zaGVsbGpzKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy5zaGVsbGpzKTsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLm5vZGUpOwogICAgfQogICAgaWYgKHN0YXRlLm9wdGlvbi50eXBlZCkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMudHlwZWQpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ucGhhbnRvbSkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMucGhhbnRvbSk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5wcm90b3R5cGVqcykgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMucHJvdG90eXBlanMpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ubm9kZSkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMubm9kZSk7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy50eXBlZCk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5kZXZlbCkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuZGV2ZWwpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24uZG9qbykgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuZG9qbyk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5icm93c2VyKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy5icm93c2VyKTsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLnR5cGVkKTsKICAgIH0KCiAgICBpZiAoc3RhdGUub3B0aW9uLmJyb3dzZXJpZnkpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLmJyb3dzZXIpOwogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMudHlwZWQpOwogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuYnJvd3NlcmlmeSk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5ub25zdGFuZGFyZCkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMubm9uc3RhbmRhcmQpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24uamFzbWluZSkgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuamFzbWluZSk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5qcXVlcnkpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLmpxdWVyeSk7CiAgICB9CgogICAgaWYgKHN0YXRlLm9wdGlvbi5tb290b29scykgewogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMubW9vdG9vbHMpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ud29ya2VyKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy53b3JrZXIpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ud3NoKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy53c2gpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ueXVpKSB7CiAgICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy55dWkpOwogICAgfQoKICAgIGlmIChzdGF0ZS5vcHRpb24ubW9jaGEpIHsKICAgICAgY29tYmluZShwcmVkZWZpbmVkLCB2YXJzLm1vY2hhKTsKICAgIH0KICB9CgogIC8vIFByb2R1Y2UgYW4gZXJyb3Igd2FybmluZy4KICBmdW5jdGlvbiBxdWl0KGNvZGUsIHRva2VuLCBhLCBiKSB7CiAgICB2YXIgcGVyY2VudGFnZSA9IE1hdGguZmxvb3IoKHRva2VuLmxpbmUgLyBzdGF0ZS5saW5lcy5sZW5ndGgpICogMTAwKTsKICAgIHZhciBtZXNzYWdlID0gbWVzc2FnZXMuZXJyb3JzW2NvZGVdLmRlc2M7CgogICAgdmFyIGV4Y2VwdGlvbiA9IHsKICAgICAgbmFtZTogIkpTSGludEVycm9yIiwKICAgICAgbGluZTogdG9rZW4ubGluZSwKICAgICAgY2hhcmFjdGVyOiB0b2tlbi5mcm9tLAogICAgICBtZXNzYWdlOiBtZXNzYWdlICsgIiAoIiArIHBlcmNlbnRhZ2UgKyAiJSBzY2FubmVkKS4iLAogICAgICByYXc6IG1lc3NhZ2UsCiAgICAgIGNvZGU6IGNvZGUsCiAgICAgIGE6IGEsCiAgICAgIGI6IGIKICAgIH07CgogICAgZXhjZXB0aW9uLnJlYXNvbiA9IHN1cHBsYW50KG1lc3NhZ2UsIGV4Y2VwdGlvbikgKyAiICgiICsgcGVyY2VudGFnZSArCiAgICAgICIlIHNjYW5uZWQpLiI7CgogICAgdGhyb3cgZXhjZXB0aW9uOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlSWdub3JlZE1lc3NhZ2VzKCkgewogICAgdmFyIGlnbm9yZWQgPSBzdGF0ZS5pZ25vcmVkTGluZXM7CgogICAgaWYgKF8uaXNFbXB0eShpZ25vcmVkKSkgcmV0dXJuOwogICAgSlNISU5ULmVycm9ycyA9IF8ucmVqZWN0KEpTSElOVC5lcnJvcnMsIGZ1bmN0aW9uKGVycikgeyByZXR1cm4gaWdub3JlZFtlcnIubGluZV0gfSk7CiAgfQoKICBmdW5jdGlvbiB3YXJuaW5nKGNvZGUsIHQsIGEsIGIsIGMsIGQpIHsKICAgIHZhciBjaCwgbCwgdywgbXNnOwoKICAgIGlmICgvXldcZHszfSQvLnRlc3QoY29kZSkpIHsKICAgICAgaWYgKHN0YXRlLmlnbm9yZWRbY29kZV0pCiAgICAgICAgcmV0dXJuOwoKICAgICAgbXNnID0gbWVzc2FnZXMud2FybmluZ3NbY29kZV07CiAgICB9IGVsc2UgaWYgKC9FXGR7M30vLnRlc3QoY29kZSkpIHsKICAgICAgbXNnID0gbWVzc2FnZXMuZXJyb3JzW2NvZGVdOwogICAgfSBlbHNlIGlmICgvSVxkezN9Ly50ZXN0KGNvZGUpKSB7CiAgICAgIG1zZyA9IG1lc3NhZ2VzLmluZm9bY29kZV07CiAgICB9CgogICAgdCA9IHQgfHwgc3RhdGUudG9rZW5zLm5leHQgfHwge307CiAgICBpZiAodC5pZCA9PT0gIihlbmQpIikgeyAgLy8gYH4KICAgICAgdCA9IHN0YXRlLnRva2Vucy5jdXJyOwogICAgfQoKICAgIGwgPSB0LmxpbmU7CiAgICBjaCA9IHQuZnJvbTsKCiAgICB3ID0gewogICAgICBpZDogIihlcnJvcikiLAogICAgICByYXc6IG1zZy5kZXNjLAogICAgICBjb2RlOiBtc2cuY29kZSwKICAgICAgZXZpZGVuY2U6IHN0YXRlLmxpbmVzW2wgLSAxXSB8fCAiIiwKICAgICAgbGluZTogbCwKICAgICAgY2hhcmFjdGVyOiBjaCwKICAgICAgc2NvcGU6IEpTSElOVC5zY29wZSwKICAgICAgYTogYSwKICAgICAgYjogYiwKICAgICAgYzogYywKICAgICAgZDogZAogICAgfTsKCiAgICB3LnJlYXNvbiA9IHN1cHBsYW50KG1zZy5kZXNjLCB3KTsKICAgIEpTSElOVC5lcnJvcnMucHVzaCh3KTsKCiAgICByZW1vdmVJZ25vcmVkTWVzc2FnZXMoKTsKCiAgICBpZiAoSlNISU5ULmVycm9ycy5sZW5ndGggPj0gc3RhdGUub3B0aW9uLm1heGVycikKICAgICAgcXVpdCgiRTA0MyIsIHQpOwoKICAgIHJldHVybiB3OwogIH0KCiAgZnVuY3Rpb24gd2FybmluZ0F0KG0sIGwsIGNoLCBhLCBiLCBjLCBkKSB7CiAgICByZXR1cm4gd2FybmluZyhtLCB7CiAgICAgIGxpbmU6IGwsCiAgICAgIGZyb206IGNoCiAgICB9LCBhLCBiLCBjLCBkKTsKICB9CgogIGZ1bmN0aW9uIGVycm9yKG0sIHQsIGEsIGIsIGMsIGQpIHsKICAgIHdhcm5pbmcobSwgdCwgYSwgYiwgYywgZCk7CiAgfQoKICBmdW5jdGlvbiBlcnJvckF0KG0sIGwsIGNoLCBhLCBiLCBjLCBkKSB7CiAgICByZXR1cm4gZXJyb3IobSwgewogICAgICBsaW5lOiBsLAogICAgICBmcm9tOiBjaAogICAgfSwgYSwgYiwgYywgZCk7CiAgfQoKICAvLyBUcmFja2luZyBvZiAiaW50ZXJuYWwiIHNjcmlwdHMsIGxpa2UgZXZhbCBjb250YWluaW5nIGEgc3RhdGljIHN0cmluZwogIGZ1bmN0aW9uIGFkZEV2YWxDb2RlKGVsZW0sIHRva2VuKSB7CiAgICBKU0hJTlQuaW50ZXJuYWxzLnB1c2goewogICAgICBpZDogIihpbnRlcm5hbCkiLAogICAgICBlbGVtOiBlbGVtLAogICAgICB0b2tlbjogdG9rZW4sCiAgICAgIGNvZGU6IHRva2VuLnZhbHVlLnJlcGxhY2UoLyhbXlxcXSkoXFwqKVwyXFxuL2csICIkMVxuIikKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZG9PcHRpb24oKSB7CiAgICB2YXIgbnQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIHZhciBib2R5ID0gbnQuYm9keS5zcGxpdCgiLCIpLm1hcChmdW5jdGlvbihzKSB7IHJldHVybiBzLnRyaW0oKTsgfSk7CgogICAgdmFyIHByZWRlZiA9IHt9OwogICAgaWYgKG50LnR5cGUgPT09ICJnbG9iYWxzIikgewogICAgICBib2R5LmZvckVhY2goZnVuY3Rpb24oZywgaWR4KSB7CiAgICAgICAgZyA9IGcuc3BsaXQoIjoiKTsKICAgICAgICB2YXIga2V5ID0gKGdbMF0gfHwgIiIpLnRyaW0oKTsKICAgICAgICB2YXIgdmFsID0gKGdbMV0gfHwgIiIpLnRyaW0oKTsKCiAgICAgICAgaWYgKGtleSA9PT0gIi0iIHx8ICFrZXkubGVuZ3RoKSB7CiAgICAgICAgICAvLyBJZ25vcmUgdHJhaWxpbmcgY29tbWEKICAgICAgICAgIGlmIChpZHggPiAwICYmIGlkeCA9PT0gYm9keS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleS5jaGFyQXQoMCkgPT09ICItIikgewogICAgICAgICAga2V5ID0ga2V5LnNsaWNlKDEpOwogICAgICAgICAgdmFsID0gZmFsc2U7CgogICAgICAgICAgSlNISU5ULmJsYWNrbGlzdFtrZXldID0ga2V5OwogICAgICAgICAgZGVsZXRlIHByZWRlZmluZWRba2V5XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHJlZGVmW2tleV0gPSAodmFsID09PSAidHJ1ZSIpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBjb21iaW5lKHByZWRlZmluZWQsIHByZWRlZik7CgogICAgICBmb3IgKHZhciBrZXkgaW4gcHJlZGVmKSB7CiAgICAgICAgaWYgKF8uaGFzKHByZWRlZiwga2V5KSkgewogICAgICAgICAgZGVjbGFyZWRba2V5XSA9IG50OwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChudC50eXBlID09PSAiZXhwb3J0ZWQiKSB7CiAgICAgIGJvZHkuZm9yRWFjaChmdW5jdGlvbihlLCBpZHgpIHsKICAgICAgICBpZiAoIWUubGVuZ3RoKSB7CiAgICAgICAgICAvLyBJZ25vcmUgdHJhaWxpbmcgY29tbWEKICAgICAgICAgIGlmIChpZHggPiAwICYmIGlkeCA9PT0gYm9keS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRFeHBvcnRlZChlKTsKICAgICAgfSk7CiAgICB9CgogICAgaWYgKG50LnR5cGUgPT09ICJtZW1iZXJzIikgewogICAgICBtZW1iZXJzT25seSA9IG1lbWJlcnNPbmx5IHx8IHt9OwoKICAgICAgYm9keS5mb3JFYWNoKGZ1bmN0aW9uKG0pIHsKICAgICAgICB2YXIgY2gxID0gbS5jaGFyQXQoMCk7CiAgICAgICAgdmFyIGNoMiA9IG0uY2hhckF0KG0ubGVuZ3RoIC0gMSk7CgogICAgICAgIGlmIChjaDEgPT09IGNoMiAmJiAoY2gxID09PSAiXCIiIHx8IGNoMSA9PT0gIiciKSkgewogICAgICAgICAgbSA9IG0KICAgICAgICAgICAgLnN1YnN0cigxLCBtLmxlbmd0aCAtIDIpCiAgICAgICAgICAgIC5yZXBsYWNlKCJcXFwiIiwgIlwiIik7CiAgICAgICAgfQoKICAgICAgICBtZW1iZXJzT25seVttXSA9IGZhbHNlOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgbnVtdmFscyA9IFsKICAgICAgIm1heHN0YXRlbWVudHMiLAogICAgICAibWF4cGFyYW1zIiwKICAgICAgIm1heGRlcHRoIiwKICAgICAgIm1heGNvbXBsZXhpdHkiLAogICAgICAibWF4ZXJyIiwKICAgICAgIm1heGxlbiIsCiAgICAgICJpbmRlbnQiCiAgICBdOwoKICAgIGlmIChudC50eXBlID09PSAianNoaW50IiB8fCBudC50eXBlID09PSAianNsaW50IikgewogICAgICBib2R5LmZvckVhY2goZnVuY3Rpb24oZykgewogICAgICAgIGcgPSBnLnNwbGl0KCI6Iik7CiAgICAgICAgdmFyIGtleSA9IChnWzBdIHx8ICIiKS50cmltKCk7CiAgICAgICAgdmFyIHZhbCA9IChnWzFdIHx8ICIiKS50cmltKCk7CgogICAgICAgIGlmICghY2hlY2tPcHRpb24oa2V5LCBudCkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChudW12YWxzLmluZGV4T2Yoa2V5KSA+PSAwKSB7CiAgICAgICAgICAvLyBHSDk4OCAtIG51bWVyaWMgb3B0aW9ucyBjYW4gYmUgZGlzYWJsZWQgYnkgc2V0dGluZyB0aGVtIHRvIGBmYWxzZWAKICAgICAgICAgIGlmICh2YWwgIT09ICJmYWxzZSIpIHsKICAgICAgICAgICAgdmFsID0gK3ZhbDsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAibnVtYmVyIiB8fCAhaXNGaW5pdGUodmFsKSB8fCB2YWwgPD0gMCB8fCBNYXRoLmZsb29yKHZhbCkgIT09IHZhbCkgewogICAgICAgICAgICAgIGVycm9yKCJFMDMyIiwgbnQsIGdbMV0udHJpbSgpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0YXRlLm9wdGlvbltrZXldID0gdmFsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUub3B0aW9uW2tleV0gPSBrZXkgPT09ICJpbmRlbnQiID8gNCA6IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChrZXkgPT09ICJ2YWxpZHRoaXMiKSB7CiAgICAgICAgICAvLyBgdmFsaWR0aGlzYCBpcyB2YWxpZCBvbmx5IHdpdGhpbiBhIGZ1bmN0aW9uIHNjb3BlLgoKICAgICAgICAgIGlmIChzdGF0ZS5mdW5jdFsiKGdsb2JhbCkiXSkKICAgICAgICAgICAgcmV0dXJuIHZvaWQgZXJyb3IoIkUwMDkiKTsKCiAgICAgICAgICBpZiAodmFsICE9PSAidHJ1ZSIgJiYgdmFsICE9PSAiZmFsc2UiKQogICAgICAgICAgICByZXR1cm4gdm9pZCBlcnJvcigiRTAwMiIsIG50KTsKCiAgICAgICAgICBzdGF0ZS5vcHRpb24udmFsaWR0aGlzID0gKHZhbCA9PT0gInRydWUiKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChrZXkgPT09ICJxdW90bWFyayIpIHsKICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICBjYXNlICJ0cnVlIjoKICAgICAgICAgIGNhc2UgImZhbHNlIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLnF1b3RtYXJrID0gKHZhbCA9PT0gInRydWUiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJkb3VibGUiOgogICAgICAgICAgY2FzZSAic2luZ2xlIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLnF1b3RtYXJrID0gdmFsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gInNoYWRvdyIpIHsKICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICBjYXNlICJ0cnVlIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLnNoYWRvdyA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAib3V0ZXIiOgogICAgICAgICAgICBzdGF0ZS5vcHRpb24uc2hhZG93ID0gIm91dGVyIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJmYWxzZSI6CiAgICAgICAgICBjYXNlICJpbm5lciI6CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbi5zaGFkb3cgPSAiaW5uZXIiOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gInVudXNlZCIpIHsKICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICBjYXNlICJ0cnVlIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLnVudXNlZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZmFsc2UiOgogICAgICAgICAgICBzdGF0ZS5vcHRpb24udW51c2VkID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAidmFycyI6CiAgICAgICAgICBjYXNlICJzdHJpY3QiOgogICAgICAgICAgICBzdGF0ZS5vcHRpb24udW51c2VkID0gdmFsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gImxhdGVkZWYiKSB7CiAgICAgICAgICBzd2l0Y2ggKHZhbCkgewogICAgICAgICAgY2FzZSAidHJ1ZSI6CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbi5sYXRlZGVmID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJmYWxzZSI6CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbi5sYXRlZGVmID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAibm9mdW5jIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLmxhdGVkZWYgPSAibm9mdW5jIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBlcnJvcigiRTAwMiIsIG50KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChrZXkgPT09ICJpZ25vcmUiKSB7CiAgICAgICAgICBzd2l0Y2ggKHZhbCkgewogICAgICAgICAgY2FzZSAibGluZSI6CiAgICAgICAgICAgIHN0YXRlLmlnbm9yZWRMaW5lc1tudC5saW5lXSA9IHRydWU7CiAgICAgICAgICAgIHJlbW92ZUlnbm9yZWRNZXNzYWdlcygpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gInN0cmljdCIpIHsKICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICBjYXNlICJ0cnVlIjoKICAgICAgICAgICAgc3RhdGUub3B0aW9uLnN0cmljdCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZmFsc2UiOgogICAgICAgICAgICBzdGF0ZS5vcHRpb24uc3RyaWN0ID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZ2xvYmFsIjoKICAgICAgICAgIGNhc2UgImltcGxpZWQiOgogICAgICAgICAgICBzdGF0ZS5vcHRpb24uc3RyaWN0ID0gdmFsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGVycm9yKCJFMDAyIiwgbnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gIm1vZHVsZSIpIHsKICAgICAgICAgIC8qKgogICAgICAgICAgICogVE9ETzogRXh0ZW5kIHRoaXMgcmVzdHJpY3Rpb24gdG8gKmFsbCogImVudmlyb25tZW50YWwiIG9wdGlvbnMuCiAgICAgICAgICAgKi8KICAgICAgICAgIGlmICghaGFzUGFyc2VkQ29kZShzdGF0ZS5mdW5jdCkpIHsKICAgICAgICAgICAgZXJyb3IoIkUwNTUiLCBzdGF0ZS50b2tlbnMubmV4dCwgIm1vZHVsZSIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSA9PT0gImVzdmVyc2lvbiIpIHsKICAgICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICBjYXNlICIzIjoKICAgICAgICAgIGNhc2UgIjUiOgogICAgICAgICAgY2FzZSAiNiI6CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbi5tb3ogPSBmYWxzZTsKICAgICAgICAgICAgc3RhdGUub3B0aW9uLmVzdmVyc2lvbiA9ICt2YWw7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiMjAxNSI6CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbi5tb3ogPSBmYWxzZTsKICAgICAgICAgICAgc3RhdGUub3B0aW9uLmVzdmVyc2lvbiA9IDY7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgZXJyb3IoIkUwMDIiLCBudCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWhhc1BhcnNlZENvZGUoc3RhdGUuZnVuY3QpKSB7CiAgICAgICAgICAgIGVycm9yKCJFMDU1Iiwgc3RhdGUudG9rZW5zLm5leHQsICJlc3ZlcnNpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBtYXRjaCA9IC9eKFsrLV0pKFdcZHszfSkkL2cuZXhlYyhrZXkpOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgLy8gaWdub3JlIGZvciAtVy4uLiwgdW5pZ25vcmUgZm9yICtXLi4uCiAgICAgICAgICBzdGF0ZS5pZ25vcmVkW21hdGNoWzJdXSA9IChtYXRjaFsxXSA9PT0gIi0iKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0bjsKICAgICAgICBpZiAodmFsID09PSAidHJ1ZSIgfHwgdmFsID09PSAiZmFsc2UiKSB7CiAgICAgICAgICBpZiAobnQudHlwZSA9PT0gImpzbGludCIpIHsKICAgICAgICAgICAgdG4gPSBvcHRpb25zLnJlbmFtZWRba2V5XSB8fCBrZXk7CiAgICAgICAgICAgIHN0YXRlLm9wdGlvblt0bl0gPSAodmFsID09PSAidHJ1ZSIpOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW52ZXJ0ZWRbdG5dICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5vcHRpb25bdG5dID0gIXN0YXRlLm9wdGlvblt0bl07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLm9wdGlvbltrZXldID0gKHZhbCA9PT0gInRydWUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBlcnJvcigiRTAwMiIsIG50KTsKICAgICAgfSk7CgogICAgICBhc3N1bWUoKTsKICAgIH0KICB9CgogIC8vIFdlIG5lZWQgYSBwZWVrIGZ1bmN0aW9uLiBJZiBpdCBoYXMgYW4gYXJndW1lbnQsIGl0IHBlZWtzIHRoYXQgbXVjaCBmYXJ0aGVyCiAgLy8gYWhlYWQuIEl0IGlzIHVzZWQgdG8gZGlzdGluZ3Vpc2gKICAvLyAgICAgZm9yICggdmFyIGkgaW4gLi4uCiAgLy8gZnJvbQogIC8vICAgICBmb3IgKCB2YXIgaSA9IC4uLgoKICBmdW5jdGlvbiBwZWVrKHApIHsKICAgIHZhciBpID0gcCB8fCAwLCBqID0gbG9va2FoZWFkLmxlbmd0aCwgdDsKCiAgICBpZiAoaSA8IGopIHsKICAgICAgcmV0dXJuIGxvb2thaGVhZFtpXTsKICAgIH0KCiAgICB3aGlsZSAoaiA8PSBpKSB7CiAgICAgIHQgPSBsZXgudG9rZW4oKTsKCiAgICAgIC8vIFBlZWtpbmcgcGFzdCB0aGUgZW5kIG9mIHRoZSBwcm9ncmFtIHNob3VsZCBwcm9kdWNlIHRoZSAiKGVuZCkiIHRva2VuCiAgICAgIC8vIGFuZCBzaG91bGQgbm90IGV4dGVuZCB0aGUgbG9va2FoZWFkIGJ1ZmZlci4KICAgICAgaWYgKCF0ICYmIHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVuZCkiKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlLnRva2Vucy5uZXh0OwogICAgICB9CgogICAgICBsb29rYWhlYWRbal0gPSB0OwogICAgICBqICs9IDE7CiAgICB9CgogICAgcmV0dXJuIHQ7CiAgfQoKICBmdW5jdGlvbiBwZWVrSWdub3JlRU9MKCkgewogICAgdmFyIGkgPSAwOwogICAgdmFyIHQ7CiAgICBkbyB7CiAgICAgIHQgPSBwZWVrKGkrKyk7CiAgICB9IHdoaWxlICh0LmlkID09PSAiKGVuZGxpbmUpIik7CiAgICByZXR1cm4gdDsKICB9CgogIC8vIFByb2R1Y2UgdGhlIG5leHQgdG9rZW4uIEl0IGxvb2tzIGZvciBwcm9ncmFtbWluZyBlcnJvcnMuCgogIGZ1bmN0aW9uIGFkdmFuY2UoaWQsIHQpIHsKCiAgICBzd2l0Y2ggKHN0YXRlLnRva2Vucy5jdXJyLmlkKSB7CiAgICBjYXNlICIobnVtYmVyKSI6CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIi4iKSB7CiAgICAgICAgd2FybmluZygiVzAwNSIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIi0iOgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICItIiB8fCBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIi0tIikgewogICAgICAgIHdhcm5pbmcoIlcwMDYiKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIisiOgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIrIiB8fCBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIisrIikgewogICAgICAgIHdhcm5pbmcoIlcwMDciKTsKICAgICAgfQogICAgICBicmVhazsKICAgIH0KCiAgICBpZiAoaWQgJiYgc3RhdGUudG9rZW5zLm5leHQuaWQgIT09IGlkKSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVuZCkiKSB7CiAgICAgICAgICBlcnJvcigiRTAxOSIsIHQsIHQuaWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlcnJvcigiRTAyMCIsIHN0YXRlLnRva2Vucy5uZXh0LCBpZCwgdC5pZCwgdC5saW5lLCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnR5cGUgIT09ICIoaWRlbnRpZmllcikiIHx8IHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlICE9PSBpZCkgewogICAgICAgIHdhcm5pbmcoIlcxMTYiLCBzdGF0ZS50b2tlbnMubmV4dCwgaWQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgfQogICAgfQoKICAgIHN0YXRlLnRva2Vucy5wcmV2ID0gc3RhdGUudG9rZW5zLmN1cnI7CiAgICBzdGF0ZS50b2tlbnMuY3VyciA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgZm9yICg7OykgewogICAgICBzdGF0ZS50b2tlbnMubmV4dCA9IGxvb2thaGVhZC5zaGlmdCgpIHx8IGxleC50b2tlbigpOwoKICAgICAgaWYgKCFzdGF0ZS50b2tlbnMubmV4dCkgeyAvLyBObyBtb3JlIHRva2VucyBsZWZ0LCBnaXZlIHVwCiAgICAgICAgcXVpdCgiRTA0MSIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVuZCkiIHx8IHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVycm9yKSIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5jaGVjaykgewogICAgICAgIHN0YXRlLnRva2Vucy5uZXh0LmNoZWNrKCk7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pc1NwZWNpYWwpIHsKICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudHlwZSA9PT0gImZhbGxzIHRocm91Z2giKSB7CiAgICAgICAgICBzdGF0ZS50b2tlbnMuY3Vyci5jYXNlRmFsbHNUaHJvdWdoID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9PcHRpb24oKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiKGVuZGxpbmUpIikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBEZXRlcm1pbmUgd2hldGhlciBhIGdpdmVuIHRva2VuIGlzIGFuIG9wZXJhdG9yLgogICAqCiAgICogQHBhcmFtIHt0b2tlbn0gdG9rZW4KICAgKgogICAqIEByZXR1cm5zIHtib29sZWFufQogICAqLwogIGZ1bmN0aW9uIGlzT3BlcmF0b3IodG9rZW4pIHsKICAgIHJldHVybiB0b2tlbi5maXJzdCB8fCB0b2tlbi5yaWdodCB8fCB0b2tlbi5sZWZ0IHx8IHRva2VuLmlkID09PSAieWllbGQiOwogIH0KCiAgZnVuY3Rpb24gaXNFbmRPZkV4cHIoY3VyciwgbmV4dCkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgY3VyciA9IHN0YXRlLnRva2Vucy5jdXJyOwogICAgICBuZXh0ID0gc3RhdGUudG9rZW5zLm5leHQ7CiAgICB9CgogICAgaWYgKG5leHQuaWQgPT09ICI7IiB8fCBuZXh0LmlkID09PSAifSIgfHwgbmV4dC5pZCA9PT0gIjoiKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKG5leHQuaW5maXggPT09IGN1cnIuaW5maXggfHwgY3Vyci5sdEJvdW5kYXJ5ID09PSAiYWZ0ZXIiIHx8CiAgICAgIG5leHQubHRCb3VuZGFyeSA9PT0gImJlZm9yZSIpIHsKICAgICAgcmV0dXJuIGN1cnIubGluZSAhPT0gc3RhcnRMaW5lKG5leHQpOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gVGhpcyBpcyB0aGUgaGVhcnQgb2YgSlNISU5ULCB0aGUgUHJhdHQgcGFyc2VyLiBJbiBhZGRpdGlvbiB0byBwYXJzaW5nLCBpdAogIC8vIGlzIGxvb2tpbmcgZm9yIGFkIGhvYyBsaW50IHBhdHRlcm5zLiBXZSBhZGQgLmZ1ZCB0byBQcmF0dCdzIG1vZGVsLCB3aGljaCBpcwogIC8vIGxpa2UgLm51ZCBleGNlcHQgdGhhdCBpdCBpcyBvbmx5IHVzZWQgb24gdGhlIGZpcnN0IHRva2VuIG9mIGEgc3RhdGVtZW50LgogIC8vIEhhdmluZyAuZnVkIG1ha2VzIGl0IG11Y2ggZWFzaWVyIHRvIGRlZmluZSBzdGF0ZW1lbnQtb3JpZW50ZWQgbGFuZ3VhZ2VzIGxpa2UKICAvLyBKYXZhU2NyaXB0LiBJIHJldGFpbmVkIFByYXR0J3Mgbm9tZW5jbGF0dXJlLgoKICAvLyAubnVkICBOdWxsIGRlbm90YXRpb24KICAvLyAuZnVkICBGaXJzdCBudWxsIGRlbm90YXRpb24KICAvLyAubGVkICBMZWZ0IGRlbm90YXRpb24KICAvLyAgbGJwICBMZWZ0IGJpbmRpbmcgcG93ZXIKICAvLyAgcmJwICBSaWdodCBiaW5kaW5nIHBvd2VyCgogIC8vIFRoZXkgYXJlIGVsZW1lbnRzIG9mIHRoZSBwYXJzaW5nIG1ldGhvZCBjYWxsZWQgVG9wIERvd24gT3BlcmF0b3IgUHJlY2VkZW5jZS4KCiAgZnVuY3Rpb24gZXhwcmVzc2lvbihyYnAsIGluaXRpYWwpIHsKICAgIHZhciBsZWZ0LCBpc0FycmF5ID0gZmFsc2UsIGlzT2JqZWN0ID0gZmFsc2UsIGlzTGV0RXhwciA9IGZhbHNlOwoKICAgIHN0YXRlLm5hbWVTdGFjay5wdXNoKCk7CgogICAgLy8gaWYgY3VycmVudCBleHByZXNzaW9uIGlzIGEgbGV0IGV4cHJlc3Npb24KICAgIGlmICghaW5pdGlhbCAmJiBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gImxldCIgJiYgcGVlaygwKS52YWx1ZSA9PT0gIigiKSB7CiAgICAgIGlmICghc3RhdGUuaW5Nb3ooKSkgewogICAgICAgIHdhcm5pbmcoIlcxMTgiLCBzdGF0ZS50b2tlbnMubmV4dCwgImxldCBleHByZXNzaW9ucyIpOwogICAgICB9CiAgICAgIGlzTGV0RXhwciA9IHRydWU7CiAgICAgIC8vIGNyZWF0ZSBhIG5ldyBibG9jayBzY29wZSB3ZSB1c2Ugb25seSBmb3IgdGhlIGN1cnJlbnQgZXhwcmVzc2lvbgogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCk7CiAgICAgIGFkdmFuY2UoImxldCIpOwogICAgICBhZHZhbmNlKCIoIik7CiAgICAgIHN0YXRlLnRva2Vucy5wcmV2LmZ1ZCgpOwogICAgICBhZHZhbmNlKCIpIik7CiAgICB9CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVuZCkiKQogICAgICBlcnJvcigiRTAwNiIsIHN0YXRlLnRva2Vucy5jdXJyKTsKCiAgICB2YXIgaXNEYW5nZXJvdXMgPQogICAgICBzdGF0ZS5vcHRpb24uYXNpICYmCiAgICAgIHN0YXRlLnRva2Vucy5wcmV2LmxpbmUgIT09IHN0YXJ0TGluZShzdGF0ZS50b2tlbnMuY3VycikgJiYKICAgICAgXy5jb250YWlucyhbIl0iLCAiKSJdLCBzdGF0ZS50b2tlbnMucHJldi5pZCkgJiYKICAgICAgXy5jb250YWlucyhbIlsiLCAiKCJdLCBzdGF0ZS50b2tlbnMuY3Vyci5pZCk7CgogICAgaWYgKGlzRGFuZ2Vyb3VzKQogICAgICB3YXJuaW5nKCJXMDE0Iiwgc3RhdGUudG9rZW5zLmN1cnIsIHN0YXRlLnRva2Vucy5jdXJyLmlkKTsKCiAgICBhZHZhbmNlKCk7CgogICAgaWYgKGluaXRpYWwpIHsKICAgICAgc3RhdGUuZnVuY3RbIih2ZXJiKSJdID0gc3RhdGUudG9rZW5zLmN1cnIudmFsdWU7CiAgICAgIHN0YXRlLnRva2Vucy5jdXJyLmJlZ2luc1N0bXQgPSB0cnVlOwogICAgfQoKICAgIGlmIChpbml0aWFsID09PSB0cnVlICYmIHN0YXRlLnRva2Vucy5jdXJyLmZ1ZCkgewogICAgICBsZWZ0ID0gc3RhdGUudG9rZW5zLmN1cnIuZnVkKCk7CiAgICB9IGVsc2UgewogICAgICBpZiAoc3RhdGUudG9rZW5zLmN1cnIubnVkKSB7CiAgICAgICAgbGVmdCA9IHN0YXRlLnRva2Vucy5jdXJyLm51ZChyYnApOwogICAgICB9IGVsc2UgewogICAgICAgIGVycm9yKCJFMDMwIiwgc3RhdGUudG9rZW5zLmN1cnIsIHN0YXRlLnRva2Vucy5jdXJyLmlkKTsKICAgICAgfQoKICAgICAgd2hpbGUgKHJicCA8IHN0YXRlLnRva2Vucy5uZXh0LmxicCAmJiAhaXNFbmRPZkV4cHIoKSkgewogICAgICAgIGlzQXJyYXkgPSBzdGF0ZS50b2tlbnMuY3Vyci52YWx1ZSA9PT0gIkFycmF5IjsKICAgICAgICBpc09iamVjdCA9IHN0YXRlLnRva2Vucy5jdXJyLnZhbHVlID09PSAiT2JqZWN0IjsKCiAgICAgICAgLy8gIzUyNywgbmV3IEZvby5BcnJheSgpLCBGb28uQXJyYXkoKSwgbmV3IEZvby5PYmplY3QoKSwgRm9vLk9iamVjdCgpCiAgICAgICAgLy8gTGluZSBicmVha3MgaW4gSWZTdGF0ZW1lbnQgaGVhZHMgZXhpc3QgdG8gc2F0aXNmeSB0aGUgY2hlY2tKU0hpbnQKICAgICAgICAvLyAiTGluZSB0b28gbG9uZy4iIGVycm9yLgogICAgICAgIGlmIChsZWZ0ICYmIChsZWZ0LnZhbHVlIHx8IChsZWZ0LmZpcnN0ICYmIGxlZnQuZmlyc3QudmFsdWUpKSkgewogICAgICAgICAgLy8gSWYgdGhlIGxlZnQudmFsdWUgaXMgbm90ICJuZXciLCBvciB0aGUgbGVmdC5maXJzdC52YWx1ZSBpcyBhICIuIgogICAgICAgICAgLy8gdGhlbiBzYWZlbHkgYXNzdW1lIHRoYXQgdGhpcyBpcyBub3QgIm5ldyBBcnJheSgpIiBhbmQgcG9zc2libHkKICAgICAgICAgIC8vIG5vdCAibmV3IE9iamVjdCgpIi4uLgogICAgICAgICAgaWYgKGxlZnQudmFsdWUgIT09ICJuZXciIHx8CiAgICAgICAgICAgIChsZWZ0LmZpcnN0ICYmIGxlZnQuZmlyc3QudmFsdWUgJiYgbGVmdC5maXJzdC52YWx1ZSA9PT0gIi4iKSkgewogICAgICAgICAgICBpc0FycmF5ID0gZmFsc2U7CiAgICAgICAgICAgIC8vIC4uLkluIHRoZSBjYXNlIG9mIE9iamVjdCwgaWYgdGhlIGxlZnQudmFsdWUgYW5kIHN0YXRlLnRva2Vucy5jdXJyLnZhbHVlCiAgICAgICAgICAgIC8vIGFyZSBub3QgZXF1YWwsIHRoZW4gc2FmZWx5IGFzc3VtZSB0aGF0IHRoaXMgbm90ICJuZXcgT2JqZWN0KCkiCiAgICAgICAgICAgIGlmIChsZWZ0LnZhbHVlICE9PSBzdGF0ZS50b2tlbnMuY3Vyci52YWx1ZSkgewogICAgICAgICAgICAgIGlzT2JqZWN0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFkdmFuY2UoKTsKCiAgICAgICAgaWYgKGlzQXJyYXkgJiYgc3RhdGUudG9rZW5zLmN1cnIuaWQgPT09ICIoIiAmJiBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIikiKSB7CiAgICAgICAgICB3YXJuaW5nKCJXMDA5Iiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzT2JqZWN0ICYmIHN0YXRlLnRva2Vucy5jdXJyLmlkID09PSAiKCIgJiYgc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIpIikgewogICAgICAgICAgd2FybmluZygiVzAxMCIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICB9CgogICAgICAgIGlmIChsZWZ0ICYmIHN0YXRlLnRva2Vucy5jdXJyLmxlZCkgewogICAgICAgICAgbGVmdCA9IHN0YXRlLnRva2Vucy5jdXJyLmxlZChsZWZ0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXJyb3IoIkUwMzMiLCBzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLmN1cnIuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGlzTGV0RXhwcikgewogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnVuc3RhY2soKTsKICAgIH0KCiAgICBzdGF0ZS5uYW1lU3RhY2sucG9wKCk7CgogICAgcmV0dXJuIGxlZnQ7CiAgfQoKCiAgLy8gRnVuY3Rpb25zIGZvciBjb25mb3JtYW5jZSBvZiBzdHlsZS4KCiAgZnVuY3Rpb24gc3RhcnRMaW5lKHRva2VuKSB7CiAgICByZXR1cm4gdG9rZW4uc3RhcnRMaW5lIHx8IHRva2VuLmxpbmU7CiAgfQoKICBmdW5jdGlvbiBub2JyZWFrbm9uYWRqYWNlbnQobGVmdCwgcmlnaHQpIHsKICAgIGxlZnQgPSBsZWZ0IHx8IHN0YXRlLnRva2Vucy5jdXJyOwogICAgcmlnaHQgPSByaWdodCB8fCBzdGF0ZS50b2tlbnMubmV4dDsKICAgIGlmICghc3RhdGUub3B0aW9uLmxheGJyZWFrICYmIGxlZnQubGluZSAhPT0gc3RhcnRMaW5lKHJpZ2h0KSkgewogICAgICB3YXJuaW5nKCJXMDE0IiwgcmlnaHQsIHJpZ2h0LnZhbHVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG5vbGluZWJyZWFrKHQpIHsKICAgIHQgPSB0IHx8IHN0YXRlLnRva2Vucy5jdXJyOwogICAgaWYgKHQubGluZSAhPT0gc3RhcnRMaW5lKHN0YXRlLnRva2Vucy5uZXh0KSkgewogICAgICB3YXJuaW5nKCJFMDIyIiwgdCwgdC52YWx1ZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBub2JyZWFrY29tbWEobGVmdCwgcmlnaHQpIHsKICAgIGlmIChsZWZ0LmxpbmUgIT09IHN0YXJ0TGluZShyaWdodCkpIHsKICAgICAgaWYgKCFzdGF0ZS5vcHRpb24ubGF4Y29tbWEpIHsKICAgICAgICBpZiAocGFyc2VDb21tYS5maXJzdCkgewogICAgICAgICAgd2FybmluZygiSTAwMSIpOwogICAgICAgICAgcGFyc2VDb21tYS5maXJzdCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB3YXJuaW5nKCJXMDE0IiwgbGVmdCwgcmlnaHQudmFsdWUpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXJzZUNvbW1hKG9wdHMpIHsKICAgIG9wdHMgPSBvcHRzIHx8IHt9OwoKICAgIGlmICghb3B0cy5wZWVrKSB7CiAgICAgIG5vYnJlYWtjb21tYShzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLm5leHQpOwogICAgICBhZHZhbmNlKCIsIik7CiAgICB9IGVsc2UgewogICAgICBub2JyZWFrY29tbWEoc3RhdGUudG9rZW5zLnByZXYsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgIH0KCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWRlbnRpZmllciAmJiAhKG9wdHMucHJvcGVydHkgJiYgc3RhdGUuaW5FUzUoKSkpIHsKICAgICAgLy8gS2V5d29yZHMgdGhhdCBjYW5ub3QgZm9sbG93IGEgY29tbWEgb3BlcmF0b3IuCiAgICAgIHN3aXRjaCAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUpIHsKICAgICAgY2FzZSAiYnJlYWsiOgogICAgICBjYXNlICJjYXNlIjoKICAgICAgY2FzZSAiY2F0Y2giOgogICAgICBjYXNlICJjb250aW51ZSI6CiAgICAgIGNhc2UgImRlZmF1bHQiOgogICAgICBjYXNlICJkbyI6CiAgICAgIGNhc2UgImVsc2UiOgogICAgICBjYXNlICJmaW5hbGx5IjoKICAgICAgY2FzZSAiZm9yIjoKICAgICAgY2FzZSAiaWYiOgogICAgICBjYXNlICJpbiI6CiAgICAgIGNhc2UgImluc3RhbmNlb2YiOgogICAgICBjYXNlICJyZXR1cm4iOgogICAgICBjYXNlICJzd2l0Y2giOgogICAgICBjYXNlICJ0aHJvdyI6CiAgICAgIGNhc2UgInRyeSI6CiAgICAgIGNhc2UgInZhciI6CiAgICAgIGNhc2UgImxldCI6CiAgICAgIGNhc2UgIndoaWxlIjoKICAgICAgY2FzZSAid2l0aCI6CiAgICAgICAgZXJyb3IoIkUwMjQiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC50eXBlID09PSAiKHB1bmN0dWF0b3IpIikgewogICAgICBzd2l0Y2ggKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKSB7CiAgICAgIGNhc2UgIn0iOgogICAgICBjYXNlICJdIjoKICAgICAgY2FzZSAiLCI6CiAgICAgICAgaWYgKG9wdHMuYWxsb3dUcmFpbGluZykgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgIikiOgogICAgICAgIGVycm9yKCJFMDI0Iiwgc3RhdGUudG9rZW5zLm5leHQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8gRnVuY3Rpb25hbCBjb25zdHJ1Y3RvcnMgZm9yIG1ha2luZyB0aGUgc3ltYm9scyB0aGF0IHdpbGwgYmUgaW5oZXJpdGVkIGJ5CiAgLy8gdG9rZW5zLgoKICBmdW5jdGlvbiBzeW1ib2wocywgcCkgewogICAgdmFyIHggPSBzdGF0ZS5zeW50YXhbc107CiAgICBpZiAoIXggfHwgdHlwZW9mIHggIT09ICJvYmplY3QiKSB7CiAgICAgIHN0YXRlLnN5bnRheFtzXSA9IHggPSB7CiAgICAgICAgaWQ6IHMsCiAgICAgICAgbGJwOiBwLAogICAgICAgIHZhbHVlOiBzCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4geDsKICB9CgogIGZ1bmN0aW9uIGRlbGltKHMpIHsKICAgIHZhciB4ID0gc3ltYm9sKHMsIDApOwogICAgeC5kZWxpbSA9IHRydWU7CiAgICByZXR1cm4geDsKICB9CgogIGZ1bmN0aW9uIHN0bXQocywgZikgewogICAgdmFyIHggPSBkZWxpbShzKTsKICAgIHguaWRlbnRpZmllciA9IHgucmVzZXJ2ZWQgPSB0cnVlOwogICAgeC5mdWQgPSBmOwogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiBibG9ja3N0bXQocywgZikgewogICAgdmFyIHggPSBzdG10KHMsIGYpOwogICAgeC5ibG9jayA9IHRydWU7CiAgICByZXR1cm4geDsKICB9CgogIGZ1bmN0aW9uIHJlc2VydmVOYW1lKHgpIHsKICAgIHZhciBjID0geC5pZC5jaGFyQXQoMCk7CiAgICBpZiAoKGMgPj0gImEiICYmIGMgPD0gInoiKSB8fCAoYyA+PSAiQSIgJiYgYyA8PSAiWiIpKSB7CiAgICAgIHguaWRlbnRpZmllciA9IHgucmVzZXJ2ZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiBwcmVmaXgocywgZikgewogICAgdmFyIHggPSBzeW1ib2wocywgMTUwKTsKICAgIHJlc2VydmVOYW1lKHgpOwoKICAgIHgubnVkID0gKHR5cGVvZiBmID09PSAiZnVuY3Rpb24iKSA/IGYgOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5hcml0eSA9ICJ1bmFyeSI7CiAgICAgIHRoaXMucmlnaHQgPSBleHByZXNzaW9uKDE1MCk7CgogICAgICBpZiAodGhpcy5pZCA9PT0gIisrIiB8fCB0aGlzLmlkID09PSAiLS0iKSB7CiAgICAgICAgaWYgKHN0YXRlLm9wdGlvbi5wbHVzcGx1cykgewogICAgICAgICAgd2FybmluZygiVzAxNiIsIHRoaXMsIHRoaXMuaWQpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5yaWdodCAmJiAoIXRoaXMucmlnaHQuaWRlbnRpZmllciB8fCBpc1Jlc2VydmVkKHRoaXMucmlnaHQpKSAmJgogICAgICAgICAgICB0aGlzLnJpZ2h0LmlkICE9PSAiLiIgJiYgdGhpcy5yaWdodC5pZCAhPT0gIlsiKSB7CiAgICAgICAgICB3YXJuaW5nKCJXMDE3IiwgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yaWdodCAmJiB0aGlzLnJpZ2h0LmlzTWV0YVByb3BlcnR5KSB7CiAgICAgICAgICBlcnJvcigiRTAzMSIsIHRoaXMpOwogICAgICAgIC8vIGRldGVjdCBpbmNyZW1lbnQvZGVjcmVtZW50IG9mIGEgY29uc3QKICAgICAgICAvLyBpbiB0aGUgY2FzZSBvZiBhLmIsIHJpZ2h0IHdpbGwgYmUgdGhlICIuIiBwdW5jdHVhdG9yCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJpZ2h0ICYmIHRoaXMucmlnaHQuaWRlbnRpZmllcikgewogICAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5ibG9jay5tb2RpZnkodGhpcy5yaWdodC52YWx1ZSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiB0eXBlKHMsIGYpIHsKICAgIHZhciB4ID0gZGVsaW0ocyk7CiAgICB4LnR5cGUgPSBzOwogICAgeC5udWQgPSBmOwogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiByZXNlcnZlKG5hbWUsIGZ1bmMpIHsKICAgIHZhciB4ID0gdHlwZShuYW1lLCBmdW5jKTsKICAgIHguaWRlbnRpZmllciA9IHRydWU7CiAgICB4LnJlc2VydmVkID0gdHJ1ZTsKICAgIHJldHVybiB4OwogIH0KCiAgZnVuY3Rpb24gRnV0dXJlUmVzZXJ2ZWRXb3JkKG5hbWUsIG1ldGEpIHsKICAgIHZhciB4ID0gdHlwZShuYW1lLCAobWV0YSAmJiBtZXRhLm51ZCkgfHwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSk7CgogICAgbWV0YSA9IG1ldGEgfHwge307CiAgICBtZXRhLmlzRnV0dXJlUmVzZXJ2ZWRXb3JkID0gdHJ1ZTsKCiAgICB4LnZhbHVlID0gbmFtZTsKICAgIHguaWRlbnRpZmllciA9IHRydWU7CiAgICB4LnJlc2VydmVkID0gdHJ1ZTsKICAgIHgubWV0YSA9IG1ldGE7CgogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiByZXNlcnZldmFyKHMsIHYpIHsKICAgIHJldHVybiByZXNlcnZlKHMsIGZ1bmN0aW9uKCkgewogICAgICBpZiAodHlwZW9mIHYgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2KHRoaXMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBpbmZpeChzLCBmLCBwLCB3KSB7CiAgICB2YXIgeCA9IHN5bWJvbChzLCBwKTsKICAgIHJlc2VydmVOYW1lKHgpOwogICAgeC5pbmZpeCA9IHRydWU7CiAgICB4LmxlZCA9IGZ1bmN0aW9uKGxlZnQpIHsKICAgICAgaWYgKCF3KSB7CiAgICAgICAgbm9icmVha25vbmFkamFjZW50KHN0YXRlLnRva2Vucy5wcmV2LCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIH0KICAgICAgaWYgKChzID09PSAiaW4iIHx8IHMgPT09ICJpbnN0YW5jZW9mIikgJiYgbGVmdC5pZCA9PT0gIiEiKSB7CiAgICAgICAgd2FybmluZygiVzAxOCIsIGxlZnQsICIhIik7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBmID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgcmV0dXJuIGYobGVmdCwgdGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDsKICAgICAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbihwKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIHJldHVybiB4OwogIH0KCiAgZnVuY3Rpb24gYXBwbGljYXRpb24ocykgewogICAgdmFyIHggPSBzeW1ib2wocywgNDIpOwoKICAgIHguaW5maXggPSB0cnVlOwogICAgeC5sZWQgPSBmdW5jdGlvbihsZWZ0KSB7CiAgICAgIG5vYnJlYWtub25hZGphY2VudChzdGF0ZS50b2tlbnMucHJldiwgc3RhdGUudG9rZW5zLmN1cnIpOwoKICAgICAgdGhpcy5sZWZ0ID0gbGVmdDsKICAgICAgdGhpcy5yaWdodCA9IGRvRnVuY3Rpb24oeyB0eXBlOiAiYXJyb3ciLCBsb25lQXJnOiBsZWZ0IH0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICByZXR1cm4geDsKICB9CgogIGZ1bmN0aW9uIHJlbGF0aW9uKHMsIGYpIHsKICAgIHZhciB4ID0gc3ltYm9sKHMsIDEwMCk7CgogICAgeC5pbmZpeCA9IHRydWU7CiAgICB4LmxlZCA9IGZ1bmN0aW9uKGxlZnQpIHsKICAgICAgbm9icmVha25vbmFkamFjZW50KHN0YXRlLnRva2Vucy5wcmV2LCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIHRoaXMubGVmdCA9IGxlZnQ7CiAgICAgIHZhciByaWdodCA9IHRoaXMucmlnaHQgPSBleHByZXNzaW9uKDEwMCk7CgogICAgICBpZiAoaXNJZGVudGlmaWVyKGxlZnQsICJOYU4iKSB8fCBpc0lkZW50aWZpZXIocmlnaHQsICJOYU4iKSkgewogICAgICAgIHdhcm5pbmcoIlcwMTkiLCB0aGlzKTsKICAgICAgfSBlbHNlIGlmIChmKSB7CiAgICAgICAgZi5hcHBseSh0aGlzLCBbbGVmdCwgcmlnaHRdKTsKICAgICAgfQoKICAgICAgaWYgKCFsZWZ0IHx8ICFyaWdodCkgewogICAgICAgIHF1aXQoIkUwNDEiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIH0KCiAgICAgIGlmIChsZWZ0LmlkID09PSAiISIpIHsKICAgICAgICB3YXJuaW5nKCJXMDE4IiwgbGVmdCwgIiEiKTsKICAgICAgfQoKICAgICAgaWYgKHJpZ2h0LmlkID09PSAiISIpIHsKICAgICAgICB3YXJuaW5nKCJXMDE4IiwgcmlnaHQsICIhIik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIHJldHVybiB4OwogIH0KCiAgZnVuY3Rpb24gaXNQb29yUmVsYXRpb24obm9kZSkgewogICAgcmV0dXJuIG5vZGUgJiYKICAgICAgICAoKG5vZGUudHlwZSA9PT0gIihudW1iZXIpIiAmJiArbm9kZS52YWx1ZSA9PT0gMCkgfHwKICAgICAgICAgKG5vZGUudHlwZSA9PT0gIihzdHJpbmcpIiAmJiBub2RlLnZhbHVlID09PSAiIikgfHwKICAgICAgICAgKG5vZGUudHlwZSA9PT0gIm51bGwiICYmICFzdGF0ZS5vcHRpb24uZXFudWxsKSB8fAogICAgICAgIG5vZGUudHlwZSA9PT0gInRydWUiIHx8CiAgICAgICAgbm9kZS50eXBlID09PSAiZmFsc2UiIHx8CiAgICAgICAgbm9kZS50eXBlID09PSAidW5kZWZpbmVkIik7CiAgfQoKICB2YXIgdHlwZW9mVmFsdWVzID0ge307CiAgdHlwZW9mVmFsdWVzLmxlZ2FjeSA9IFsKICAgIC8vIEU0WCBleHRlbmRlZCB0aGUgYHR5cGVvZmAgb3BlcmF0b3IgdG8gcmV0dXJuICJ4bWwiIGZvciB0aGUgWE1MIGFuZAogICAgLy8gWE1MTGlzdCB0eXBlcyBpdCBpbnRyb2R1Y2VkLgogICAgLy8gUmVmOiAxMS4zLjIgVGhlIHR5cGVvZiBPcGVyYXRvcgogICAgLy8gaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL3B1YmxpY2F0aW9ucy9maWxlcy9FQ01BLVNUL0VjbWEtMzU3LnBkZgogICAgInhtbCIsCiAgICAvLyBJRTw5IHJlcG9ydHMgInVua25vd24iIHdoZW4gdGhlIGB0eXBlb2ZgIG9wZXJhdG9yIGlzIGFwcGxpZWQgdG8gYW4KICAgIC8vIG9iamVjdCBleGlzdGluZyBhY3Jvc3MgYSBDT00rIGJyaWRnZS4gSW4gbGlldSBvZiBvZmZpY2lhbCBkb2N1bWVudGF0aW9uCiAgICAvLyAod2hpY2ggZG9lcyBub3QgZXhpc3QpLCBzZWU6CiAgICAvLyBodHRwOi8vcm9iZXJ0bnltYW4uY29tLzIwMDUvMTIvMjEvd2hhdC1pcy10eXBlb2YtdW5rbm93bi8KICAgICJ1bmtub3duIgogIF07CiAgdHlwZW9mVmFsdWVzLmVzMyA9IFsKICAgICJ1bmRlZmluZWQiLCAiYm9vbGVhbiIsICJudW1iZXIiLCAic3RyaW5nIiwgImZ1bmN0aW9uIiwgIm9iamVjdCIsCiAgXTsKICB0eXBlb2ZWYWx1ZXMuZXMzID0gdHlwZW9mVmFsdWVzLmVzMy5jb25jYXQodHlwZW9mVmFsdWVzLmxlZ2FjeSk7CiAgdHlwZW9mVmFsdWVzLmVzNiA9IHR5cGVvZlZhbHVlcy5lczMuY29uY2F0KCJzeW1ib2wiKTsKCiAgLy8gQ2hlY2tzIHdoZXRoZXIgdGhlICd0eXBlb2YnIG9wZXJhdG9yIGlzIHVzZWQgd2l0aCB0aGUgY29ycmVjdAogIC8vIHZhbHVlLiBGb3IgZG9jcyBvbiAndHlwZW9mJyBzZWU6CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvT3BlcmF0b3JzL3R5cGVvZgogIGZ1bmN0aW9uIGlzVHlwb1R5cGVvZihsZWZ0LCByaWdodCwgc3RhdGUpIHsKICAgIHZhciB2YWx1ZXM7CgogICAgaWYgKHN0YXRlLm9wdGlvbi5ub3R5cGVvZikKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIGlmICghbGVmdCB8fCAhcmlnaHQpCiAgICAgIHJldHVybiBmYWxzZTsKCiAgICB2YWx1ZXMgPSBzdGF0ZS5pbkVTNigpID8gdHlwZW9mVmFsdWVzLmVzNiA6IHR5cGVvZlZhbHVlcy5lczM7CgogICAgaWYgKHJpZ2h0LnR5cGUgPT09ICIoaWRlbnRpZmllcikiICYmIHJpZ2h0LnZhbHVlID09PSAidHlwZW9mIiAmJiBsZWZ0LnR5cGUgPT09ICIoc3RyaW5nKSIpCiAgICAgIHJldHVybiAhXy5jb250YWlucyh2YWx1ZXMsIGxlZnQudmFsdWUpOwoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGlzR2xvYmFsRXZhbChsZWZ0LCBzdGF0ZSkgewogICAgdmFyIGlzR2xvYmFsID0gZmFsc2U7CgogICAgLy8gcGVybWl0IG1ldGhvZHMgdG8gcmVmZXIgdG8gYW4gImV2YWwiIGtleSBpbiB0aGVpciBvd24gY29udGV4dAogICAgaWYgKGxlZnQudHlwZSA9PT0gInRoaXMiICYmIHN0YXRlLmZ1bmN0WyIoY29udGV4dCkiXSA9PT0gbnVsbCkgewogICAgICBpc0dsb2JhbCA9IHRydWU7CiAgICB9CiAgICAvLyBwZXJtaXQgdXNlIG9mICJldmFsIiBtZW1iZXJzIG9mIG9iamVjdHMKICAgIGVsc2UgaWYgKGxlZnQudHlwZSA9PT0gIihpZGVudGlmaWVyKSIpIHsKICAgICAgaWYgKHN0YXRlLm9wdGlvbi5ub2RlICYmIGxlZnQudmFsdWUgPT09ICJnbG9iYWwiKSB7CiAgICAgICAgaXNHbG9iYWwgPSB0cnVlOwogICAgICB9CgogICAgICBlbHNlIGlmIChzdGF0ZS5vcHRpb24uYnJvd3NlciAmJiAobGVmdC52YWx1ZSA9PT0gIndpbmRvdyIgfHwgbGVmdC52YWx1ZSA9PT0gImRvY3VtZW50IikpIHsKICAgICAgICBpc0dsb2JhbCA9IHRydWU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gaXNHbG9iYWw7CiAgfQoKICBmdW5jdGlvbiBmaW5kTmF0aXZlUHJvdG90eXBlKGxlZnQpIHsKICAgIHZhciBuYXRpdmVzID0gWwogICAgICAiQXJyYXkiLCAiQXJyYXlCdWZmZXIiLCAiQm9vbGVhbiIsICJDb2xsYXRvciIsICJEYXRhVmlldyIsICJEYXRlIiwKICAgICAgIkRhdGVUaW1lRm9ybWF0IiwgIkVycm9yIiwgIkV2YWxFcnJvciIsICJGbG9hdDMyQXJyYXkiLCAiRmxvYXQ2NEFycmF5IiwKICAgICAgIkZ1bmN0aW9uIiwgIkluZmluaXR5IiwgIkludGwiLCAiSW50MTZBcnJheSIsICJJbnQzMkFycmF5IiwgIkludDhBcnJheSIsCiAgICAgICJJdGVyYXRvciIsICJOdW1iZXIiLCAiTnVtYmVyRm9ybWF0IiwgIk9iamVjdCIsICJSYW5nZUVycm9yIiwKICAgICAgIlJlZmVyZW5jZUVycm9yIiwgIlJlZ0V4cCIsICJTdG9wSXRlcmF0aW9uIiwgIlN0cmluZyIsICJTeW50YXhFcnJvciIsCiAgICAgICJUeXBlRXJyb3IiLCAiVWludDE2QXJyYXkiLCAiVWludDMyQXJyYXkiLCAiVWludDhBcnJheSIsICJVaW50OENsYW1wZWRBcnJheSIsCiAgICAgICJVUklFcnJvciIKICAgIF07CgogICAgZnVuY3Rpb24gd2Fsa1Byb3RvdHlwZShvYmopIHsKICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICJvYmplY3QiKSByZXR1cm47CiAgICAgIHJldHVybiBvYmoucmlnaHQgPT09ICJwcm90b3R5cGUiID8gb2JqIDogd2Fsa1Byb3RvdHlwZShvYmoubGVmdCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2Fsa05hdGl2ZShvYmopIHsKICAgICAgd2hpbGUgKCFvYmouaWRlbnRpZmllciAmJiB0eXBlb2Ygb2JqLmxlZnQgPT09ICJvYmplY3QiKQogICAgICAgIG9iaiA9IG9iai5sZWZ0OwoKICAgICAgaWYgKG9iai5pZGVudGlmaWVyICYmIG5hdGl2ZXMuaW5kZXhPZihvYmoudmFsdWUpID49IDAgJiYKICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uaXNQcmVkZWZpbmVkKG9iai52YWx1ZSkpIHsKICAgICAgICByZXR1cm4gb2JqLnZhbHVlOwogICAgICB9CiAgICB9CgogICAgdmFyIHByb3RvdHlwZSA9IHdhbGtQcm90b3R5cGUobGVmdCk7CiAgICBpZiAocHJvdG90eXBlKSByZXR1cm4gd2Fsa05hdGl2ZShwcm90b3R5cGUpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiBhbiBhc3NpZ25tZW50IGZvciBpc3N1ZXMsIHJldHVybnMgaWYgb2sKICAgKiBAcGFyYW0ge3Rva2VufSBsZWZ0IC0gdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBhc3NpZ25tZW50CiAgICogQHBhcmFtIHt0b2tlbj19IGFzc2lnblRva2VuIC0gdGhlIHRva2VuIGZvciB0aGUgYXNzaWdubWVudCwgdXNlZCBmb3IgcmVwb3J0aW5nCiAgICogQHBhcmFtIHtvYmplY3Q9fSBvcHRpb25zIC0gb3B0aW9uYWwgb2JqZWN0CiAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLmFsbG93RGVzdHJ1Y3R1cmluZyAtIHdoZXRoZXIgdG8gYWxsb3cgZGVzdHJ1Y3R1dGluZyBiaW5kaW5nCiAgICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGxlZnQgaGFuZCBzaWRlIGlzIE9LCiAgICovCiAgZnVuY3Rpb24gY2hlY2tMZWZ0U2lkZUFzc2lnbihsZWZ0LCBhc3NpZ25Ub2tlbiwgb3B0aW9ucykgewoKICAgIHZhciBhbGxvd0Rlc3RydWN0dXJpbmcgPSBvcHRpb25zICYmIG9wdGlvbnMuYWxsb3dEZXN0cnVjdHVyaW5nOwoKICAgIGFzc2lnblRva2VuID0gYXNzaWduVG9rZW4gfHwgbGVmdDsKCiAgICBpZiAoc3RhdGUub3B0aW9uLmZyZWV6ZSkgewogICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gZmluZE5hdGl2ZVByb3RvdHlwZShsZWZ0KTsKICAgICAgaWYgKG5hdGl2ZU9iamVjdCkKICAgICAgICB3YXJuaW5nKCJXMTIxIiwgbGVmdCwgbmF0aXZlT2JqZWN0KTsKICAgIH0KICAgIGlmIChjaGVja1B1bmN0dWF0b3IobGVmdCwgIi4uLiIpKSB7CiAgICAgIGxlZnQgPSBsZWZ0LnJpZ2h0OwogICAgfQoKICAgIGlmIChsZWZ0LmlkZW50aWZpZXIgJiYgIWxlZnQuaXNNZXRhUHJvcGVydHkpIHsKICAgICAgLy8gcmVhc3NpZ24gYWxzbyBjYWxscyBtb2RpZnkKICAgICAgLy8gYnV0IHdlIGFyZSBzcGVjaWZpYyBpbiBvcmRlciB0byBjYXRjaCBmdW5jdGlvbiByZS1hc3NpZ25tZW50CiAgICAgIC8vIGFuZCBnbG9iYWxzIHJlLWFzc2lnbm1lbnQKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5ibG9jay5yZWFzc2lnbihsZWZ0LnZhbHVlLCBsZWZ0KTsKICAgIH0KCiAgICBpZiAobGVmdC5pZCA9PT0gIi4iKSB7CiAgICAgIGlmICghbGVmdC5sZWZ0IHx8IGxlZnQubGVmdC52YWx1ZSA9PT0gImFyZ3VtZW50cyIgJiYgIXN0YXRlLmlzU3RyaWN0KCkpIHsKICAgICAgICB3YXJuaW5nKCJFMDMxIiwgYXNzaWduVG9rZW4pOwogICAgICB9CgogICAgICBzdGF0ZS5uYW1lU3RhY2suc2V0KHN0YXRlLnRva2Vucy5wcmV2KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgaWYgKGxlZnQuaWQgPT09ICJ7IiB8fCBsZWZ0LmlkID09PSAiWyIpIHsKICAgICAgaWYgKCFhbGxvd0Rlc3RydWN0dXJpbmcgfHwgIWxlZnQuZGVzdHJ1Y3RBc3NpZ24pIHsKICAgICAgICBpZiAobGVmdC5pZCA9PT0gInsiIHx8ICFsZWZ0LmxlZnQpIHsKICAgICAgICAgIHdhcm5pbmcoIkUwMzEiLCBhc3NpZ25Ub2tlbik7CiAgICAgICAgfSBlbHNlIGlmIChsZWZ0LmxlZnQudmFsdWUgPT09ICJhcmd1bWVudHMiICYmICFzdGF0ZS5pc1N0cmljdCgpKSB7CiAgICAgICAgICB3YXJuaW5nKCJFMDMxIiwgYXNzaWduVG9rZW4pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGxlZnQuaWQgPT09ICJbIikgewogICAgICAgIHN0YXRlLm5hbWVTdGFjay5zZXQobGVmdC5yaWdodCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIGlmIChsZWZ0LmlkZW50aWZpZXIgJiYgIWlzUmVzZXJ2ZWQobGVmdCkgJiYgIWxlZnQuaXNNZXRhUHJvcGVydHkpIHsKICAgICAgaWYgKHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0ubGFiZWx0eXBlKGxlZnQudmFsdWUpID09PSAiZXhjZXB0aW9uIikgewogICAgICAgIHdhcm5pbmcoIlcwMjIiLCBsZWZ0KTsKICAgICAgfQogICAgICBzdGF0ZS5uYW1lU3RhY2suc2V0KGxlZnQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBpZiAobGVmdCA9PT0gc3RhdGUuc3ludGF4WyJmdW5jdGlvbiJdKSB7CiAgICAgIHdhcm5pbmcoIlcwMjMiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICB9IGVsc2UgewogICAgICBlcnJvcigiRTAzMSIsIGFzc2lnblRva2VuKTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBhc3NpZ25vcChzLCBmLCBwKSB7CiAgICB2YXIgeCA9IGluZml4KHMsIHR5cGVvZiBmID09PSAiZnVuY3Rpb24iID8gZiA6IGZ1bmN0aW9uKGxlZnQsIHRoYXQpIHsKICAgICAgdGhhdC5sZWZ0ID0gbGVmdDsKCiAgICAgIGNoZWNrTGVmdFNpZGVBc3NpZ24obGVmdCwgdGhhdCwgeyBhbGxvd0Rlc3RydWN0dXJpbmc6IHRydWUgfSk7CgogICAgICB0aGF0LnJpZ2h0ID0gZXhwcmVzc2lvbigxMCk7CgogICAgICByZXR1cm4gdGhhdDsKICAgIH0sIHApOwoKICAgIHguZXhwcyA9IHRydWU7CiAgICB4LmFzc2lnbiA9IHRydWU7CiAgICByZXR1cm4geDsKICB9CgoKICBmdW5jdGlvbiBiaXR3aXNlKHMsIGYsIHApIHsKICAgIHZhciB4ID0gc3ltYm9sKHMsIHApOwogICAgcmVzZXJ2ZU5hbWUoeCk7CiAgICB4LmluZml4ID0gdHJ1ZTsKICAgIHgubGVkID0gKHR5cGVvZiBmID09PSAiZnVuY3Rpb24iKSA/IGYgOiBmdW5jdGlvbihsZWZ0KSB7CiAgICAgIGlmIChzdGF0ZS5vcHRpb24uYml0d2lzZSkgewogICAgICAgIHdhcm5pbmcoIlcwMTYiLCB0aGlzLCB0aGlzLmlkKTsKICAgICAgfQogICAgICB0aGlzLmxlZnQgPSBsZWZ0OwogICAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbihwKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgcmV0dXJuIHg7CiAgfQoKICBmdW5jdGlvbiBiaXR3aXNlYXNzaWdub3AocykgewogICAgcmV0dXJuIGFzc2lnbm9wKHMsIGZ1bmN0aW9uKGxlZnQsIHRoYXQpIHsKICAgICAgaWYgKHN0YXRlLm9wdGlvbi5iaXR3aXNlKSB7CiAgICAgICAgd2FybmluZygiVzAxNiIsIHRoYXQsIHRoYXQuaWQpOwogICAgICB9CgogICAgICBjaGVja0xlZnRTaWRlQXNzaWduKGxlZnQsIHRoYXQpOwoKICAgICAgdGhhdC5yaWdodCA9IGV4cHJlc3Npb24oMTApOwoKICAgICAgcmV0dXJuIHRoYXQ7CiAgICB9LCAyMCk7CiAgfQoKICBmdW5jdGlvbiBzdWZmaXgocykgewogICAgdmFyIHggPSBzeW1ib2wocywgMTUwKTsKCiAgICB4LmxlZCA9IGZ1bmN0aW9uKGxlZnQpIHsKICAgICAgLy8gdGhpcyA9IHN1ZmZpeCBlLmcuICIrKyIgcHVuY3R1YXRvcgogICAgICAvLyBsZWZ0ID0gc3ltYm9sIG9wZXJhdGVkIGUuZy4gImEiIGlkZW50aWZpZXIgb3IgImEuYiIgcHVuY3R1YXRvcgogICAgICBpZiAoc3RhdGUub3B0aW9uLnBsdXNwbHVzKSB7CiAgICAgICAgd2FybmluZygiVzAxNiIsIHRoaXMsIHRoaXMuaWQpOwogICAgICB9IGVsc2UgaWYgKCghbGVmdC5pZGVudGlmaWVyIHx8IGlzUmVzZXJ2ZWQobGVmdCkpICYmIGxlZnQuaWQgIT09ICIuIiAmJiBsZWZ0LmlkICE9PSAiWyIpIHsKICAgICAgICB3YXJuaW5nKCJXMDE3IiwgdGhpcyk7CiAgICAgIH0KCiAgICAgIGlmIChsZWZ0LmlzTWV0YVByb3BlcnR5KSB7CiAgICAgICAgZXJyb3IoIkUwMzEiLCB0aGlzKTsKICAgICAgLy8gZGV0ZWN0IGluY3JlbWVudC9kZWNyZW1lbnQgb2YgYSBjb25zdAogICAgICAvLyBpbiB0aGUgY2FzZSBvZiBhLmIsIGxlZnQgd2lsbCBiZSB0aGUgIi4iIHB1bmN0dWF0b3IKICAgICAgfSBlbHNlIGlmIChsZWZ0ICYmIGxlZnQuaWRlbnRpZmllcikgewogICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYmxvY2subW9kaWZ5KGxlZnQudmFsdWUsIGxlZnQpOwogICAgICB9CgogICAgICB0aGlzLmxlZnQgPSBsZWZ0OwogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICByZXR1cm4geDsKICB9CgogIC8vIGZucGFyYW0gbWVhbnMgdGhhdCB0aGlzIGlkZW50aWZpZXIgaXMgYmVpbmcgZGVmaW5lZCBhcyBhIGZ1bmN0aW9uCiAgLy8gYXJndW1lbnQgKHNlZSBpZGVudGlmaWVyKCkpCiAgLy8gcHJvcCBtZWFucyB0aGF0IHRoaXMgaWRlbnRpZmllciBpcyB0aGF0IG9mIGFuIG9iamVjdCBwcm9wZXJ0eQoKICBmdW5jdGlvbiBvcHRpb25hbGlkZW50aWZpZXIoZm5wYXJhbSwgcHJvcCwgcHJlc2VydmUpIHsKICAgIGlmICghc3RhdGUudG9rZW5zLm5leHQuaWRlbnRpZmllcikgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFwcmVzZXJ2ZSkgewogICAgICBhZHZhbmNlKCk7CiAgICB9CgogICAgdmFyIGN1cnIgPSBzdGF0ZS50b2tlbnMuY3VycjsKICAgIHZhciB2YWwgID0gc3RhdGUudG9rZW5zLmN1cnIudmFsdWU7CgogICAgaWYgKCFpc1Jlc2VydmVkKGN1cnIpKSB7CiAgICAgIHJldHVybiB2YWw7CiAgICB9CgogICAgaWYgKHByb3ApIHsKICAgICAgaWYgKHN0YXRlLmluRVM1KCkpIHsKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9CiAgICB9CgogICAgaWYgKGZucGFyYW0gJiYgdmFsID09PSAidW5kZWZpbmVkIikgewogICAgICByZXR1cm4gdmFsOwogICAgfQoKICAgIHdhcm5pbmcoIlcwMjQiLCBzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLmN1cnIuaWQpOwogICAgcmV0dXJuIHZhbDsKICB9CgogIC8vIGZucGFyYW0gbWVhbnMgdGhhdCB0aGlzIGlkZW50aWZpZXIgaXMgYmVpbmcgZGVmaW5lZCBhcyBhIGZ1bmN0aW9uCiAgLy8gYXJndW1lbnQKICAvLyBwcm9wIG1lYW5zIHRoYXQgdGhpcyBpZGVudGlmaWVyIGlzIHRoYXQgb2YgYW4gb2JqZWN0IHByb3BlcnR5CiAgZnVuY3Rpb24gaWRlbnRpZmllcihmbnBhcmFtLCBwcm9wKSB7CiAgICB2YXIgaSA9IG9wdGlvbmFsaWRlbnRpZmllcihmbnBhcmFtLCBwcm9wLCBmYWxzZSk7CiAgICBpZiAoaSkgewogICAgICByZXR1cm4gaTsKICAgIH0KCiAgICAvLyBwYXJhbWV0ZXIgZGVzdHJ1Y3R1cmluZyB3aXRoIHJlc3Qgb3BlcmF0b3IKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIi4uLiIpIHsKICAgICAgaWYgKCFzdGF0ZS5pbkVTNih0cnVlKSkgewogICAgICAgIHdhcm5pbmcoIlcxMTkiLCBzdGF0ZS50b2tlbnMubmV4dCwgInNwcmVhZC9yZXN0IG9wZXJhdG9yIiwgIjYiKTsKICAgICAgfQogICAgICBhZHZhbmNlKCk7CgogICAgICBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLi4uIikpIHsKICAgICAgICB3YXJuaW5nKCJFMDI0Iiwgc3RhdGUudG9rZW5zLm5leHQsICIuLi4iKTsKICAgICAgICB3aGlsZSAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLi4uIikpIHsKICAgICAgICAgIGFkdmFuY2UoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghc3RhdGUudG9rZW5zLm5leHQuaWRlbnRpZmllcikgewogICAgICAgIHdhcm5pbmcoIkUwMjQiLCBzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLm5leHQuaWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIGlkZW50aWZpZXIoZm5wYXJhbSwgcHJvcCk7CiAgICB9IGVsc2UgewogICAgICBlcnJvcigiRTAzMCIsIHN0YXRlLnRva2Vucy5uZXh0LCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSk7CgogICAgICAvLyBUaGUgdG9rZW4gc2hvdWxkIGJlIGNvbnN1bWVkIGFmdGVyIGEgd2FybmluZyBpcyBpc3N1ZWQgc28gdGhlIHBhcnNlcgogICAgICAvLyBjYW4gY29udGludWUgYXMgdGhvdWdoIGFuIGlkZW50aWZpZXIgd2VyZSBmb3VuZC4gVGhlIHNlbWljb2xvbiB0b2tlbgogICAgICAvLyBzaG91bGQgbm90IGJlIGNvbnN1bWVkIGluIHRoaXMgd2F5IHNvIHRoYXQgdGhlIHBhcnNlciBpbnRlcnByZXRzIGl0IGFzCiAgICAgIC8vIGEgc3RhdGVtZW50IGRlbGltZXRlcjsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiOyIpIHsKICAgICAgICBhZHZhbmNlKCk7CiAgICAgIH0KICAgIH0KICB9CgoKICBmdW5jdGlvbiByZWFjaGFibGUoY29udHJvbFRva2VuKSB7CiAgICB2YXIgaSA9IDAsIHQ7CiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI7IiB8fCBjb250cm9sVG9rZW4uaW5CcmFjZWxlc3NCbG9jaykgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKDs7KSB7CiAgICAgIGRvIHsKICAgICAgICB0ID0gcGVlayhpKTsKICAgICAgICBpICs9IDE7CiAgICAgIH0gd2hpbGUgKHQuaWQgIT09ICIoZW5kKSIgJiYgdC5pZCA9PT0gIihjb21tZW50KSIpOwoKICAgICAgaWYgKHQucmVhY2gpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHQuaWQgIT09ICIoZW5kbGluZSkiKSB7CiAgICAgICAgaWYgKHQuaWQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIGlmIChzdGF0ZS5vcHRpb24ubGF0ZWRlZiA9PT0gdHJ1ZSkgewogICAgICAgICAgICB3YXJuaW5nKCJXMDI2IiwgdCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHdhcm5pbmcoIlcwMjciLCB0LCB0LnZhbHVlLCBjb250cm9sVG9rZW4udmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXJzZUZpbmFsU2VtaWNvbG9uKCkgewogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiOyIpIHsKICAgICAgLy8gZG9uJ3QgY29tcGxhaW4gYWJvdXQgdW5jbG9zZWQgdGVtcGxhdGVzIC8gc3RyaW5ncwogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaXNVbmNsb3NlZCkgcmV0dXJuIGFkdmFuY2UoKTsKCiAgICAgIHZhciBzYW1lTGluZSA9IHN0YXJ0TGluZShzdGF0ZS50b2tlbnMubmV4dCkgPT09IHN0YXRlLnRva2Vucy5jdXJyLmxpbmUgJiYKICAgICAgICAgICAgICAgICAgICAgc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIoZW5kKSI7CiAgICAgIHZhciBibG9ja0VuZCA9IGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIn0iKTsKCiAgICAgIGlmIChzYW1lTGluZSAmJiAhYmxvY2tFbmQpIHsKICAgICAgICBlcnJvckF0KCJFMDU4Iiwgc3RhdGUudG9rZW5zLmN1cnIubGluZSwgc3RhdGUudG9rZW5zLmN1cnIuY2hhcmFjdGVyKTsKICAgICAgfSBlbHNlIGlmICghc3RhdGUub3B0aW9uLmFzaSkgewogICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGxhc3Qgc3RhdGVtZW50IGluIGEgYmxvY2sgdGhhdCBlbmRzIG9uCiAgICAgICAgLy8gdGhlIHNhbWUgbGluZSAqYW5kKiBvcHRpb24gbGFzdHNlbWljIGlzIG9uLCBpZ25vcmUgdGhlIHdhcm5pbmcuCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBjb21wbGFpbiBhYm91dCBtaXNzaW5nIHNlbWljb2xvbi4KICAgICAgICBpZiAoKGJsb2NrRW5kICYmICFzdGF0ZS5vcHRpb24ubGFzdHNlbWljKSB8fCAhc2FtZUxpbmUpIHsKICAgICAgICAgIHdhcm5pbmdBdCgiVzAzMyIsIHN0YXRlLnRva2Vucy5jdXJyLmxpbmUsIHN0YXRlLnRva2Vucy5jdXJyLmNoYXJhY3Rlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBhZHZhbmNlKCI7Iik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzdGF0ZW1lbnQoKSB7CiAgICB2YXIgaSA9IGluZGVudCwgciwgdCA9IHN0YXRlLnRva2Vucy5uZXh0LCBoYXNPd25TY29wZSA9IGZhbHNlOwoKICAgIGlmICh0LmlkID09PSAiOyIpIHsKICAgICAgYWR2YW5jZSgiOyIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSXMgdGhpcyBhIGxhYmVsbGVkIHN0YXRlbWVudD8KICAgIHZhciByZXMgPSBpc1Jlc2VydmVkKHQpOwoKICAgIC8vIFdlJ3JlIGJlaW5nIG1vcmUgdG9sZXJhbnQgaGVyZTogaWYgc29tZW9uZSB1c2VzCiAgICAvLyBhIEZ1dHVyZVJlc2VydmVkV29yZCBhcyBhIGxhYmVsLCB3ZSB3YXJuIGJ1dCBwcm9jZWVkCiAgICAvLyBhbnl3YXkuCgogICAgaWYgKHJlcyAmJiB0Lm1ldGEgJiYgdC5tZXRhLmlzRnV0dXJlUmVzZXJ2ZWRXb3JkICYmIHBlZWsoKS5pZCA9PT0gIjoiKSB7CiAgICAgIHdhcm5pbmcoIlcwMjQiLCB0LCB0LmlkKTsKICAgICAgcmVzID0gZmFsc2U7CiAgICB9CgogICAgaWYgKHQuaWRlbnRpZmllciAmJiAhcmVzICYmIHBlZWsoKS5pZCA9PT0gIjoiKSB7CiAgICAgIGFkdmFuY2UoKTsKICAgICAgYWR2YW5jZSgiOiIpOwoKICAgICAgaGFzT3duU2NvcGUgPSB0cnVlOwogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCk7CiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYmxvY2suYWRkQnJlYWtMYWJlbCh0LnZhbHVlLCB7IHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9KTsKCiAgICAgIGlmICghc3RhdGUudG9rZW5zLm5leHQubGFiZWxsZWQgJiYgc3RhdGUudG9rZW5zLm5leHQudmFsdWUgIT09ICJ7IikgewogICAgICAgIHdhcm5pbmcoIlcwMjgiLCBzdGF0ZS50b2tlbnMubmV4dCwgdC52YWx1ZSwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICB9CgogICAgICBzdGF0ZS50b2tlbnMubmV4dC5sYWJlbCA9IHQudmFsdWU7CiAgICAgIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIH0KCiAgICAvLyBJcyBpdCBhIGxvbmVseSBibG9jaz8KCiAgICBpZiAodC5pZCA9PT0gInsiKSB7CiAgICAgIC8vIElzIGl0IGEgc3dpdGNoIGNhc2UgYmxvY2s/CiAgICAgIC8vCiAgICAgIC8vICBzd2l0Y2ggKGZvbykgewogICAgICAvLyAgICBjYXNlIGJhcjogeyA8PSBoZXJlLgogICAgICAvLyAgICAgIC4uLgogICAgICAvLyAgICB9CiAgICAgIC8vICB9CiAgICAgIHZhciBpc2Nhc2UgPSAoc3RhdGUuZnVuY3RbIih2ZXJiKSJdID09PSAiY2FzZSIgJiYgc3RhdGUudG9rZW5zLmN1cnIudmFsdWUgPT09ICI6Iik7CiAgICAgIGJsb2NrKHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgaXNjYXNlKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFBhcnNlIHRoZSBzdGF0ZW1lbnQuCgogICAgciA9IGV4cHJlc3Npb24oMCwgdHJ1ZSk7CgogICAgaWYgKHIgJiYgIShyLmlkZW50aWZpZXIgJiYgci52YWx1ZSA9PT0gImZ1bmN0aW9uIikgJiYKICAgICAgICAhKHIudHlwZSA9PT0gIihwdW5jdHVhdG9yKSIgJiYgci5sZWZ0ICYmCiAgICAgICAgICByLmxlZnQuaWRlbnRpZmllciAmJiByLmxlZnQudmFsdWUgPT09ICJmdW5jdGlvbiIpKSB7CiAgICAgIGlmICghc3RhdGUuaXNTdHJpY3QoKSAmJiBzdGF0ZS5zdG10TWlzc2luZ1N0cmljdCgpKSB7CiAgICAgICAgd2FybmluZygiRTAwNyIpOwogICAgICB9CiAgICB9CgogICAgLy8gTG9vayBmb3IgdGhlIGZpbmFsIHNlbWljb2xvbi4KCiAgICBpZiAoIXQuYmxvY2spIHsKICAgICAgaWYgKCFzdGF0ZS5vcHRpb24uZXhwciAmJiAoIXIgfHwgIXIuZXhwcykpIHsKICAgICAgICB3YXJuaW5nKCJXMDMwIiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICB9IGVsc2UgaWYgKHN0YXRlLm9wdGlvbi5ub25ldyAmJiByICYmIHIubGVmdCAmJiByLmlkID09PSAiKCIgJiYgci5sZWZ0LmlkID09PSAibmV3IikgewogICAgICAgIHdhcm5pbmcoIlcwMzEiLCB0KTsKICAgICAgfQogICAgICBwYXJzZUZpbmFsU2VtaWNvbG9uKCk7CiAgICB9CgoKICAgIC8vIFJlc3RvcmUgdGhlIGluZGVudGF0aW9uLgoKICAgIGluZGVudCA9IGk7CiAgICBpZiAoaGFzT3duU2NvcGUpIHsKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS51bnN0YWNrKCk7CiAgICB9CiAgICByZXR1cm4gcjsKICB9CgoKICBmdW5jdGlvbiBzdGF0ZW1lbnRzKCkgewogICAgdmFyIGEgPSBbXSwgcDsKCiAgICB3aGlsZSAoIXN0YXRlLnRva2Vucy5uZXh0LnJlYWNoICYmIHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiKGVuZCkiKSB7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIjsiKSB7CiAgICAgICAgcCA9IHBlZWsoKTsKCiAgICAgICAgaWYgKCFwIHx8IChwLmlkICE9PSAiKCIgJiYgcC5pZCAhPT0gIlsiKSkgewogICAgICAgICAgd2FybmluZygiVzAzMiIpOwogICAgICAgIH0KCiAgICAgICAgYWR2YW5jZSgiOyIpOwogICAgICB9IGVsc2UgewogICAgICAgIGEucHVzaChzdGF0ZW1lbnQoKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH0KCgogIC8qCiAgICogcmVhZCBhbGwgZGlyZWN0aXZlcwogICAqLwogIGZ1bmN0aW9uIGRpcmVjdGl2ZXMoKSB7CiAgICB2YXIgY3VycmVudCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgd2hpbGUgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKHN0cmluZykiKSB7CiAgICAgIHZhciBuZXh0ID0gcGVla0lnbm9yZUVPTCgpOwogICAgICBpZiAoIWlzRW5kT2ZFeHByKGN1cnJlbnQsIG5leHQpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY3VycmVudCA9IG5leHQ7CgogICAgICBhZHZhbmNlKCk7CiAgICAgIHZhciBkaXJlY3RpdmUgPSBzdGF0ZS50b2tlbnMuY3Vyci52YWx1ZTsKICAgICAgaWYgKHN0YXRlLmRpcmVjdGl2ZVtkaXJlY3RpdmVdIHx8CiAgICAgICAgICAoZGlyZWN0aXZlID09PSAidXNlIHN0cmljdCIgJiYgc3RhdGUub3B0aW9uLnN0cmljdCA9PT0gImltcGxpZWQiKSkgewogICAgICAgIHdhcm5pbmcoIlcwMzQiLCBzdGF0ZS50b2tlbnMuY3VyciwgZGlyZWN0aXZlKTsKICAgICAgfQoKICAgICAgLy8gdGhlcmUncyBubyBkaXJlY3RpdmUgbmVnYXRpb24sIHNvIGFsd2F5cyBzZXQgdG8gdHJ1ZQogICAgICBzdGF0ZS5kaXJlY3RpdmVbZGlyZWN0aXZlXSA9IHRydWU7CgogICAgICBwYXJzZUZpbmFsU2VtaWNvbG9uKCk7CiAgICB9CgogICAgaWYgKHN0YXRlLmlzU3RyaWN0KCkpIHsKICAgICAgc3RhdGUub3B0aW9uLnVuZGVmID0gdHJ1ZTsKICAgIH0KICB9CgoKICAvKgogICAqIFBhcnNlcyBhIHNpbmdsZSBibG9jay4gQSBibG9jayBpcyBhIHNlcXVlbmNlIG9mIHN0YXRlbWVudHMgd3JhcHBlZCBpbgogICAqIGJyYWNlcy4KICAgKgogICAqIG9yZGluYXJ5ICAgLSB0cnVlIGZvciBldmVyeXRoaW5nIGJ1dCBmdW5jdGlvbiBib2RpZXMgYW5kIHRyeSBibG9ja3MuCiAgICogc3RtdCAgICAgICAtIHRydWUgaWYgYmxvY2sgY2FuIGJlIGEgc2luZ2xlIHN0YXRlbWVudCAoZS5nLiBpbiBpZi9mb3Ivd2hpbGUpLgogICAqIGlzZnVuYyAgICAgLSB0cnVlIGlmIGJsb2NrIGlzIGEgZnVuY3Rpb24gYm9keQogICAqIGlzZmF0YXJyb3cgLSB0cnVlIGlmIGl0cyBhIGJvZHkgb2YgYSBmYXQgYXJyb3cgZnVuY3Rpb24KICAgKiBpc2Nhc2UgICAgICAtIHRydWUgaWYgYmxvY2sgaXMgYSBzd2l0Y2ggY2FzZSBibG9jawogICAqLwogIGZ1bmN0aW9uIGJsb2NrKG9yZGluYXJ5LCBzdG10LCBpc2Z1bmMsIGlzZmF0YXJyb3csIGlzY2FzZSkgewogICAgdmFyIGEsCiAgICAgIGIgPSBpbmJsb2NrLAogICAgICBvbGRfaW5kZW50ID0gaW5kZW50LAogICAgICBtLAogICAgICB0LAogICAgICBsaW5lLAogICAgICBkOwoKICAgIGluYmxvY2sgPSBvcmRpbmFyeTsKCiAgICB0ID0gc3RhdGUudG9rZW5zLm5leHQ7CgogICAgdmFyIG1ldHJpY3MgPSBzdGF0ZS5mdW5jdFsiKG1ldHJpY3MpIl07CiAgICBtZXRyaWNzLm5lc3RlZEJsb2NrRGVwdGggKz0gMTsKICAgIG1ldHJpY3MudmVyaWZ5TWF4TmVzdGVkQmxvY2tEZXB0aFBlckZ1bmN0aW9uKCk7CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAieyIpIHsKICAgICAgYWR2YW5jZSgieyIpOwoKICAgICAgLy8gY3JlYXRlIGEgbmV3IGJsb2NrIHNjb3BlCiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc3RhY2soKTsKICAgICAgc3RhdGUuZnVuY3RbIihub2Jsb2Nrc2NvcGVkdmFyKSJdID0gZmFsc2U7CgogICAgICBsaW5lID0gc3RhdGUudG9rZW5zLmN1cnIubGluZTsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAifSIpIHsKICAgICAgICBpbmRlbnQgKz0gc3RhdGUub3B0aW9uLmluZGVudDsKICAgICAgICB3aGlsZSAoIW9yZGluYXJ5ICYmIHN0YXRlLnRva2Vucy5uZXh0LmZyb20gPiBpbmRlbnQpIHsKICAgICAgICAgIGluZGVudCArPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzZnVuYykgewogICAgICAgICAgbSA9IHt9OwogICAgICAgICAgZm9yIChkIGluIHN0YXRlLmRpcmVjdGl2ZSkgewogICAgICAgICAgICBpZiAoXy5oYXMoc3RhdGUuZGlyZWN0aXZlLCBkKSkgewogICAgICAgICAgICAgIG1bZF0gPSBzdGF0ZS5kaXJlY3RpdmVbZF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGRpcmVjdGl2ZXMoKTsKCiAgICAgICAgICBpZiAoc3RhdGUub3B0aW9uLnN0cmljdCAmJiBzdGF0ZS5mdW5jdFsiKGNvbnRleHQpIl1bIihnbG9iYWwpIl0pIHsKICAgICAgICAgICAgaWYgKCFtWyJ1c2Ugc3RyaWN0Il0gJiYgIXN0YXRlLmlzU3RyaWN0KCkpIHsKICAgICAgICAgICAgICB3YXJuaW5nKCJFMDA3Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGEgPSBzdGF0ZW1lbnRzKCk7CgogICAgICAgIG1ldHJpY3Muc3RhdGVtZW50Q291bnQgKz0gYS5sZW5ndGg7CgogICAgICAgIGluZGVudCAtPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgICB9CgogICAgICBhZHZhbmNlKCJ9IiwgdCk7CgogICAgICBpZiAoaXNmdW5jKSB7CiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS52YWxpZGF0ZVBhcmFtcygpOwogICAgICAgIGlmIChtKSB7CiAgICAgICAgICBzdGF0ZS5kaXJlY3RpdmUgPSBtOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS51bnN0YWNrKCk7CgogICAgICBpbmRlbnQgPSBvbGRfaW5kZW50OwogICAgfSBlbHNlIGlmICghb3JkaW5hcnkpIHsKICAgICAgaWYgKGlzZnVuYykgewogICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc3RhY2soKTsKCiAgICAgICAgbSA9IHt9OwogICAgICAgIGlmIChzdG10ICYmICFpc2ZhdGFycm93ICYmICFzdGF0ZS5pbk1veigpKSB7CiAgICAgICAgICBlcnJvcigiVzExOCIsIHN0YXRlLnRva2Vucy5jdXJyLCAiZnVuY3Rpb24gY2xvc3VyZSBleHByZXNzaW9ucyIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzdG10KSB7CiAgICAgICAgICBmb3IgKGQgaW4gc3RhdGUuZGlyZWN0aXZlKSB7CiAgICAgICAgICAgIGlmIChfLmhhcyhzdGF0ZS5kaXJlY3RpdmUsIGQpKSB7CiAgICAgICAgICAgICAgbVtkXSA9IHN0YXRlLmRpcmVjdGl2ZVtkXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBleHByZXNzaW9uKDEwKTsKCiAgICAgICAgaWYgKHN0YXRlLm9wdGlvbi5zdHJpY3QgJiYgc3RhdGUuZnVuY3RbIihjb250ZXh0KSJdWyIoZ2xvYmFsKSJdKSB7CiAgICAgICAgICBpZiAoIW1bInVzZSBzdHJpY3QiXSAmJiAhc3RhdGUuaXNTdHJpY3QoKSkgewogICAgICAgICAgICB3YXJuaW5nKCJFMDA3Iik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnVuc3RhY2soKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlcnJvcigiRTAyMSIsIHN0YXRlLnRva2Vucy5uZXh0LCAieyIsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgfQogICAgfSBlbHNlIHsKCiAgICAgIC8vIGNoZWNrIHRvIGF2b2lkIGxldCBkZWNsYXJhdGlvbiBub3Qgd2l0aGluIGEgYmxvY2sKICAgICAgLy8gdGhvdWdoIGlzIGZpbmUgaW5zaWRlIGZvciBsb29wIGluaXRpYWxpemVyIHNlY3Rpb24KICAgICAgc3RhdGUuZnVuY3RbIihub2Jsb2Nrc2NvcGVkdmFyKSJdID0gc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICJmb3IiOwogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCk7CgogICAgICBpZiAoIXN0bXQgfHwgc3RhdGUub3B0aW9uLmN1cmx5KSB7CiAgICAgICAgd2FybmluZygiVzExNiIsIHN0YXRlLnRva2Vucy5uZXh0LCAieyIsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgfQoKICAgICAgc3RhdGUudG9rZW5zLm5leHQuaW5CcmFjZWxlc3NCbG9jayA9IHRydWU7CiAgICAgIGluZGVudCArPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgICAvLyB0ZXN0IGluZGVudGF0aW9uIG9ubHkgaWYgc3RhdGVtZW50IGlzIGluIG5ldyBsaW5lCiAgICAgIGEgPSBbc3RhdGVtZW50KCldOwogICAgICBpbmRlbnQgLT0gc3RhdGUub3B0aW9uLmluZGVudDsKCiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0udW5zdGFjaygpOwogICAgICBkZWxldGUgc3RhdGUuZnVuY3RbIihub2Jsb2Nrc2NvcGVkdmFyKSJdOwogICAgfQoKICAgIC8vIERvbid0IGNsZWFyIGFuZCBsZXQgaXQgcHJvcGFnYXRlIG91dCBpZiBpdCBpcyAiYnJlYWsiLCAicmV0dXJuIiBvciBzaW1pbGFyIGluIHN3aXRjaCBjYXNlCiAgICBzd2l0Y2ggKHN0YXRlLmZ1bmN0WyIodmVyYikiXSkgewogICAgY2FzZSAiYnJlYWsiOgogICAgY2FzZSAiY29udGludWUiOgogICAgY2FzZSAicmV0dXJuIjoKICAgIGNhc2UgInRocm93IjoKICAgICAgaWYgKGlzY2FzZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICBkZWZhdWx0OgogICAgICBzdGF0ZS5mdW5jdFsiKHZlcmIpIl0gPSBudWxsOwogICAgfQoKICAgIGluYmxvY2sgPSBiOwogICAgaWYgKG9yZGluYXJ5ICYmIHN0YXRlLm9wdGlvbi5ub2VtcHR5ICYmICghYSB8fCBhLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgd2FybmluZygiVzAzNSIsIHN0YXRlLnRva2Vucy5wcmV2KTsKICAgIH0KICAgIG1ldHJpY3MubmVzdGVkQmxvY2tEZXB0aCAtPSAxOwogICAgcmV0dXJuIGE7CiAgfQoKCiAgZnVuY3Rpb24gY291bnRNZW1iZXIobSkgewogICAgaWYgKG1lbWJlcnNPbmx5ICYmIHR5cGVvZiBtZW1iZXJzT25seVttXSAhPT0gImJvb2xlYW4iKSB7CiAgICAgIHdhcm5pbmcoIlcwMzYiLCBzdGF0ZS50b2tlbnMuY3VyciwgbSk7CiAgICB9CiAgICBpZiAodHlwZW9mIG1lbWJlclttXSA9PT0gIm51bWJlciIpIHsKICAgICAgbWVtYmVyW21dICs9IDE7CiAgICB9IGVsc2UgewogICAgICBtZW1iZXJbbV0gPSAxOwogICAgfQogIH0KCiAgLy8gQnVpbGQgdGhlIHN5bnRheCB0YWJsZSBieSBkZWNsYXJpbmcgdGhlIHN5bnRhY3RpYyBlbGVtZW50cyBvZiB0aGUgbGFuZ3VhZ2UuCgogIHR5cGUoIihudW1iZXIpIiwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9KTsKCiAgdHlwZSgiKHN0cmluZykiLCBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzOwogIH0pOwoKICBzdGF0ZS5zeW50YXhbIihpZGVudGlmaWVyKSJdID0gewogICAgdHlwZTogIihpZGVudGlmaWVyKSIsCiAgICBsYnA6IDAsCiAgICBpZGVudGlmaWVyOiB0cnVlLAoKICAgIG51ZDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2ID0gdGhpcy52YWx1ZTsKCiAgICAgIC8vIElmIHRoaXMgaWRlbnRpZmllciBpcyB0aGUgbG9uZSBwYXJhbWV0ZXIgdG8gYSBzaG9ydGhhbmQgImZhdCBhcnJvdyIKICAgICAgLy8gZnVuY3Rpb24gZGVmaW5pdGlvbiwgaS5lLgogICAgICAvLwogICAgICAvLyAgICAgeCA9PiB4OwogICAgICAvLwogICAgICAvLyAuLi5pdCBzaG91bGQgbm90IGJlIGNvbnNpZGVyZWQgYXMgYSB2YXJpYWJsZSBpbiB0aGUgY3VycmVudCBzY29wZS4gSXQKICAgICAgLy8gd2lsbCBiZSBhZGRlZCB0byB0aGUgc2NvcGUgb2YgdGhlIG5ldyBmdW5jdGlvbiB3aGVuIHRoZSBuZXh0IHRva2VuIGlzCiAgICAgIC8vIHBhcnNlZCwgc28gaXQgY2FuIGJlIHNhZmVseSBpZ25vcmVkIGZvciBub3cuCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIj0+IikgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBpZiAoIXN0YXRlLmZ1bmN0WyIoY29tcGFycmF5KSJdLmNoZWNrKHYpKSB7CiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5ibG9jay51c2Uodiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICBsZWQ6IGZ1bmN0aW9uKCkgewogICAgICBlcnJvcigiRTAzMyIsIHN0YXRlLnRva2Vucy5uZXh0LCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSk7CiAgICB9CiAgfTsKCiAgdmFyIGJhc2VUZW1wbGF0ZVN5bnRheCA9IHsKICAgIGlkZW50aWZpZXI6IGZhbHNlLAogICAgdGVtcGxhdGU6IHRydWUsCiAgfTsKICBzdGF0ZS5zeW50YXhbIih0ZW1wbGF0ZSkiXSA9IF8uZXh0ZW5kKHsKICAgIGxicDogMTU1LAogICAgdHlwZTogIih0ZW1wbGF0ZSkiLAogICAgbnVkOiBkb1RlbXBsYXRlTGl0ZXJhbCwKICAgIGxlZDogZG9UZW1wbGF0ZUxpdGVyYWwsCiAgICBub1N1YnN0OiBmYWxzZQogIH0sIGJhc2VUZW1wbGF0ZVN5bnRheCk7CgogIHN0YXRlLnN5bnRheFsiKHRlbXBsYXRlIG1pZGRsZSkiXSA9IF8uZXh0ZW5kKHsKICAgIGxicDogMCwKICAgIHR5cGU6ICIodGVtcGxhdGUgbWlkZGxlKSIsCiAgICBtaWRkbGU6IHRydWUsCiAgICBub1N1YnN0OiBmYWxzZQogIH0sIGJhc2VUZW1wbGF0ZVN5bnRheCk7CgogIHN0YXRlLnN5bnRheFsiKHRlbXBsYXRlIHRhaWwpIl0gPSBfLmV4dGVuZCh7CiAgICBsYnA6IDAsCiAgICB0eXBlOiAiKHRlbXBsYXRlIHRhaWwpIiwKICAgIHRhaWw6IHRydWUsCiAgICBub1N1YnN0OiBmYWxzZQogIH0sIGJhc2VUZW1wbGF0ZVN5bnRheCk7CgogIHN0YXRlLnN5bnRheFsiKG5vIHN1YnN0IHRlbXBsYXRlKSJdID0gXy5leHRlbmQoewogICAgbGJwOiAxNTUsCiAgICB0eXBlOiAiKHRlbXBsYXRlKSIsCiAgICBudWQ6IGRvVGVtcGxhdGVMaXRlcmFsLAogICAgbGVkOiBkb1RlbXBsYXRlTGl0ZXJhbCwKICAgIG5vU3Vic3Q6IHRydWUsCiAgICB0YWlsOiB0cnVlIC8vIG1hcmsgYXMgdGFpbCwgc2luY2UgaXQncyBhbHdheXMgdGhlIGxhc3QgY29tcG9uZW50CiAgfSwgYmFzZVRlbXBsYXRlU3ludGF4KTsKCiAgdHlwZSgiKHJlZ2V4cCkiLCBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzOwogIH0pOwoKICAvLyBFQ01BU2NyaXB0IHBhcnNlcgoKICBkZWxpbSgiKGVuZGxpbmUpIik7CiAgKGZ1bmN0aW9uKHgpIHsKICAgIHgubGluZSA9IHguZnJvbSA9IDA7CiAgfSkoZGVsaW0oIihiZWdpbikiKSk7CiAgZGVsaW0oIihlbmQpIikucmVhY2ggPSB0cnVlOwogIGRlbGltKCIoZXJyb3IpIikucmVhY2ggPSB0cnVlOwogIGRlbGltKCJ9IikucmVhY2ggPSB0cnVlOwogIGRlbGltKCIpIik7CiAgZGVsaW0oIl0iKTsKICBkZWxpbSgiXCIiKS5yZWFjaCA9IHRydWU7CiAgZGVsaW0oIiciKS5yZWFjaCA9IHRydWU7CiAgZGVsaW0oIjsiKTsKICBkZWxpbSgiOiIpLnJlYWNoID0gdHJ1ZTsKICBkZWxpbSgiIyIpOwoKICByZXNlcnZlKCJlbHNlIik7CiAgcmVzZXJ2ZSgiY2FzZSIpLnJlYWNoID0gdHJ1ZTsKICByZXNlcnZlKCJjYXRjaCIpOwogIHJlc2VydmUoImRlZmF1bHQiKS5yZWFjaCA9IHRydWU7CiAgcmVzZXJ2ZSgiZmluYWxseSIpOwogIHJlc2VydmV2YXIoImFyZ3VtZW50cyIsIGZ1bmN0aW9uKHgpIHsKICAgIGlmIChzdGF0ZS5pc1N0cmljdCgpICYmIHN0YXRlLmZ1bmN0WyIoZ2xvYmFsKSJdKSB7CiAgICAgIHdhcm5pbmcoIkUwMDgiLCB4KTsKICAgIH0KICB9KTsKICByZXNlcnZldmFyKCJldmFsIik7CiAgcmVzZXJ2ZXZhcigiZmFsc2UiKTsKICByZXNlcnZldmFyKCJJbmZpbml0eSIpOwogIHJlc2VydmV2YXIoIm51bGwiKTsKICByZXNlcnZldmFyKCJ0aGlzIiwgZnVuY3Rpb24oeCkgewogICAgaWYgKHN0YXRlLmlzU3RyaWN0KCkgJiYgIWlzTWV0aG9kKCkgJiYKICAgICAgICAhc3RhdGUub3B0aW9uLnZhbGlkdGhpcyAmJiAoKHN0YXRlLmZ1bmN0WyIoc3RhdGVtZW50KSJdICYmCiAgICAgICAgc3RhdGUuZnVuY3RbIihuYW1lKSJdLmNoYXJBdCgwKSA+ICJaIikgfHwgc3RhdGUuZnVuY3RbIihnbG9iYWwpIl0pKSB7CiAgICAgIHdhcm5pbmcoIlcwNDAiLCB4KTsKICAgIH0KICB9KTsKICByZXNlcnZldmFyKCJ0cnVlIik7CiAgcmVzZXJ2ZXZhcigidW5kZWZpbmVkIik7CgogIGFzc2lnbm9wKCI9IiwgImFzc2lnbiIsIDIwKTsKICBhc3NpZ25vcCgiKz0iLCAiYXNzaWduYWRkIiwgMjApOwogIGFzc2lnbm9wKCItPSIsICJhc3NpZ25zdWIiLCAyMCk7CiAgYXNzaWdub3AoIio9IiwgImFzc2lnbm11bHQiLCAyMCk7CiAgYXNzaWdub3AoIi89IiwgImFzc2lnbmRpdiIsIDIwKS5udWQgPSBmdW5jdGlvbigpIHsKICAgIGVycm9yKCJFMDE0Iik7CiAgfTsKICBhc3NpZ25vcCgiJT0iLCAiYXNzaWdubW9kIiwgMjApOwoKICBiaXR3aXNlYXNzaWdub3AoIiY9Iik7CiAgYml0d2lzZWFzc2lnbm9wKCJ8PSIpOwogIGJpdHdpc2Vhc3NpZ25vcCgiXj0iKTsKICBiaXR3aXNlYXNzaWdub3AoIjw8PSIpOwogIGJpdHdpc2Vhc3NpZ25vcCgiPj49Iik7CiAgYml0d2lzZWFzc2lnbm9wKCI+Pj49Iik7CiAgaW5maXgoIiwiLCBmdW5jdGlvbihsZWZ0LCB0aGF0KSB7CiAgICB2YXIgZXhwcjsKICAgIHRoYXQuZXhwcnMgPSBbbGVmdF07CgogICAgaWYgKHN0YXRlLm9wdGlvbi5ub2NvbW1hKSB7CiAgICAgIHdhcm5pbmcoIlcxMjciKTsKICAgIH0KCiAgICBpZiAoIXBhcnNlQ29tbWEoeyBwZWVrOiB0cnVlIH0pKSB7CiAgICAgIHJldHVybiB0aGF0OwogICAgfQogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKCEoZXhwciA9IGV4cHJlc3Npb24oMTApKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoYXQuZXhwcnMucHVzaChleHByKTsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlICE9PSAiLCIgfHwgIXBhcnNlQ29tbWEoKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhhdDsKICB9LCAxMCwgdHJ1ZSk7CgogIGluZml4KCI/IiwgZnVuY3Rpb24obGVmdCwgdGhhdCkgewogICAgaW5jcmVhc2VDb21wbGV4aXR5Q291bnQoKTsKICAgIHRoYXQubGVmdCA9IGxlZnQ7CiAgICB0aGF0LnJpZ2h0ID0gZXhwcmVzc2lvbigxMCk7CiAgICBhZHZhbmNlKCI6Iik7CiAgICB0aGF0WyJlbHNlIl0gPSBleHByZXNzaW9uKDEwKTsKICAgIHJldHVybiB0aGF0OwogIH0sIDMwKTsKCiAgdmFyIG9yUHJlY2VuZGVuY2UgPSA0MDsKICBpbmZpeCgifHwiLCBmdW5jdGlvbihsZWZ0LCB0aGF0KSB7CiAgICBpbmNyZWFzZUNvbXBsZXhpdHlDb3VudCgpOwogICAgdGhhdC5sZWZ0ID0gbGVmdDsKICAgIHRoYXQucmlnaHQgPSBleHByZXNzaW9uKG9yUHJlY2VuZGVuY2UpOwogICAgcmV0dXJuIHRoYXQ7CiAgfSwgb3JQcmVjZW5kZW5jZSk7CiAgaW5maXgoIiYmIiwgImFuZCIsIDUwKTsKICBiaXR3aXNlKCJ8IiwgImJpdG9yIiwgNzApOwogIGJpdHdpc2UoIl4iLCAiYml0eG9yIiwgODApOwogIGJpdHdpc2UoIiYiLCAiYml0YW5kIiwgOTApOwogIHJlbGF0aW9uKCI9PSIsIGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7CiAgICB2YXIgZXFudWxsID0gc3RhdGUub3B0aW9uLmVxbnVsbCAmJgogICAgICAoKGxlZnQgJiYgbGVmdC52YWx1ZSkgPT09ICJudWxsIiB8fCAocmlnaHQgJiYgcmlnaHQudmFsdWUpID09PSAibnVsbCIpOwoKICAgIHN3aXRjaCAodHJ1ZSkgewogICAgICBjYXNlICFlcW51bGwgJiYgc3RhdGUub3B0aW9uLmVxZXFlcToKICAgICAgICB0aGlzLmZyb20gPSB0aGlzLmNoYXJhY3RlcjsKICAgICAgICB3YXJuaW5nKCJXMTE2IiwgdGhpcywgIj09PSIsICI9PSIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIGlzUG9vclJlbGF0aW9uKGxlZnQpOgogICAgICAgIHdhcm5pbmcoIlcwNDEiLCB0aGlzLCAiPT09IiwgbGVmdC52YWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgaXNQb29yUmVsYXRpb24ocmlnaHQpOgogICAgICAgIHdhcm5pbmcoIlcwNDEiLCB0aGlzLCAiPT09IiwgcmlnaHQudmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIGlzVHlwb1R5cGVvZihyaWdodCwgbGVmdCwgc3RhdGUpOgogICAgICAgIHdhcm5pbmcoIlcxMjIiLCB0aGlzLCByaWdodC52YWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgaXNUeXBvVHlwZW9mKGxlZnQsIHJpZ2h0LCBzdGF0ZSk6CiAgICAgICAgd2FybmluZygiVzEyMiIsIHRoaXMsIGxlZnQudmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0pOwogIHJlbGF0aW9uKCI9PT0iLCBmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgaWYgKGlzVHlwb1R5cGVvZihyaWdodCwgbGVmdCwgc3RhdGUpKSB7CiAgICAgIHdhcm5pbmcoIlcxMjIiLCB0aGlzLCByaWdodC52YWx1ZSk7CiAgICB9IGVsc2UgaWYgKGlzVHlwb1R5cGVvZihsZWZ0LCByaWdodCwgc3RhdGUpKSB7CiAgICAgIHdhcm5pbmcoIlcxMjIiLCB0aGlzLCBsZWZ0LnZhbHVlKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0pOwogIHJlbGF0aW9uKCIhPSIsIGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7CiAgICB2YXIgZXFudWxsID0gc3RhdGUub3B0aW9uLmVxbnVsbCAmJgogICAgICAgICgobGVmdCAmJiBsZWZ0LnZhbHVlKSA9PT0gIm51bGwiIHx8IChyaWdodCAmJiByaWdodC52YWx1ZSkgPT09ICJudWxsIik7CgogICAgaWYgKCFlcW51bGwgJiYgc3RhdGUub3B0aW9uLmVxZXFlcSkgewogICAgICB0aGlzLmZyb20gPSB0aGlzLmNoYXJhY3RlcjsKICAgICAgd2FybmluZygiVzExNiIsIHRoaXMsICIhPT0iLCAiIT0iKTsKICAgIH0gZWxzZSBpZiAoaXNQb29yUmVsYXRpb24obGVmdCkpIHsKICAgICAgd2FybmluZygiVzA0MSIsIHRoaXMsICIhPT0iLCBsZWZ0LnZhbHVlKTsKICAgIH0gZWxzZSBpZiAoaXNQb29yUmVsYXRpb24ocmlnaHQpKSB7CiAgICAgIHdhcm5pbmcoIlcwNDEiLCB0aGlzLCAiIT09IiwgcmlnaHQudmFsdWUpOwogICAgfSBlbHNlIGlmIChpc1R5cG9UeXBlb2YocmlnaHQsIGxlZnQsIHN0YXRlKSkgewogICAgICB3YXJuaW5nKCJXMTIyIiwgdGhpcywgcmlnaHQudmFsdWUpOwogICAgfSBlbHNlIGlmIChpc1R5cG9UeXBlb2YobGVmdCwgcmlnaHQsIHN0YXRlKSkgewogICAgICB3YXJuaW5nKCJXMTIyIiwgdGhpcywgbGVmdC52YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KTsKICByZWxhdGlvbigiIT09IiwgZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsKICAgIGlmIChpc1R5cG9UeXBlb2YocmlnaHQsIGxlZnQsIHN0YXRlKSkgewogICAgICB3YXJuaW5nKCJXMTIyIiwgdGhpcywgcmlnaHQudmFsdWUpOwogICAgfSBlbHNlIGlmIChpc1R5cG9UeXBlb2YobGVmdCwgcmlnaHQsIHN0YXRlKSkgewogICAgICB3YXJuaW5nKCJXMTIyIiwgdGhpcywgbGVmdC52YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KTsKICByZWxhdGlvbigiPCIpOwogIHJlbGF0aW9uKCI+Iik7CiAgcmVsYXRpb24oIjw9Iik7CiAgcmVsYXRpb24oIj49Iik7CiAgYml0d2lzZSgiPDwiLCAic2hpZnRsZWZ0IiwgMTIwKTsKICBiaXR3aXNlKCI+PiIsICJzaGlmdHJpZ2h0IiwgMTIwKTsKICBiaXR3aXNlKCI+Pj4iLCAic2hpZnRyaWdodHVuc2lnbmVkIiwgMTIwKTsKICBpbmZpeCgiaW4iLCAiaW4iLCAxMjApOwogIGluZml4KCJpbnN0YW5jZW9mIiwgZnVuY3Rpb24obGVmdCwgdG9rZW4pIHsKICAgIHZhciByaWdodDsKICAgIHZhciBzY29wZSA9IHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl07CiAgICB0b2tlbi5sZWZ0ID0gbGVmdDsKICAgIHRva2VuLnJpZ2h0ID0gcmlnaHQgPSBleHByZXNzaW9uKDEyMCk7CgogICAgLy8gVGhpcyBjb25kaXRpb24gcmVmbGVjdHMgYSBzeW50YXggZXJyb3Igd2hpY2ggd2lsbCBiZSByZXBvcnRlZCBieSB0aGUKICAgIC8vIGBleHByZXNzaW9uYCBmdW5jdGlvbi4KICAgIGlmICghcmlnaHQpIHsKICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIGlmIChyaWdodC5pZCA9PT0gIihudW1iZXIpIiB8fAogICAgICAgIHJpZ2h0LmlkID09PSAiKHN0cmluZykiIHx8CiAgICAgICAgcmlnaHQudmFsdWUgPT09ICJudWxsIiB8fAogICAgICAgIChyaWdodC52YWx1ZSA9PT0gInVuZGVmaW5lZCIgJiYgIXNjb3BlLmhhcygidW5kZWZpbmVkIikpIHx8CiAgICAgICAgcmlnaHQuYXJpdHkgPT09ICJ1bmFyeSIgfHwKICAgICAgICByaWdodC5pZCA9PT0gInsiIHx8CiAgICAgICAgKHJpZ2h0LmlkID09PSAiWyIgJiYgIXJpZ2h0LnJpZ2h0KSB8fAogICAgICAgIHJpZ2h0LmlkID09PSAiKHJlZ2V4cCkiIHx8CiAgICAgICAgKHJpZ2h0LmlkID09PSAiKHRlbXBsYXRlKSIgJiYgIXJpZ2h0LnRhZykpIHsKICAgICAgZXJyb3IoIkUwNjAiKTsKICAgIH0KCiAgICBpZiAocmlnaHQuaWQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgd2FybmluZygiVzEzOSIpOwogICAgfQoKICAgIHJldHVybiB0b2tlbjsKICB9LCAxMjApOwogIGluZml4KCIrIiwgZnVuY3Rpb24obGVmdCwgdGhhdCkgewogICAgdmFyIHJpZ2h0OwogICAgdGhhdC5sZWZ0ID0gbGVmdDsKICAgIHRoYXQucmlnaHQgPSByaWdodCA9IGV4cHJlc3Npb24oMTMwKTsKCiAgICBpZiAobGVmdCAmJiByaWdodCAmJiBsZWZ0LmlkID09PSAiKHN0cmluZykiICYmIHJpZ2h0LmlkID09PSAiKHN0cmluZykiKSB7CiAgICAgIGxlZnQudmFsdWUgKz0gcmlnaHQudmFsdWU7CiAgICAgIGxlZnQuY2hhcmFjdGVyID0gcmlnaHQuY2hhcmFjdGVyOwogICAgICBpZiAoIXN0YXRlLm9wdGlvbi5zY3JpcHR1cmwgJiYgcmVnLmphdmFzY3JpcHRVUkwudGVzdChsZWZ0LnZhbHVlKSkgewogICAgICAgIHdhcm5pbmcoIlcwNTAiLCBsZWZ0KTsKICAgICAgfQogICAgICByZXR1cm4gbGVmdDsKICAgIH0KCiAgICByZXR1cm4gdGhhdDsKICB9LCAxMzApOwogIHByZWZpeCgiKyIsICJudW0iKTsKICBwcmVmaXgoIisrKyIsIGZ1bmN0aW9uKCkgewogICAgd2FybmluZygiVzAwNyIpOwogICAgdGhpcy5hcml0eSA9ICJ1bmFyeSI7CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxNTApOwogICAgcmV0dXJuIHRoaXM7CiAgfSk7CiAgaW5maXgoIisrKyIsIGZ1bmN0aW9uKGxlZnQpIHsKICAgIHdhcm5pbmcoIlcwMDciKTsKICAgIHRoaXMubGVmdCA9IGxlZnQ7CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxMzApOwogICAgcmV0dXJuIHRoaXM7CiAgfSwgMTMwKTsKICBpbmZpeCgiLSIsICJzdWIiLCAxMzApOwogIHByZWZpeCgiLSIsICJuZWciKTsKICBwcmVmaXgoIi0tLSIsIGZ1bmN0aW9uKCkgewogICAgd2FybmluZygiVzAwNiIpOwogICAgdGhpcy5hcml0eSA9ICJ1bmFyeSI7CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxNTApOwogICAgcmV0dXJuIHRoaXM7CiAgfSk7CiAgaW5maXgoIi0tLSIsIGZ1bmN0aW9uKGxlZnQpIHsKICAgIHdhcm5pbmcoIlcwMDYiKTsKICAgIHRoaXMubGVmdCA9IGxlZnQ7CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxMzApOwogICAgcmV0dXJuIHRoaXM7CiAgfSwgMTMwKTsKICBpbmZpeCgiKiIsICJtdWx0IiwgMTQwKTsKICBpbmZpeCgiLyIsICJkaXYiLCAxNDApOwogIGluZml4KCIlIiwgIm1vZCIsIDE0MCk7CgogIHN1ZmZpeCgiKysiKTsKICBwcmVmaXgoIisrIiwgInByZWluYyIpOwogIHN0YXRlLnN5bnRheFsiKysiXS5leHBzID0gdHJ1ZTsKICBzdGF0ZS5zeW50YXhbIisrIl0ubHRCb3VuZGFyeSA9ICJiZWZvcmUiOwoKICBzdWZmaXgoIi0tIik7CiAgcHJlZml4KCItLSIsICJwcmVkZWMiKTsKICBzdGF0ZS5zeW50YXhbIi0tIl0uZXhwcyA9IHRydWU7CiAgc3RhdGUuc3ludGF4WyItLSJdLmx0Qm91bmRhcnkgPSAiYmVmb3JlIjsKCiAgcHJlZml4KCJkZWxldGUiLCBmdW5jdGlvbigpIHsKICAgIHZhciBwID0gZXhwcmVzc2lvbigxMCk7CiAgICBpZiAoIXApIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKHAuaWQgIT09ICIuIiAmJiBwLmlkICE9PSAiWyIpIHsKICAgICAgd2FybmluZygiVzA1MSIpOwogICAgfQogICAgdGhpcy5maXJzdCA9IHA7CgogICAgLy8gVGhlIGBkZWxldGVgIG9wZXJhdG9yIGFjY2VwdHMgdW5yZXNvbHZhYmxlIHJlZmVyZW5jZXMgd2hlbiBub3QgaW4gc3RyaWN0CiAgICAvLyBtb2RlLCBzbyB0aGUgb3BlcmFuZCBtYXkgYmUgdW5kZWZpbmVkLgogICAgaWYgKHAuaWRlbnRpZmllciAmJiAhc3RhdGUuaXNTdHJpY3QoKSkgewogICAgICBwLmZvcmdpdmVVbmRlZiA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KS5leHBzID0gdHJ1ZTsKCiAgcHJlZml4KCJ+IiwgZnVuY3Rpb24oKSB7CiAgICBpZiAoc3RhdGUub3B0aW9uLmJpdHdpc2UpIHsKICAgICAgd2FybmluZygiVzAxNiIsIHRoaXMsICJ+Iik7CiAgICB9CiAgICB0aGlzLmFyaXR5ID0gInVuYXJ5IjsKICAgIHRoaXMucmlnaHQgPSBleHByZXNzaW9uKDE1MCk7CiAgICByZXR1cm4gdGhpczsKICB9KTsKCiAgcHJlZml4KCIuLi4iLCBmdW5jdGlvbigpIHsKICAgIGlmICghc3RhdGUuaW5FUzYodHJ1ZSkpIHsKICAgICAgd2FybmluZygiVzExOSIsIHRoaXMsICJzcHJlYWQvcmVzdCBvcGVyYXRvciIsICI2Iik7CiAgICB9CgogICAgLy8gVE9ETzogQWxsb3cgYWxsIEFzc2lnbm1lbnRFeHByZXNzaW9uCiAgICAvLyBvbmNlIHBhcnNpbmcgcGVybWl0cy4KICAgIC8vCiAgICAvLyBIb3cgdG8gaGFuZGxlIGVnLiBudW1iZXIsIGJvb2xlYW4gd2hlbiB0aGUgYnVpbHQtaW4KICAgIC8vIHByb3RvdHlwZSBvZiBtYXkgaGF2ZSBhbiBAQGl0ZXJhdG9yIGRlZmluaXRpb24/CiAgICAvLwogICAgLy8gTnVtYmVyLnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKiAoKSB7CiAgICAvLyAgIHlpZWxkIHRoaXMudmFsdWVPZigpOwogICAgLy8gfTsKICAgIC8vCiAgICAvLyB2YXIgYSA9IFsgLi4uMSBdOwogICAgLy8gY29uc29sZS5sb2coYSk7IC8vIFsxXTsKICAgIC8vCiAgICAvLyBmb3IgKGxldCBuIG9mIFsuLi4xMF0pIHsKICAgIC8vICAgIGNvbnNvbGUubG9nKG4pOwogICAgLy8gfQogICAgLy8gLy8gMTAKICAgIC8vCiAgICAvLwogICAgLy8gQm9vbGVhbi5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICogKCkgewogICAgLy8gICB5aWVsZCB0aGlzLnZhbHVlT2YoKTsKICAgIC8vIH07CiAgICAvLwogICAgLy8gdmFyIGEgPSBbIC4uLnRydWUgXTsKICAgIC8vIGNvbnNvbGUubG9nKGEpOyAvLyBbdHJ1ZV07CiAgICAvLwogICAgLy8gZm9yIChsZXQgbiBvZiBbLi4uZmFsc2VdKSB7CiAgICAvLyAgICBjb25zb2xlLmxvZyhuKTsKICAgIC8vIH0KICAgIC8vIC8vIGZhbHNlCiAgICAvLwogICAgaWYgKCFzdGF0ZS50b2tlbnMubmV4dC5pZGVudGlmaWVyICYmCiAgICAgICAgc3RhdGUudG9rZW5zLm5leHQudHlwZSAhPT0gIihzdHJpbmcpIiAmJgogICAgICAgICAgIWNoZWNrUHVuY3R1YXRvcnMoc3RhdGUudG9rZW5zLm5leHQsIFsiWyIsICIoIl0pKSB7CgogICAgICBlcnJvcigiRTAzMCIsIHN0YXRlLnRva2Vucy5uZXh0LCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSk7CiAgICB9CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxNTApOwogICAgcmV0dXJuIHRoaXM7CiAgfSk7CgogIHByZWZpeCgiISIsIGZ1bmN0aW9uKCkgewogICAgdGhpcy5hcml0eSA9ICJ1bmFyeSI7CiAgICB0aGlzLnJpZ2h0ID0gZXhwcmVzc2lvbigxNTApOwoKICAgIGlmICghdGhpcy5yaWdodCkgeyAvLyAnIScgZm9sbG93ZWQgYnkgbm90aGluZz8gR2l2ZSB1cC4KICAgICAgcXVpdCgiRTA0MSIsIHRoaXMpOwogICAgfQoKICAgIGlmIChiYW5nW3RoaXMucmlnaHQuaWRdID09PSB0cnVlKSB7CiAgICAgIHdhcm5pbmcoIlcwMTgiLCB0aGlzLCAiISIpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfSk7CgogIHByZWZpeCgidHlwZW9mIiwgKGZ1bmN0aW9uKCkgewogICAgdmFyIHAgPSBleHByZXNzaW9uKDE1MCk7CiAgICB0aGlzLmZpcnN0ID0gdGhpcy5yaWdodCA9IHA7CgogICAgaWYgKCFwKSB7IC8vICd0eXBlb2YnIGZvbGxvd2VkIGJ5IG5vdGhpbmc/IEdpdmUgdXAuCiAgICAgIHF1aXQoIkUwNDEiLCB0aGlzKTsKICAgIH0KCiAgICAvLyBUaGUgYHR5cGVvZmAgb3BlcmF0b3IgYWNjZXB0cyB1bnJlc29sdmFibGUgcmVmZXJlbmNlcywgc28gdGhlIG9wZXJhbmQKICAgIC8vIG1heSBiZSB1bmRlZmluZWQuCiAgICBpZiAocC5pZGVudGlmaWVyKSB7CiAgICAgIHAuZm9yZ2l2ZVVuZGVmID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0pKTsKICBwcmVmaXgoIm5ldyIsIGZ1bmN0aW9uKCkgewogICAgdmFyIG1wID0gbWV0YVByb3BlcnR5KCJ0YXJnZXQiLCBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFzdGF0ZS5pbkVTNih0cnVlKSkgewogICAgICAgIHdhcm5pbmcoIlcxMTkiLCBzdGF0ZS50b2tlbnMucHJldiwgIm5ldy50YXJnZXQiLCAiNiIpOwogICAgICB9CiAgICAgIHZhciBpbkZ1bmN0aW9uLCBjID0gc3RhdGUuZnVuY3Q7CiAgICAgIHdoaWxlIChjKSB7CiAgICAgICAgaW5GdW5jdGlvbiA9ICFjWyIoZ2xvYmFsKSJdOwogICAgICAgIGlmICghY1siKGFycm93KSJdKSB7IGJyZWFrOyB9CiAgICAgICAgYyA9IGNbIihjb250ZXh0KSJdOwogICAgICB9CiAgICAgIGlmICghaW5GdW5jdGlvbikgewogICAgICAgIHdhcm5pbmcoIlcxMzYiLCBzdGF0ZS50b2tlbnMucHJldiwgIm5ldy50YXJnZXQiKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAobXApIHsgcmV0dXJuIG1wOyB9CgogICAgdmFyIGMgPSBleHByZXNzaW9uKDE1NSksIGk7CiAgICBpZiAoYyAmJiBjLmlkICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgIGlmIChjLmlkZW50aWZpZXIpIHsKICAgICAgICBjWyJuZXciXSA9IHRydWU7CiAgICAgICAgc3dpdGNoIChjLnZhbHVlKSB7CiAgICAgICAgY2FzZSAiTnVtYmVyIjoKICAgICAgICBjYXNlICJTdHJpbmciOgogICAgICAgIGNhc2UgIkJvb2xlYW4iOgogICAgICAgIGNhc2UgIk1hdGgiOgogICAgICAgIGNhc2UgIkpTT04iOgogICAgICAgICAgd2FybmluZygiVzA1MyIsIHN0YXRlLnRva2Vucy5wcmV2LCBjLnZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlN5bWJvbCI6CiAgICAgICAgICBpZiAoc3RhdGUuaW5FUzYoKSkgewogICAgICAgICAgICB3YXJuaW5nKCJXMDUzIiwgc3RhdGUudG9rZW5zLnByZXYsIGMudmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRnVuY3Rpb24iOgogICAgICAgICAgaWYgKCFzdGF0ZS5vcHRpb24uZXZpbCkgewogICAgICAgICAgICB3YXJuaW5nKCJXMDU0Iik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJEYXRlIjoKICAgICAgICBjYXNlICJSZWdFeHAiOgogICAgICAgIGNhc2UgInRoaXMiOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChjLmlkICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGkgPSBjLnZhbHVlLnN1YnN0cigwLCAxKTsKICAgICAgICAgICAgaWYgKHN0YXRlLm9wdGlvbi5uZXdjYXAgJiYgKGkgPCAiQSIgfHwgaSA+ICJaIikgJiYKICAgICAgICAgICAgICAhc3RhdGUuZnVuY3RbIihzY29wZSkiXS5pc1ByZWRlZmluZWQoYy52YWx1ZSkpIHsKICAgICAgICAgICAgICB3YXJuaW5nKCJXMDU1Iiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjLmlkICE9PSAiLiIgJiYgYy5pZCAhPT0gIlsiICYmIGMuaWQgIT09ICIoIikgewogICAgICAgICAgd2FybmluZygiVzA1NiIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICghc3RhdGUub3B0aW9uLnN1cGVybmV3KQogICAgICAgIHdhcm5pbmcoIlcwNTciLCB0aGlzKTsKICAgIH0KICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIigiICYmICFzdGF0ZS5vcHRpb24uc3VwZXJuZXcpIHsKICAgICAgd2FybmluZygiVzA1OCIsIHN0YXRlLnRva2Vucy5jdXJyLCBzdGF0ZS50b2tlbnMuY3Vyci52YWx1ZSk7CiAgICB9CiAgICB0aGlzLmZpcnN0ID0gdGhpcy5yaWdodCA9IGM7CiAgICByZXR1cm4gdGhpczsKICB9KTsKICBzdGF0ZS5zeW50YXhbIm5ldyJdLmV4cHMgPSB0cnVlOwoKICBwcmVmaXgoInZvaWQiKS5leHBzID0gdHJ1ZTsKCiAgaW5maXgoIi4iLCBmdW5jdGlvbihsZWZ0LCB0aGF0KSB7CiAgICB2YXIgbSA9IGlkZW50aWZpZXIoZmFsc2UsIHRydWUpOwoKICAgIGlmICh0eXBlb2YgbSA9PT0gInN0cmluZyIpIHsKICAgICAgY291bnRNZW1iZXIobSk7CiAgICB9CgogICAgdGhhdC5sZWZ0ID0gbGVmdDsKICAgIHRoYXQucmlnaHQgPSBtOwoKICAgIGlmIChtICYmIG0gPT09ICJoYXNPd25Qcm9wZXJ0eSIgJiYgc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICI9IikgewogICAgICB3YXJuaW5nKCJXMDAxIik7CiAgICB9CgogICAgaWYgKGxlZnQgJiYgbGVmdC52YWx1ZSA9PT0gImFyZ3VtZW50cyIgJiYgKG0gPT09ICJjYWxsZWUiIHx8IG0gPT09ICJjYWxsZXIiKSkgewogICAgICBpZiAoc3RhdGUub3B0aW9uLm5vYXJnKQogICAgICAgIHdhcm5pbmcoIlcwNTkiLCBsZWZ0LCBtKTsKICAgICAgZWxzZSBpZiAoc3RhdGUuaXNTdHJpY3QoKSkKICAgICAgICBlcnJvcigiRTAwOCIpOwogICAgfSBlbHNlIGlmICghc3RhdGUub3B0aW9uLmV2aWwgJiYgbGVmdCAmJiBsZWZ0LnZhbHVlID09PSAiZG9jdW1lbnQiICYmCiAgICAgICAgKG0gPT09ICJ3cml0ZSIgfHwgbSA9PT0gIndyaXRlbG4iKSkgewogICAgICB3YXJuaW5nKCJXMDYwIiwgbGVmdCk7CiAgICB9CgogICAgaWYgKCFzdGF0ZS5vcHRpb24uZXZpbCAmJiAobSA9PT0gImV2YWwiIHx8IG0gPT09ICJleGVjU2NyaXB0IikpIHsKICAgICAgaWYgKGlzR2xvYmFsRXZhbChsZWZ0LCBzdGF0ZSkpIHsKICAgICAgICB3YXJuaW5nKCJXMDYxIik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhhdDsKICB9LCAxNjAsIHRydWUpOwoKICBpbmZpeCgiKCIsIGZ1bmN0aW9uKGxlZnQsIHRoYXQpIHsKICAgIGlmIChzdGF0ZS5vcHRpb24uaW1tZWQgJiYgbGVmdCAmJiAhbGVmdC5pbW1lZCAmJiBsZWZ0LmlkID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHdhcm5pbmcoIlcwNjIiKTsKICAgIH0KCiAgICB2YXIgbiA9IDA7CiAgICB2YXIgcCA9IFtdOwoKICAgIGlmIChsZWZ0KSB7CiAgICAgIGlmIChsZWZ0LnR5cGUgPT09ICIoaWRlbnRpZmllcikiKSB7CiAgICAgICAgaWYgKGxlZnQudmFsdWUubWF0Y2goL15bQS1aXShbQS1aMC05XyRdKlthLXpdW0EtWmEtejAtOV8kXSopPyQvKSkgewogICAgICAgICAgaWYgKCJBcnJheSBOdW1iZXIgU3RyaW5nIEJvb2xlYW4gRGF0ZSBPYmplY3QgRXJyb3IgU3ltYm9sIi5pbmRleE9mKGxlZnQudmFsdWUpID09PSAtMSkgewogICAgICAgICAgICBpZiAobGVmdC52YWx1ZSA9PT0gIk1hdGgiKSB7CiAgICAgICAgICAgICAgd2FybmluZygiVzA2MyIsIGxlZnQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLm9wdGlvbi5uZXdjYXApIHsKICAgICAgICAgICAgICB3YXJuaW5nKCJXMDY0IiwgbGVmdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIpIikgewogICAgICBmb3IgKDs7KSB7CiAgICAgICAgcFtwLmxlbmd0aF0gPSBleHByZXNzaW9uKDEwKTsKICAgICAgICBuICs9IDE7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiLCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBwYXJzZUNvbW1hKCk7CiAgICAgIH0KICAgIH0KCiAgICBhZHZhbmNlKCIpIik7CgogICAgaWYgKHR5cGVvZiBsZWZ0ID09PSAib2JqZWN0IikgewogICAgICBpZiAoIXN0YXRlLmluRVM1KCkgJiYgbGVmdC52YWx1ZSA9PT0gInBhcnNlSW50IiAmJiBuID09PSAxKSB7CiAgICAgICAgd2FybmluZygiVzA2NSIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgfQogICAgICBpZiAoIXN0YXRlLm9wdGlvbi5ldmlsKSB7CiAgICAgICAgaWYgKGxlZnQudmFsdWUgPT09ICJldmFsIiB8fCBsZWZ0LnZhbHVlID09PSAiRnVuY3Rpb24iIHx8CiAgICAgICAgICAgIGxlZnQudmFsdWUgPT09ICJleGVjU2NyaXB0IikgewogICAgICAgICAgd2FybmluZygiVzA2MSIsIGxlZnQpOwoKICAgICAgICAgIC8vIFRoaXMgY29uZGl0aW9uYWwgZXhwcmVzc2lvbiB3YXMgaW5pdGlhbGx5IGltcGxlbWVudGVkIHdpdGggYSB0eXBvCiAgICAgICAgICAvLyB3aGljaCBwcmV2ZW50ZWQgdGhlIGJyYW5jaCdzIGV4ZWN1dGlvbiBpbiBhbGwgY2FzZXMuIFdoaWxlCiAgICAgICAgICAvLyBlbmFibGluZyB0aGUgY29kZSB3aWxsIHByb2R1Y2UgYmVoYXZpb3IgdGhhdCBpcyBjb25zaXN0ZW50IHdpdGgKICAgICAgICAgIC8vIHRoZSBvdGhlciBmb3JtcyBvZiBjb2RlIGV2YWx1YXRpb24gdGhhdCBmb2xsb3csIHN1Y2ggYSBjaGFuZ2UgaXMKICAgICAgICAgIC8vIGFsc28gdGVjaG5pY2FsbHkgaW5jb21wYXRhYmxlIHdpdGggcHJpb3IgdmVyc2lvbnMgb2YgSlNIaW50IChkdWUKICAgICAgICAgIC8vIHRvIHRoZSBmYWN0IHRoYXQgdGhlIGJlaGF2aW9yIHdhcyBuZXZlciBmb3JtYWxseSBkb2N1bWVudGVkKS4gVGhpcwogICAgICAgICAgLy8gYnJhbmNoIHNob3VsZCBiZSBlbmFibGVkIGFzIHBhcnQgb2YgYSBtYWpvciByZWxlYXNlLgogICAgICAgICAgLy9pZiAocFswXSAmJiBwWzBdLmlkID09PSAiKHN0cmluZykiKSB7CiAgICAgICAgICAvLyAgYWRkRXZhbENvZGUobGVmdCwgcFswXSk7CiAgICAgICAgICAvL30KICAgICAgICB9IGVsc2UgaWYgKHBbMF0gJiYgcFswXS5pZCA9PT0gIihzdHJpbmcpIiAmJgogICAgICAgICAgICAgKGxlZnQudmFsdWUgPT09ICJzZXRUaW1lb3V0IiB8fAogICAgICAgICAgICBsZWZ0LnZhbHVlID09PSAic2V0SW50ZXJ2YWwiKSkgewogICAgICAgICAgd2FybmluZygiVzA2NiIsIGxlZnQpOwogICAgICAgICAgYWRkRXZhbENvZGUobGVmdCwgcFswXSk7CgogICAgICAgIC8vIHdpbmRvdy5zZXRUaW1lb3V0L3NldEludGVydmFsCiAgICAgICAgfSBlbHNlIGlmIChwWzBdICYmIHBbMF0uaWQgPT09ICIoc3RyaW5nKSIgJiYKICAgICAgICAgICAgIGxlZnQudmFsdWUgPT09ICIuIiAmJgogICAgICAgICAgICAgbGVmdC5sZWZ0LnZhbHVlID09PSAid2luZG93IiAmJgogICAgICAgICAgICAgKGxlZnQucmlnaHQgPT09ICJzZXRUaW1lb3V0IiB8fAogICAgICAgICAgICBsZWZ0LnJpZ2h0ID09PSAic2V0SW50ZXJ2YWwiKSkgewogICAgICAgICAgd2FybmluZygiVzA2NiIsIGxlZnQpOwogICAgICAgICAgYWRkRXZhbENvZGUobGVmdCwgcFswXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghbGVmdC5pZGVudGlmaWVyICYmIGxlZnQuaWQgIT09ICIuIiAmJiBsZWZ0LmlkICE9PSAiWyIgJiYgbGVmdC5pZCAhPT0gIj0+IiAmJgogICAgICAgICAgbGVmdC5pZCAhPT0gIigiICYmIGxlZnQuaWQgIT09ICImJiIgJiYgbGVmdC5pZCAhPT0gInx8IiAmJiBsZWZ0LmlkICE9PSAiPyIgJiYKICAgICAgICAgICEoc3RhdGUuaW5FUzYoKSAmJiBsZWZ0WyIobmFtZSkiXSkpIHsKICAgICAgICB3YXJuaW5nKCJXMDY3IiwgdGhhdCk7CiAgICAgIH0KICAgIH0KCiAgICB0aGF0LmxlZnQgPSBsZWZ0OwogICAgcmV0dXJuIHRoYXQ7CiAgfSwgMTU1LCB0cnVlKS5leHBzID0gdHJ1ZTsKCiAgcHJlZml4KCIoIiwgZnVuY3Rpb24ocmJwKSB7CiAgICB2YXIgcG4gPSBzdGF0ZS50b2tlbnMubmV4dCwgcG4xLCBpID0gLTE7CiAgICB2YXIgcmV0LCB0cmlnZ2VyRm5FeHByLCBmaXJzdCwgbGFzdDsKICAgIHZhciBwYXJlbnMgPSAxOwogICAgdmFyIG9wZW5pbmcgPSBzdGF0ZS50b2tlbnMuY3VycjsKICAgIHZhciBwcmVjZWVkaW5nID0gc3RhdGUudG9rZW5zLnByZXY7CiAgICB2YXIgaXNOZWNlc3NhcnkgPSAhc3RhdGUub3B0aW9uLnNpbmdsZUdyb3VwczsKCiAgICBkbyB7CiAgICAgIGlmIChwbi52YWx1ZSA9PT0gIigiKSB7CiAgICAgICAgcGFyZW5zICs9IDE7CiAgICAgIH0gZWxzZSBpZiAocG4udmFsdWUgPT09ICIpIikgewogICAgICAgIHBhcmVucyAtPSAxOwogICAgICB9CgogICAgICBpICs9IDE7CiAgICAgIHBuMSA9IHBuOwogICAgICBwbiA9IHBlZWsoaSk7CiAgICB9IHdoaWxlICghKHBhcmVucyA9PT0gMCAmJiBwbjEudmFsdWUgPT09ICIpIikgJiYgcG4udHlwZSAhPT0gIihlbmQpIik7CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHRyaWdnZXJGbkV4cHIgPSBzdGF0ZS50b2tlbnMubmV4dC5pbW1lZCA9IHRydWU7CiAgICB9CgogICAgLy8gSWYgdGhlIGJhbGFuY2VkIGdyb3VwaW5nIG9wZXJhdG9yIGlzIGZvbGxvd2VkIGJ5IGEgImZhdCBhcnJvdyIsIHRoZQogICAgLy8gY3VycmVudCB0b2tlbiBtYXJrcyB0aGUgYmVnaW5uaW5nIG9mIGEgImZhdCBhcnJvdyIgZnVuY3Rpb24gYW5kIHBhcnNpbmcKICAgIC8vIHNob3VsZCBwcm9jZWVkIGFjY29yZGluZ2x5LgogICAgaWYgKHBuLnZhbHVlID09PSAiPT4iKSB7CiAgICAgIHJldHVybiBkb0Z1bmN0aW9uKHsgdHlwZTogImFycm93IiwgcGFyc2VkT3BlbmluZzogdHJ1ZSB9KTsKICAgIH0KCiAgICB2YXIgZXhwcnMgPSBbXTsKCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIpIikgewogICAgICBmb3IgKDs7KSB7CiAgICAgICAgZXhwcnMucHVzaChleHByZXNzaW9uKDEwKSk7CgogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIiwiKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChzdGF0ZS5vcHRpb24ubm9jb21tYSkgewogICAgICAgICAgd2FybmluZygiVzEyNyIpOwogICAgICAgIH0KCiAgICAgICAgcGFyc2VDb21tYSgpOwogICAgICB9CiAgICB9CgogICAgYWR2YW5jZSgiKSIsIHRoaXMpOwogICAgaWYgKHN0YXRlLm9wdGlvbi5pbW1lZCAmJiBleHByc1swXSAmJiBleHByc1swXS5pZCA9PT0gImZ1bmN0aW9uIikgewogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIoIiAmJgogICAgICAgIHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiLiIgJiYgc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICJbIikgewogICAgICAgIHdhcm5pbmcoIlcwNjgiLCB0aGlzKTsKICAgICAgfQogICAgfQoKICAgIGlmICghZXhwcnMubGVuZ3RoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChleHBycy5sZW5ndGggPiAxKSB7CiAgICAgIHJldCA9IE9iamVjdC5jcmVhdGUoc3RhdGUuc3ludGF4WyIsIl0pOwogICAgICByZXQuZXhwcnMgPSBleHByczsKCiAgICAgIGZpcnN0ID0gZXhwcnNbMF07CiAgICAgIGxhc3QgPSBleHByc1tleHBycy5sZW5ndGggLSAxXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldCA9IGZpcnN0ID0gbGFzdCA9IGV4cHJzWzBdOwoKICAgICAgaWYgKCFpc05lY2Vzc2FyeSkgewogICAgICAgIGlzTmVjZXNzYXJ5ID0KICAgICAgICAgIC8vIFVzZWQgdG8gZGlzdGluZ3Vpc2ggZnJvbSBhbiBFeHByZXNzaW9uU3RhdGVtZW50IHdoaWNoIG1heSBub3QKICAgICAgICAgIC8vIGJlZ2luIHdpdGggdGhlIGB7YCBhbmQgYGZ1bmN0aW9uYCB0b2tlbnMKICAgICAgICAgIChvcGVuaW5nLmJlZ2luc1N0bXQgJiYgKHJldC5pZCA9PT0gInsiIHx8IHRyaWdnZXJGbkV4cHIgfHwgaXNGdW5jdG9yKHJldCkpKSB8fAogICAgICAgICAgLy8gVXNlZCB0byBzaWduYWwgdGhhdCBhIGZ1bmN0aW9uIGV4cHJlc3Npb24gaXMgYmVpbmcgc3VwcGxpZWQgdG8KICAgICAgICAgIC8vIHNvbWUgb3RoZXIgb3BlcmF0b3IuCiAgICAgICAgICAodHJpZ2dlckZuRXhwciAmJgogICAgICAgICAgICAvLyBGb3IgcGFyZW50aGVzaXMgd3JhcHBpbmcgYSBmdW5jdGlvbiBleHByZXNzaW9uIHRvIGJlIGNvbnNpZGVyZWQKICAgICAgICAgICAgLy8gbmVjZXNzYXJ5LCB0aGUgZ3JvdXBpbmcgb3BlcmF0b3Igc2hvdWxkIGJlIHRoZSBsZWZ0LWhhbmQtc2lkZSBvZgogICAgICAgICAgICAvLyBzb21lIG90aGVyIG9wZXJhdG9yLS1laXRoZXIgd2l0aGluIHRoZSBwYXJlbnRoZXNpcyBvciBkaXJlY3RseQogICAgICAgICAgICAvLyBmb2xsb3dpbmcgdGhlbS4KICAgICAgICAgICAgKCFpc0VuZE9mRXhwcigpIHx8IHN0YXRlLnRva2Vucy5wcmV2LmlkICE9PSAifSIpKSB8fAogICAgICAgICAgLy8gVXNlZCB0byBkZW1hcmNhdGUgYW4gYXJyb3cgZnVuY3Rpb24gYXMgdGhlIGxlZnQtaGFuZCBzaWRlIG9mIHNvbWUKICAgICAgICAgIC8vIG9wZXJhdG9yLgogICAgICAgICAgKGlzRnVuY3RvcihyZXQpICYmICFpc0VuZE9mRXhwcigpKSB8fAogICAgICAgICAgLy8gVXNlZCBhcyB0aGUgcmV0dXJuIHZhbHVlIG9mIGEgc2luZ2xlLXN0YXRlbWVudCBhcnJvdyBmdW5jdGlvbgogICAgICAgICAgKHJldC5pZCA9PT0gInsiICYmIHByZWNlZWRpbmcuaWQgPT09ICI9PiIpIHx8CiAgICAgICAgICAvLyBVc2VkIHRvIGRlbGluZWF0ZSBhbiBpbnRlZ2VyIG51bWJlciBsaXRlcmFsIGZyb20gYSBkZXJlZmVyZW5jaW5nCiAgICAgICAgICAvLyBwdW5jdHVhdG9yIChvdGhlcndpc2UgaW50ZXJwcmV0ZWQgYXMgYSBkZWNpbWFsIHBvaW50KQogICAgICAgICAgKHJldC50eXBlID09PSAiKG51bWJlcikiICYmCiAgICAgICAgICAgIGNoZWNrUHVuY3R1YXRvcihwbiwgIi4iKSAmJiAvXlxkKyQvLnRlc3QocmV0LnZhbHVlKSkgfHwKICAgICAgICAgIC8vIFVzZWQgdG8gd3JhcCBvYmplY3QgZGVzdHJ1Y3R1cmluZyBhc3NpZ25tZW50CiAgICAgICAgICAob3BlbmluZy5iZWdpbnNTdG10ICYmIHJldC5pZCA9PT0gIj0iICYmIHJldC5sZWZ0LmlkID09PSAieyIpOwogICAgICB9CiAgICB9CgogICAgaWYgKHJldCkgewogICAgICAvLyBUaGUgb3BlcmF0b3IgbWF5IGJlIG5lY2Vzc2FyeSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBiaW5kaW5nIHBvd2VyIG9mCiAgICAgIC8vIG5laWdoYm9yaW5nIG9wZXJhdG9ycyAod2hlbmV2ZXIgdGhlcmUgaXMgYW4gb3BlcmF0b3IgaW4gdXNlIHdpdGhpbiB0aGUKICAgICAgLy8gZmlyc3QgZXhwcmVzc2lvbiAqb3IqIHRoZSBjdXJyZW50IGdyb3VwIGNvbnRhaW5zIG11bHRpcGxlIGV4cHJlc3Npb25zKQogICAgICBpZiAoIWlzTmVjZXNzYXJ5ICYmIChpc09wZXJhdG9yKGZpcnN0KSB8fCByZXQuZXhwcnMpKSB7CiAgICAgICAgaXNOZWNlc3NhcnkgPQogICAgICAgICAgKHJicCA+IGZpcnN0LmxicCkgfHwKICAgICAgICAgIChyYnAgPiAwICYmIHJicCA9PT0gZmlyc3QubGJwKSB8fAogICAgICAgICAgKCFpc0VuZE9mRXhwcigpICYmIGxhc3QubGJwIDwgc3RhdGUudG9rZW5zLm5leHQubGJwKTsKICAgICAgfQoKICAgICAgaWYgKCFpc05lY2Vzc2FyeSkgewogICAgICAgIHdhcm5pbmcoIlcxMjYiLCBvcGVuaW5nKTsKICAgICAgfQoKICAgICAgcmV0LnBhcmVuID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gcmV0OwogIH0pOwoKICBhcHBsaWNhdGlvbigiPT4iKTsKCiAgaW5maXgoIlsiLCBmdW5jdGlvbihsZWZ0LCB0aGF0KSB7CiAgICB2YXIgZSA9IGV4cHJlc3Npb24oMTApLCBzOwogICAgaWYgKGUgJiYgZS50eXBlID09PSAiKHN0cmluZykiKSB7CiAgICAgIGlmICghc3RhdGUub3B0aW9uLmV2aWwgJiYgKGUudmFsdWUgPT09ICJldmFsIiB8fCBlLnZhbHVlID09PSAiZXhlY1NjcmlwdCIpKSB7CiAgICAgICAgaWYgKGlzR2xvYmFsRXZhbChsZWZ0LCBzdGF0ZSkpIHsKICAgICAgICAgIHdhcm5pbmcoIlcwNjEiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvdW50TWVtYmVyKGUudmFsdWUpOwogICAgICBpZiAoIXN0YXRlLm9wdGlvbi5zdWIgJiYgcmVnLmlkZW50aWZpZXIudGVzdChlLnZhbHVlKSkgewogICAgICAgIHMgPSBzdGF0ZS5zeW50YXhbZS52YWx1ZV07CiAgICAgICAgaWYgKCFzIHx8ICFpc1Jlc2VydmVkKHMpKSB7CiAgICAgICAgICB3YXJuaW5nKCJXMDY5Iiwgc3RhdGUudG9rZW5zLnByZXYsIGUudmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgYWR2YW5jZSgiXSIsIHRoYXQpOwoKICAgIGlmIChlICYmIGUudmFsdWUgPT09ICJoYXNPd25Qcm9wZXJ0eSIgJiYgc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICI9IikgewogICAgICB3YXJuaW5nKCJXMDAxIik7CiAgICB9CgogICAgdGhhdC5sZWZ0ID0gbGVmdDsKICAgIHRoYXQucmlnaHQgPSBlOwogICAgcmV0dXJuIHRoYXQ7CiAgfSwgMTYwLCB0cnVlKTsKCiAgZnVuY3Rpb24gY29tcHJlaGVuc2l2ZUFycmF5RXhwcmVzc2lvbigpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIHJlcy5leHBzID0gdHJ1ZTsKICAgIHN0YXRlLmZ1bmN0WyIoY29tcGFycmF5KSJdLnN0YWNrKCk7CgogICAgLy8gSGFuZGxlIHJldmVyc2VkIGZvciBleHByZXNzaW9ucywgdXNlZCBpbiBzcGlkZXJtb25rZXkKICAgIHZhciByZXZlcnNlZCA9IGZhbHNlOwogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlICE9PSAiZm9yIikgewogICAgICByZXZlcnNlZCA9IHRydWU7CiAgICAgIGlmICghc3RhdGUuaW5Nb3ooKSkgewogICAgICAgIHdhcm5pbmcoIlcxMTYiLCBzdGF0ZS50b2tlbnMubmV4dCwgImZvciIsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgfQogICAgICBzdGF0ZS5mdW5jdFsiKGNvbXBhcnJheSkiXS5zZXRTdGF0ZSgidXNlIik7CiAgICAgIHJlcy5yaWdodCA9IGV4cHJlc3Npb24oMTApOwogICAgfQoKICAgIGFkdmFuY2UoImZvciIpOwogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiZWFjaCIpIHsKICAgICAgYWR2YW5jZSgiZWFjaCIpOwogICAgICBpZiAoIXN0YXRlLmluTW96KCkpIHsKICAgICAgICB3YXJuaW5nKCJXMTE4Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJmb3IgZWFjaCIpOwogICAgICB9CiAgICB9CiAgICBhZHZhbmNlKCIoIik7CiAgICBzdGF0ZS5mdW5jdFsiKGNvbXBhcnJheSkiXS5zZXRTdGF0ZSgiZGVmaW5lIik7CiAgICByZXMubGVmdCA9IGV4cHJlc3Npb24oMTMwKTsKICAgIGlmIChfLmNvbnRhaW5zKFsiaW4iLCAib2YiXSwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpKSB7CiAgICAgIGFkdmFuY2UoKTsKICAgIH0gZWxzZSB7CiAgICAgIGVycm9yKCJFMDQ1Iiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgfQogICAgc3RhdGUuZnVuY3RbIihjb21wYXJyYXkpIl0uc2V0U3RhdGUoImdlbmVyYXRlIik7CiAgICBleHByZXNzaW9uKDEwKTsKCiAgICBhZHZhbmNlKCIpIik7CiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICJpZiIpIHsKICAgICAgYWR2YW5jZSgiaWYiKTsKICAgICAgYWR2YW5jZSgiKCIpOwogICAgICBzdGF0ZS5mdW5jdFsiKGNvbXBhcnJheSkiXS5zZXRTdGF0ZSgiZmlsdGVyIik7CiAgICAgIHJlcy5maWx0ZXIgPSBleHByZXNzaW9uKDEwKTsKICAgICAgYWR2YW5jZSgiKSIpOwogICAgfQoKICAgIGlmICghcmV2ZXJzZWQpIHsKICAgICAgc3RhdGUuZnVuY3RbIihjb21wYXJyYXkpIl0uc2V0U3RhdGUoInVzZSIpOwogICAgICByZXMucmlnaHQgPSBleHByZXNzaW9uKDEwKTsKICAgIH0KCiAgICBhZHZhbmNlKCJdIik7CiAgICBzdGF0ZS5mdW5jdFsiKGNvbXBhcnJheSkiXS51bnN0YWNrKCk7CiAgICByZXR1cm4gcmVzOwogIH0KCiAgcHJlZml4KCJbIiwgZnVuY3Rpb24oKSB7CiAgICB2YXIgYmxvY2t0eXBlID0gbG9va3VwQmxvY2tUeXBlKCk7CiAgICBpZiAoYmxvY2t0eXBlLmlzQ29tcEFycmF5KSB7CiAgICAgIGlmICghc3RhdGUub3B0aW9uLmVzbmV4dCAmJiAhc3RhdGUuaW5Nb3ooKSkgewogICAgICAgIHdhcm5pbmcoIlcxMTgiLCBzdGF0ZS50b2tlbnMuY3VyciwgImFycmF5IGNvbXByZWhlbnNpb24iKTsKICAgICAgfQogICAgICByZXR1cm4gY29tcHJlaGVuc2l2ZUFycmF5RXhwcmVzc2lvbigpOwogICAgfSBlbHNlIGlmIChibG9ja3R5cGUuaXNEZXN0QXNzaWduKSB7CiAgICAgIHRoaXMuZGVzdHJ1Y3RBc3NpZ24gPSBkZXN0cnVjdHVyaW5nUGF0dGVybih7IG9wZW5pbmdQYXJzZWQ6IHRydWUsIGFzc2lnbm1lbnQ6IHRydWUgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdmFyIGIgPSBzdGF0ZS50b2tlbnMuY3Vyci5saW5lICE9PSBzdGFydExpbmUoc3RhdGUudG9rZW5zLm5leHQpOwogICAgdGhpcy5maXJzdCA9IFtdOwogICAgaWYgKGIpIHsKICAgICAgaW5kZW50ICs9IHN0YXRlLm9wdGlvbi5pbmRlbnQ7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5mcm9tID09PSBpbmRlbnQgKyBzdGF0ZS5vcHRpb24uaW5kZW50KSB7CiAgICAgICAgaW5kZW50ICs9IHN0YXRlLm9wdGlvbi5pbmRlbnQ7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIihlbmQpIikgewogICAgICB3aGlsZSAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIsIikgewogICAgICAgIGlmICghc3RhdGUub3B0aW9uLmVsaXNpb24pIHsKICAgICAgICAgIGlmICghc3RhdGUuaW5FUzUoKSkgewogICAgICAgICAgICAvLyBNYWludGFpbiBjb21wYXQgd2l0aCBvbGQgb3B0aW9ucyAtLS0gRVM1IG1vZGUgd2l0aG91dAogICAgICAgICAgICAvLyBlbGlzaW9uPXRydWUgd2lsbCB3YXJuIG9uY2UgcGVyIGNvbW1hCiAgICAgICAgICAgIHdhcm5pbmcoIlcwNzAiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcxMjgiKTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGFkdmFuY2UoIiwiKTsKICAgICAgICAgICAgfSB3aGlsZSAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIsIik7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhZHZhbmNlKCIsIik7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIl0iKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMuZmlyc3QucHVzaChleHByZXNzaW9uKDEwKSk7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIiwiKSB7CiAgICAgICAgcGFyc2VDb21tYSh7IGFsbG93VHJhaWxpbmc6IHRydWUgfSk7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiXSIgJiYgIXN0YXRlLmluRVM1KCkpIHsKICAgICAgICAgIHdhcm5pbmcoIlcwNzAiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChiKSB7CiAgICAgIGluZGVudCAtPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgfQogICAgYWR2YW5jZSgiXSIsIHRoaXMpOwogICAgcmV0dXJuIHRoaXM7CiAgfSk7CgoKICBmdW5jdGlvbiBpc01ldGhvZCgpIHsKICAgIHJldHVybiBzdGF0ZS5mdW5jdFsiKHN0YXRlbWVudCkiXSAmJiBzdGF0ZS5mdW5jdFsiKHN0YXRlbWVudCkiXS50eXBlID09PSAiY2xhc3MiIHx8CiAgICAgICAgICAgc3RhdGUuZnVuY3RbIihjb250ZXh0KSJdICYmIHN0YXRlLmZ1bmN0WyIoY29udGV4dCkiXVsiKHZlcmIpIl0gPT09ICJjbGFzcyI7CiAgfQoKCiAgZnVuY3Rpb24gaXNQcm9wZXJ0eU5hbWUodG9rZW4pIHsKICAgIHJldHVybiB0b2tlbi5pZGVudGlmaWVyIHx8IHRva2VuLmlkID09PSAiKHN0cmluZykiIHx8IHRva2VuLmlkID09PSAiKG51bWJlcikiOwogIH0KCgogIGZ1bmN0aW9uIHByb3BlcnR5TmFtZShwcmVzZXJ2ZU9yVG9rZW4pIHsKICAgIHZhciBpZDsKICAgIHZhciBwcmVzZXJ2ZSA9IHRydWU7CiAgICBpZiAodHlwZW9mIHByZXNlcnZlT3JUb2tlbiA9PT0gIm9iamVjdCIpIHsKICAgICAgaWQgPSBwcmVzZXJ2ZU9yVG9rZW47CiAgICB9IGVsc2UgewogICAgICBwcmVzZXJ2ZSA9IHByZXNlcnZlT3JUb2tlbjsKICAgICAgaWQgPSBvcHRpb25hbGlkZW50aWZpZXIoZmFsc2UsIHRydWUsIHByZXNlcnZlKTsKICAgIH0KCiAgICBpZiAoIWlkKSB7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIihzdHJpbmcpIikgewogICAgICAgIGlkID0gc3RhdGUudG9rZW5zLm5leHQudmFsdWU7CiAgICAgICAgaWYgKCFwcmVzZXJ2ZSkgewogICAgICAgICAgYWR2YW5jZSgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIihudW1iZXIpIikgewogICAgICAgIGlkID0gc3RhdGUudG9rZW5zLm5leHQudmFsdWUudG9TdHJpbmcoKTsKICAgICAgICBpZiAoIXByZXNlcnZlKSB7CiAgICAgICAgICBhZHZhbmNlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBpZCA9PT0gIm9iamVjdCIpIHsKICAgICAgaWYgKGlkLmlkID09PSAiKHN0cmluZykiIHx8IGlkLmlkID09PSAiKGlkZW50aWZpZXIpIikgaWQgPSBpZC52YWx1ZTsKICAgICAgZWxzZSBpZiAoaWQuaWQgPT09ICIobnVtYmVyKSIpIGlkID0gaWQudmFsdWUudG9TdHJpbmcoKTsKICAgIH0KCiAgICBpZiAoaWQgPT09ICJoYXNPd25Qcm9wZXJ0eSIpIHsKICAgICAgd2FybmluZygiVzAwMSIpOwogICAgfQoKICAgIHJldHVybiBpZDsKICB9CgogIC8qKgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiBAcGFyYW0ge3Rva2VufSBbb3B0aW9ucy5sb25lQXJnXSBUaGUgYXJndW1lbnQgdG8gdGhlIGZ1bmN0aW9uIGluIGNhc2VzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUgaXQgd2FzIGRlZmluZWQgdXNpbmcgdGhlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlLWFyZ3VtZW50IHNob3J0aGFuZC4KICAgKiBAcGFyYW0ge2Jvb2x9IFtvcHRpb25zLnBhcnNlZE9wZW5pbmddIFdoZXRoZXIgdGhlIG9wZW5pbmcgcGFyZW50aGVzaXMgaGFzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5IGJlZW4gcGFyc2VkLgogICAqIEByZXR1cm5zIHt7IGFyaXR5OiBudW1iZXIsIHBhcmFtczogQXJyYXkuPHN0cmluZz59fQogICAqLwogIGZ1bmN0aW9uIGZ1bmN0aW9ucGFyYW1zKG9wdGlvbnMpIHsKICAgIHZhciBuZXh0OwogICAgdmFyIHBhcmFtc0lkcyA9IFtdOwogICAgdmFyIGlkZW50OwogICAgdmFyIHRva2VucyA9IFtdOwogICAgdmFyIHQ7CiAgICB2YXIgcGFzdERlZmF1bHQgPSBmYWxzZTsKICAgIHZhciBwYXN0UmVzdCA9IGZhbHNlOwogICAgdmFyIGFyaXR5ID0gMDsKICAgIHZhciBsb25lQXJnID0gb3B0aW9ucyAmJiBvcHRpb25zLmxvbmVBcmc7CgogICAgaWYgKGxvbmVBcmcgJiYgbG9uZUFyZy5pZGVudGlmaWVyID09PSB0cnVlKSB7CiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYWRkUGFyYW0obG9uZUFyZy52YWx1ZSwgbG9uZUFyZyk7CiAgICAgIHJldHVybiB7IGFyaXR5OiAxLCBwYXJhbXM6IFsgbG9uZUFyZy52YWx1ZSBdIH07CiAgICB9CgogICAgbmV4dCA9IHN0YXRlLnRva2Vucy5uZXh0OwoKICAgIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5wYXJzZWRPcGVuaW5nKSB7CiAgICAgIGFkdmFuY2UoIigiKTsKICAgIH0KCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIpIikgewogICAgICBhZHZhbmNlKCIpIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRQYXJhbShhZGRQYXJhbUFyZ3MpIHsKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRQYXJhbS5hcHBseShzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLCBhZGRQYXJhbUFyZ3MpOwogICAgfQoKICAgIGZvciAoOzspIHsKICAgICAgYXJpdHkrKzsKICAgICAgLy8gYXJlIGFkZGVkIHRvIHRoZSBwYXJhbSBzY29wZQogICAgICB2YXIgY3VycmVudFBhcmFtcyA9IFtdOwoKICAgICAgaWYgKF8uY29udGFpbnMoWyJ7IiwgIlsiXSwgc3RhdGUudG9rZW5zLm5leHQuaWQpKSB7CiAgICAgICAgdG9rZW5zID0gZGVzdHJ1Y3R1cmluZ1BhdHRlcm4oKTsKICAgICAgICBmb3IgKHQgaW4gdG9rZW5zKSB7CiAgICAgICAgICB0ID0gdG9rZW5zW3RdOwogICAgICAgICAgaWYgKHQuaWQpIHsKICAgICAgICAgICAgcGFyYW1zSWRzLnB1c2godC5pZCk7CiAgICAgICAgICAgIGN1cnJlbnRQYXJhbXMucHVzaChbdC5pZCwgdC50b2tlbl0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLi4uIikpIHBhc3RSZXN0ID0gdHJ1ZTsKICAgICAgICBpZGVudCA9IGlkZW50aWZpZXIodHJ1ZSk7CiAgICAgICAgaWYgKGlkZW50KSB7CiAgICAgICAgICBwYXJhbXNJZHMucHVzaChpZGVudCk7CiAgICAgICAgICBjdXJyZW50UGFyYW1zLnB1c2goW2lkZW50LCBzdGF0ZS50b2tlbnMuY3Vycl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBTa2lwIGludmFsaWQgcGFyYW1ldGVyLgogICAgICAgICAgd2hpbGUgKCFjaGVja1B1bmN0dWF0b3JzKHN0YXRlLnRva2Vucy5uZXh0LCBbIiwiLCAiKSJdKSkgYWR2YW5jZSgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gSXQgaXMgdmFsaWQgdG8gaGF2ZSBhIHJlZ3VsYXIgYXJndW1lbnQgYWZ0ZXIgYSBkZWZhdWx0IGFyZ3VtZW50CiAgICAgIC8vIHNpbmNlIHVuZGVmaW5lZCBjYW4gYmUgdXNlZCBmb3IgbWlzc2luZyBwYXJhbWV0ZXJzLiBTdGlsbCB3YXJuIGFzIGl0IGlzCiAgICAgIC8vIGEgcG9zc2libGUgY29kZSBzbWVsbC4KICAgICAgaWYgKHBhc3REZWZhdWx0KSB7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiPSIpIHsKICAgICAgICAgIGVycm9yKCJXMTM4Iiwgc3RhdGUudG9rZW5zLmN1cnJlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICI9IikgewogICAgICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICAgICAgd2FybmluZygiVzExOSIsIHN0YXRlLnRva2Vucy5uZXh0LCAiZGVmYXVsdCBwYXJhbWV0ZXJzIiwgIjYiKTsKICAgICAgICB9CiAgICAgICAgYWR2YW5jZSgiPSIpOwogICAgICAgIHBhc3REZWZhdWx0ID0gdHJ1ZTsKICAgICAgICBleHByZXNzaW9uKDEwKTsKICAgICAgfQoKICAgICAgLy8gbm93IHdlIGhhdmUgZXZhbHVhdGVkIHRoZSBkZWZhdWx0IGV4cHJlc3Npb24sIGFkZCB0aGUgdmFyaWFibGUgdG8gdGhlIHBhcmFtIHNjb3BlCiAgICAgIGN1cnJlbnRQYXJhbXMuZm9yRWFjaChhZGRQYXJhbSk7CgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIsIikgewogICAgICAgIGlmIChwYXN0UmVzdCkgewogICAgICAgICAgd2FybmluZygiVzEzMSIsIHN0YXRlLnRva2Vucy5uZXh0KTsKICAgICAgICB9CiAgICAgICAgcGFyc2VDb21tYSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGFkdmFuY2UoIikiLCBuZXh0KTsKICAgICAgICByZXR1cm4geyBhcml0eTogYXJpdHksIHBhcmFtczogcGFyYW1zSWRzIH07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGZ1bmN0b3IobmFtZSwgdG9rZW4sIG92ZXJ3cml0ZXMpIHsKICAgIHZhciBmdW5jdCA9IHsKICAgICAgIihuYW1lKSIgICAgICA6IG5hbWUsCiAgICAgICIoYnJlYWthZ2UpIiAgOiAwLAogICAgICAiKGxvb3BhZ2UpIiAgIDogMCwKICAgICAgIih0b2tlbnMpIiAgICA6IHt9LAogICAgICAiKHByb3BlcnRpZXMpIjoge30sCgogICAgICAiKGNhdGNoKSIgICAgIDogZmFsc2UsCiAgICAgICIoZ2xvYmFsKSIgICAgOiBmYWxzZSwKCiAgICAgICIobGluZSkiICAgICAgOiBudWxsLAogICAgICAiKGNoYXJhY3RlcikiIDogbnVsbCwKICAgICAgIihtZXRyaWNzKSIgICA6IG51bGwsCiAgICAgICIoc3RhdGVtZW50KSIgOiBudWxsLAogICAgICAiKGNvbnRleHQpIiAgIDogbnVsbCwKICAgICAgIihzY29wZSkiICAgICA6IG51bGwsCiAgICAgICIoY29tcGFycmF5KSIgOiBudWxsLAogICAgICAiKGdlbmVyYXRvcikiIDogbnVsbCwKICAgICAgIihhcnJvdykiICAgICA6IG51bGwsCiAgICAgICIocGFyYW1zKSIgICAgOiBudWxsCiAgICB9OwoKICAgIGlmICh0b2tlbikgewogICAgICBfLmV4dGVuZChmdW5jdCwgewogICAgICAgICIobGluZSkiICAgICA6IHRva2VuLmxpbmUsCiAgICAgICAgIihjaGFyYWN0ZXIpIjogdG9rZW4uY2hhcmFjdGVyLAogICAgICAgICIobWV0cmljcykiICA6IGNyZWF0ZU1ldHJpY3ModG9rZW4pCiAgICAgIH0pOwogICAgfQoKICAgIF8uZXh0ZW5kKGZ1bmN0LCBvdmVyd3JpdGVzKTsKCiAgICBpZiAoZnVuY3RbIihjb250ZXh0KSJdKSB7CiAgICAgIGZ1bmN0WyIoc2NvcGUpIl0gPSBmdW5jdFsiKGNvbnRleHQpIl1bIihzY29wZSkiXTsKICAgICAgZnVuY3RbIihjb21wYXJyYXkpIl0gID0gZnVuY3RbIihjb250ZXh0KSJdWyIoY29tcGFycmF5KSJdOwogICAgfQoKICAgIHJldHVybiBmdW5jdDsKICB9CgogIGZ1bmN0aW9uIGlzRnVuY3Rvcih0b2tlbikgewogICAgcmV0dXJuICIoc2NvcGUpIiBpbiB0b2tlbjsKICB9CgogIC8qKgogICAqIERldGVybWluZSBpZiB0aGUgcGFyc2VyIGhhcyBiZWd1biBwYXJzaW5nIGV4ZWN1dGFibGUgY29kZS4KICAgKgogICAqIEBwYXJhbSB7VG9rZW59IGZ1bmN0IC0gVGhlIGN1cnJlbnQgImZ1bmN0b3IiIHRva2VuCiAgICoKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgKi8KICBmdW5jdGlvbiBoYXNQYXJzZWRDb2RlKGZ1bmN0KSB7CiAgICByZXR1cm4gZnVuY3RbIihnbG9iYWwpIl0gJiYgIWZ1bmN0WyIodmVyYikiXTsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCBhcyBib3RoIGEgbnVsbC1kZW5vdGF0aW9uIG1ldGhvZCAqYW5kKiBhCiAgICogbGVmdC1kZW5vdGF0aW9uIG1ldGhvZCwgbWVhbmluZyB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIG92ZXJsb2FkZWQuCiAgICovCiAgZnVuY3Rpb24gZG9UZW1wbGF0ZUxpdGVyYWwobGVmdE9yUmJwKSB7CiAgICAvLyBBU1NFUlQ6IHRoaXMudHlwZSA9PT0gIih0ZW1wbGF0ZSkiCiAgICAvLyBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlCiAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0OwogICAgdmFyIG5vU3Vic3QgPSB0aGlzLm5vU3Vic3Q7CiAgICB2YXIgZGVwdGggPSB0aGlzLmRlcHRoOwogICAgdmFyIGxlZnQgPSB0eXBlb2YgbGVmdE9yUmJwID09PSAibnVtYmVyIiA/IG51bGwgOiBsZWZ0T3JSYnA7CgogICAgaWYgKCFub1N1YnN0KSB7CiAgICAgIHdoaWxlICghZW5kKCkpIHsKICAgICAgICBpZiAoIXN0YXRlLnRva2Vucy5uZXh0LnRlbXBsYXRlIHx8IHN0YXRlLnRva2Vucy5uZXh0LmRlcHRoID4gZGVwdGgpIHsKICAgICAgICAgIGV4cHJlc3Npb24oMCk7IC8vIHNob3VsZCBwcm9iYWJseSBoYXZlIGRpZmZlcmVudCByYnA/CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIHNraXAgdGVtcGxhdGUgc3RhcnQgLyBtaWRkbGUKICAgICAgICAgIGFkdmFuY2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBpZDogIih0ZW1wbGF0ZSkiLAogICAgICB0eXBlOiAiKHRlbXBsYXRlKSIsCiAgICAgIHRhZzogbGVmdAogICAgfTsKCiAgICBmdW5jdGlvbiBlbmQoKSB7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMuY3Vyci50ZW1wbGF0ZSAmJiBzdGF0ZS50b2tlbnMuY3Vyci50YWlsICYmCiAgICAgICAgICBzdGF0ZS50b2tlbnMuY3Vyci5jb250ZXh0ID09PSBjdHgpIHJldHVybiB0cnVlOwogICAgICB2YXIgY29tcGxldGUgPSAoc3RhdGUudG9rZW5zLm5leHQudGVtcGxhdGUgJiYgc3RhdGUudG9rZW5zLm5leHQudGFpbCAmJgogICAgICAgICAgICAgICAgICAgICAgc3RhdGUudG9rZW5zLm5leHQuY29udGV4dCA9PT0gY3R4KTsKICAgICAgaWYgKGNvbXBsZXRlKSBhZHZhbmNlKCk7CiAgICAgIHJldHVybiBjb21wbGV0ZSB8fCBzdGF0ZS50b2tlbnMubmV4dC5pc1VuY2xvc2VkOwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXQogICAqIEBwYXJhbSB7dG9rZW59IFtvcHRpb25zLm5hbWVdIFRoZSBpZGVudGlmaWVyIGJlbG9uZ2luZyB0byB0aGUgZnVuY3Rpb24gKGlmCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55KQogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuc3RhdGVtZW50XSBUaGUgc3RhdGVtZW50IHRoYXQgdHJpZ2dlcmVkIGNyZWF0aW9uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mIHRoZSBjdXJyZW50IGZ1bmN0aW9uLgogICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy50eXBlXSBJZiBzcGVjaWZpZWQsIGVpdGhlciAiZ2VuZXJhdG9yIiBvciAiYXJyb3ciCiAgICogQHBhcmFtIHt0b2tlbn0gW29wdGlvbnMubG9uZUFyZ10gVGhlIGFyZ3VtZW50IHRvIHRoZSBmdW5jdGlvbiBpbiBjYXNlcwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlIGl0IHdhcyBkZWZpbmVkIHVzaW5nIHRoZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZS1hcmd1bWVudCBzaG9ydGhhbmQKICAgKiBAcGFyYW0ge2Jvb2x9IFtvcHRpb25zLnBhcnNlZE9wZW5pbmddIFdoZXRoZXIgdGhlIG9wZW5pbmcgcGFyZW50aGVzaXMgaGFzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5IGJlZW4gcGFyc2VkCiAgICogQHBhcmFtIHt0b2tlbn0gW29wdGlvbnMuY2xhc3NFeHByQmluZGluZ10gRGVmaW5lIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllciBpbiB0aGUgbmV3IGZ1bmN0aW9uJ3MKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZSwgbWltaWNraW5nIHRoZSBiYWhhdmlvciBvZgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzIGV4cHJlc3Npb24gbmFtZXMgd2l0aGluCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGJvZHkgb2YgbWVtYmVyIGZ1bmN0aW9ucy4KICAgKi8KICBmdW5jdGlvbiBkb0Z1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHZhciBmLCB0b2tlbiwgbmFtZSwgc3RhdGVtZW50LCBjbGFzc0V4cHJCaW5kaW5nLCBpc0dlbmVyYXRvciwgaXNBcnJvdywgaWdub3JlTG9vcEZ1bmM7CiAgICB2YXIgb2xkT3B0aW9uID0gc3RhdGUub3B0aW9uOwogICAgdmFyIG9sZElnbm9yZWQgPSBzdGF0ZS5pZ25vcmVkOwoKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWU7CiAgICAgIHN0YXRlbWVudCA9IG9wdGlvbnMuc3RhdGVtZW50OwogICAgICBjbGFzc0V4cHJCaW5kaW5nID0gb3B0aW9ucy5jbGFzc0V4cHJCaW5kaW5nOwogICAgICBpc0dlbmVyYXRvciA9IG9wdGlvbnMudHlwZSA9PT0gImdlbmVyYXRvciI7CiAgICAgIGlzQXJyb3cgPSBvcHRpb25zLnR5cGUgPT09ICJhcnJvdyI7CiAgICAgIGlnbm9yZUxvb3BGdW5jID0gb3B0aW9ucy5pZ25vcmVMb29wRnVuYzsKICAgIH0KCiAgICBzdGF0ZS5vcHRpb24gPSBPYmplY3QuY3JlYXRlKHN0YXRlLm9wdGlvbik7CiAgICBzdGF0ZS5pZ25vcmVkID0gT2JqZWN0LmNyZWF0ZShzdGF0ZS5pZ25vcmVkKTsKCiAgICBzdGF0ZS5mdW5jdCA9IGZ1bmN0b3IobmFtZSB8fCBzdGF0ZS5uYW1lU3RhY2suaW5mZXIoKSwgc3RhdGUudG9rZW5zLm5leHQsIHsKICAgICAgIihzdGF0ZW1lbnQpIjogc3RhdGVtZW50LAogICAgICAiKGNvbnRleHQpIjogICBzdGF0ZS5mdW5jdCwKICAgICAgIihhcnJvdykiOiAgICAgaXNBcnJvdywKICAgICAgIihnZW5lcmF0b3IpIjogaXNHZW5lcmF0b3IKICAgIH0pOwoKICAgIGYgPSBzdGF0ZS5mdW5jdDsKICAgIHRva2VuID0gc3RhdGUudG9rZW5zLmN1cnI7CiAgICB0b2tlbi5mdW5jdCA9IHN0YXRlLmZ1bmN0OwoKICAgIGZ1bmN0aW9ucy5wdXNoKHN0YXRlLmZ1bmN0KTsKCiAgICAvLyBTbyB0aGF0IHRoZSBmdW5jdGlvbiBpcyBhdmFpbGFibGUgdG8gaXRzZWxmIGFuZCByZWZlcmVuY2luZyBpdHNlbGYgaXMgbm90CiAgICAvLyBzZWVuIGFzIGEgY2xvc3VyZSwgYWRkIHRoZSBmdW5jdGlvbiBuYW1lIHRvIGEgbmV3IHNjb3BlLCBidXQgZG8gbm90CiAgICAvLyB0ZXN0IGZvciB1bnVzZWQgKHVudXNlZDogZmFsc2UpCiAgICAvLyBpdCBpcyBhIG5ldyBibG9jayBzY29wZSBzbyB0aGF0IHBhcmFtcyBjYW4gb3ZlcnJpZGUgaXQsIGl0IGNhbiBiZSBibG9jayBzY29wZWQKICAgIC8vIGJ1dCBkZWNsYXJhdGlvbnMgaW5zaWRlIHRoZSBmdW5jdGlvbiBkb24ndCBjYXVzZSBhbHJlYWR5IGRlY2xhcmVkIGVycm9yCiAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCJmdW5jdGlvbm91dGVyIik7CiAgICB2YXIgaW50ZXJuYWxseUFjY2Vzc2libGVOYW1lID0gbmFtZSB8fCBjbGFzc0V4cHJCaW5kaW5nOwogICAgaWYgKGludGVybmFsbHlBY2Nlc3NpYmxlTmFtZSkgewogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmJsb2NrLmFkZChpbnRlcm5hbGx5QWNjZXNzaWJsZU5hbWUsCiAgICAgICAgY2xhc3NFeHByQmluZGluZyA/ICJjbGFzcyIgOiAiZnVuY3Rpb24iLCBzdGF0ZS50b2tlbnMuY3VyciwgZmFsc2UpOwogICAgfQoKICAgIC8vIGNyZWF0ZSB0aGUgcGFyYW0gc2NvcGUgKHBhcmFtcyBhZGRlZCBpbiBmdW5jdGlvbnBhcmFtcykKICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc3RhY2soImZ1bmN0aW9ucGFyYW1zIik7CgogICAgdmFyIHBhcmFtc0luZm8gPSBmdW5jdGlvbnBhcmFtcyhvcHRpb25zKTsKCiAgICBpZiAocGFyYW1zSW5mbykgewogICAgICBzdGF0ZS5mdW5jdFsiKHBhcmFtcykiXSA9IHBhcmFtc0luZm8ucGFyYW1zOwogICAgICBzdGF0ZS5mdW5jdFsiKG1ldHJpY3MpIl0uYXJpdHkgPSBwYXJhbXNJbmZvLmFyaXR5OwogICAgICBzdGF0ZS5mdW5jdFsiKG1ldHJpY3MpIl0udmVyaWZ5TWF4UGFyYW1ldGVyc1BlckZ1bmN0aW9uKCk7CiAgICB9IGVsc2UgewogICAgICBzdGF0ZS5mdW5jdFsiKG1ldHJpY3MpIl0uYXJpdHkgPSAwOwogICAgfQoKICAgIGlmIChpc0Fycm93KSB7CiAgICAgIGlmICghc3RhdGUuaW5FUzYodHJ1ZSkpIHsKICAgICAgICB3YXJuaW5nKCJXMTE5Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJhcnJvdyBmdW5jdGlvbiBzeW50YXggKD0+KSIsICI2Iik7CiAgICAgIH0KCiAgICAgIGlmICghb3B0aW9ucy5sb25lQXJnKSB7CiAgICAgICAgYWR2YW5jZSgiPT4iKTsKICAgICAgfQogICAgfQoKICAgIGJsb2NrKGZhbHNlLCB0cnVlLCB0cnVlLCBpc0Fycm93KTsKCiAgICBpZiAoIXN0YXRlLm9wdGlvbi5ub3lpZWxkICYmIGlzR2VuZXJhdG9yICYmCiAgICAgICAgc3RhdGUuZnVuY3RbIihnZW5lcmF0b3IpIl0gIT09ICJ5aWVsZGVkIikgewogICAgICB3YXJuaW5nKCJXMTI0Iiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgfQoKICAgIHN0YXRlLmZ1bmN0WyIobWV0cmljcykiXS52ZXJpZnlNYXhTdGF0ZW1lbnRzUGVyRnVuY3Rpb24oKTsKICAgIHN0YXRlLmZ1bmN0WyIobWV0cmljcykiXS52ZXJpZnlNYXhDb21wbGV4aXR5UGVyRnVuY3Rpb24oKTsKICAgIHN0YXRlLmZ1bmN0WyIodW51c2VkT3B0aW9uKSJdID0gc3RhdGUub3B0aW9uLnVudXNlZDsKICAgIHN0YXRlLm9wdGlvbiA9IG9sZE9wdGlvbjsKICAgIHN0YXRlLmlnbm9yZWQgPSBvbGRJZ25vcmVkOwogICAgc3RhdGUuZnVuY3RbIihsYXN0KSJdID0gc3RhdGUudG9rZW5zLmN1cnIubGluZTsKICAgIHN0YXRlLmZ1bmN0WyIobGFzdGNoYXJhY3RlcikiXSA9IHN0YXRlLnRva2Vucy5jdXJyLmNoYXJhY3RlcjsKCiAgICAvLyB1bnN0YWNrIHRoZSBwYXJhbXMgc2NvcGUKICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0udW5zdGFjaygpOyAvLyBhbHNvIGRvZXMgdXNhZ2UgYW5kIGxhYmVsIGNoZWNrcwoKICAgIC8vIHVuc3RhY2sgdGhlIGZ1bmN0aW9uIG91dGVyIHN0YWNrCiAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnVuc3RhY2soKTsKCiAgICBzdGF0ZS5mdW5jdCA9IHN0YXRlLmZ1bmN0WyIoY29udGV4dCkiXTsKCiAgICBpZiAoIWlnbm9yZUxvb3BGdW5jICYmICFzdGF0ZS5vcHRpb24ubG9vcGZ1bmMgJiYgc3RhdGUuZnVuY3RbIihsb29wYWdlKSJdKSB7CiAgICAgIC8vIElmIHRoZSBmdW5jdGlvbiB3ZSBqdXN0IHBhcnNlZCBhY2Nlc3NlcyBhbnkgbm9uLWxvY2FsIHZhcmlhYmxlcwogICAgICAvLyB0cmlnZ2VyIGEgd2FybmluZy4gT3RoZXJ3aXNlLCB0aGUgZnVuY3Rpb24gaXMgc2FmZSBldmVuIHdpdGhpbgogICAgICAvLyBhIGxvb3AuCiAgICAgIGlmIChmWyIoaXNDYXB0dXJpbmcpIl0pIHsKICAgICAgICB3YXJuaW5nKCJXMDgzIiwgdG9rZW4pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGY7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVNZXRyaWNzKGZ1bmN0aW9uU3RhcnRUb2tlbikgewogICAgcmV0dXJuIHsKICAgICAgc3RhdGVtZW50Q291bnQ6IDAsCiAgICAgIG5lc3RlZEJsb2NrRGVwdGg6IC0xLAogICAgICBDb21wbGV4aXR5Q291bnQ6IDEsCiAgICAgIGFyaXR5OiAwLAoKICAgICAgdmVyaWZ5TWF4U3RhdGVtZW50c1BlckZ1bmN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoc3RhdGUub3B0aW9uLm1heHN0YXRlbWVudHMgJiYKICAgICAgICAgIHRoaXMuc3RhdGVtZW50Q291bnQgPiBzdGF0ZS5vcHRpb24ubWF4c3RhdGVtZW50cykgewogICAgICAgICAgd2FybmluZygiVzA3MSIsIGZ1bmN0aW9uU3RhcnRUb2tlbiwgdGhpcy5zdGF0ZW1lbnRDb3VudCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgdmVyaWZ5TWF4UGFyYW1ldGVyc1BlckZ1bmN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoXy5pc051bWJlcihzdGF0ZS5vcHRpb24ubWF4cGFyYW1zKSAmJgogICAgICAgICAgdGhpcy5hcml0eSA+IHN0YXRlLm9wdGlvbi5tYXhwYXJhbXMpIHsKICAgICAgICAgIHdhcm5pbmcoIlcwNzIiLCBmdW5jdGlvblN0YXJ0VG9rZW4sIHRoaXMuYXJpdHkpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHZlcmlmeU1heE5lc3RlZEJsb2NrRGVwdGhQZXJGdW5jdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHN0YXRlLm9wdGlvbi5tYXhkZXB0aCAmJgogICAgICAgICAgdGhpcy5uZXN0ZWRCbG9ja0RlcHRoID4gMCAmJgogICAgICAgICAgdGhpcy5uZXN0ZWRCbG9ja0RlcHRoID09PSBzdGF0ZS5vcHRpb24ubWF4ZGVwdGggKyAxKSB7CiAgICAgICAgICB3YXJuaW5nKCJXMDczIiwgbnVsbCwgdGhpcy5uZXN0ZWRCbG9ja0RlcHRoKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICB2ZXJpZnlNYXhDb21wbGV4aXR5UGVyRnVuY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBtYXggPSBzdGF0ZS5vcHRpb24ubWF4Y29tcGxleGl0eTsKICAgICAgICB2YXIgY2MgPSB0aGlzLkNvbXBsZXhpdHlDb3VudDsKICAgICAgICBpZiAobWF4ICYmIGNjID4gbWF4KSB7CiAgICAgICAgICB3YXJuaW5nKCJXMDc0IiwgZnVuY3Rpb25TdGFydFRva2VuLCBjYyk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gaW5jcmVhc2VDb21wbGV4aXR5Q291bnQoKSB7CiAgICBzdGF0ZS5mdW5jdFsiKG1ldHJpY3MpIl0uQ29tcGxleGl0eUNvdW50ICs9IDE7CiAgfQoKICAvLyBQYXJzZSBhc3NpZ25tZW50cyB0aGF0IHdlcmUgZm91bmQgaW5zdGVhZCBvZiBjb25kaXRpb25hbHMuCiAgLy8gRm9yIGV4YW1wbGU6IGlmIChhID0gMSkgeyAuLi4gfQoKICBmdW5jdGlvbiBjaGVja0NvbmRBc3NpZ25tZW50KGV4cHIpIHsKICAgIHZhciBpZCwgcGFyZW47CiAgICBpZiAoZXhwcikgewogICAgICBpZCA9IGV4cHIuaWQ7CiAgICAgIHBhcmVuID0gZXhwci5wYXJlbjsKICAgICAgaWYgKGlkID09PSAiLCIgJiYgKGV4cHIgPSBleHByLmV4cHJzW2V4cHIuZXhwcnMubGVuZ3RoIC0gMV0pKSB7CiAgICAgICAgaWQgPSBleHByLmlkOwogICAgICAgIHBhcmVuID0gcGFyZW4gfHwgZXhwci5wYXJlbjsKICAgICAgfQogICAgfQogICAgc3dpdGNoIChpZCkgewogICAgY2FzZSAiPSI6CiAgICBjYXNlICIrPSI6CiAgICBjYXNlICItPSI6CiAgICBjYXNlICIqPSI6CiAgICBjYXNlICIlPSI6CiAgICBjYXNlICImPSI6CiAgICBjYXNlICJ8PSI6CiAgICBjYXNlICJePSI6CiAgICBjYXNlICIvPSI6CiAgICAgIGlmICghcGFyZW4gJiYgIXN0YXRlLm9wdGlvbi5ib3NzKSB7CiAgICAgICAgd2FybmluZygiVzA4NCIpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBAcGFyYW0ge29iamVjdH0gcHJvcHMgQ29sbGVjdGlvbiBvZiBwcm9wZXJ0eSBkZXNjcmlwdG9ycyBmb3IgYSBnaXZlbgogICAqICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gY2hlY2tQcm9wZXJ0aWVzKHByb3BzKSB7CiAgICAvLyBDaGVjayBmb3IgbG9uZWx5IHNldHRlcnMgaWYgaW4gdGhlIEVTNSBtb2RlLgogICAgaWYgKHN0YXRlLmluRVM1KCkpIHsKICAgICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wcykgewogICAgICAgIGlmIChwcm9wc1tuYW1lXSAmJiBwcm9wc1tuYW1lXS5zZXR0ZXJUb2tlbiAmJiAhcHJvcHNbbmFtZV0uZ2V0dGVyVG9rZW4pIHsKICAgICAgICAgIHdhcm5pbmcoIlcwNzgiLCBwcm9wc1tuYW1lXS5zZXR0ZXJUb2tlbik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtZXRhUHJvcGVydHkobmFtZSwgYykgewogICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIi4iKSkgewogICAgICB2YXIgbGVmdCA9IHN0YXRlLnRva2Vucy5jdXJyLmlkOwogICAgICBhZHZhbmNlKCIuIik7CiAgICAgIHZhciBpZCA9IGlkZW50aWZpZXIoKTsKICAgICAgc3RhdGUudG9rZW5zLmN1cnIuaXNNZXRhUHJvcGVydHkgPSB0cnVlOwogICAgICBpZiAobmFtZSAhPT0gaWQpIHsKICAgICAgICBlcnJvcigiRTA1NyIsIHN0YXRlLnRva2Vucy5wcmV2LCBsZWZ0LCBpZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYygpOwogICAgICB9CiAgICAgIHJldHVybiBzdGF0ZS50b2tlbnMuY3VycjsKICAgIH0KICB9CgogIChmdW5jdGlvbih4KSB7CiAgICB4Lm51ZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYiwgZiwgaSwgcCwgdCwgaXNHZW5lcmF0b3JNZXRob2QgPSBmYWxzZSwgbmV4dFZhbDsKICAgICAgdmFyIHByb3BzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsgLy8gQWxsIHByb3BlcnRpZXMsIGluY2x1ZGluZyBhY2Nlc3NvcnMKCiAgICAgIGIgPSBzdGF0ZS50b2tlbnMuY3Vyci5saW5lICE9PSBzdGFydExpbmUoc3RhdGUudG9rZW5zLm5leHQpOwogICAgICBpZiAoYikgewogICAgICAgIGluZGVudCArPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5mcm9tID09PSBpbmRlbnQgKyBzdGF0ZS5vcHRpb24uaW5kZW50KSB7CiAgICAgICAgICBpbmRlbnQgKz0gc3RhdGUub3B0aW9uLmluZGVudDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBibG9ja3R5cGUgPSBsb29rdXBCbG9ja1R5cGUoKTsKICAgICAgaWYgKGJsb2NrdHlwZS5pc0Rlc3RBc3NpZ24pIHsKICAgICAgICB0aGlzLmRlc3RydWN0QXNzaWduID0gZGVzdHJ1Y3R1cmluZ1BhdHRlcm4oeyBvcGVuaW5nUGFyc2VkOiB0cnVlLCBhc3NpZ25tZW50OiB0cnVlIH0pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBmb3IgKDs7KSB7CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAifSIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgbmV4dFZhbCA9IHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlOwogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZGVudGlmaWVyICYmCiAgICAgICAgICAgIChwZWVrSWdub3JlRU9MKCkuaWQgPT09ICIsIiB8fCBwZWVrSWdub3JlRU9MKCkuaWQgPT09ICJ9IikpIHsKICAgICAgICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICAgICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLm5leHQsICJvYmplY3Qgc2hvcnQgbm90YXRpb24iLCAiNiIpOwogICAgICAgICAgfQogICAgICAgICAgaSA9IHByb3BlcnR5TmFtZSh0cnVlKTsKICAgICAgICAgIHNhdmVQcm9wZXJ0eShwcm9wcywgaSwgc3RhdGUudG9rZW5zLm5leHQpOwoKICAgICAgICAgIGV4cHJlc3Npb24oMTApOwoKICAgICAgICB9IGVsc2UgaWYgKHBlZWsoKS5pZCAhPT0gIjoiICYmIChuZXh0VmFsID09PSAiZ2V0IiB8fCBuZXh0VmFsID09PSAic2V0IikpIHsKICAgICAgICAgIGFkdmFuY2UobmV4dFZhbCk7CgogICAgICAgICAgaWYgKCFzdGF0ZS5pbkVTNSgpKSB7CiAgICAgICAgICAgIGVycm9yKCJFMDM0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgaSA9IHByb3BlcnR5TmFtZSgpOwoKICAgICAgICAgIC8vIEVTNiBhbGxvd3MgZm9yIGdldCgpIHsuLi59IGFuZCBzZXQoKSB7Li4ufSBtZXRob2QKICAgICAgICAgIC8vIGRlZmluaXRpb24gc2hvcnRoYW5kIHN5bnRheCwgc28gd2UgZG9uJ3QgcHJvZHVjZSBhbiBlcnJvcgogICAgICAgICAgLy8gaWYgbGludGluZyBFQ01BU2NyaXB0IDYgY29kZS4KICAgICAgICAgIGlmICghaSAmJiAhc3RhdGUuaW5FUzYoKSkgewogICAgICAgICAgICBlcnJvcigiRTAzNSIpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gc2F2ZSB0aGlzIGdldHRlciB1bmxlc3MgaXQncyBhbiBhY3R1YWwgZ2V0dGVyCiAgICAgICAgICAvLyBhbmQgbm90IGFuIEVTNiBjb25jaXNlIG1ldGhvZAogICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgc2F2ZUFjY2Vzc29yKG5leHRWYWwsIHByb3BzLCBpLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgICAgICB9CgogICAgICAgICAgdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgICAgICAgZiA9IGRvRnVuY3Rpb24oKTsKICAgICAgICAgIHAgPSBmWyIocGFyYW1zKSJdOwoKICAgICAgICAgIC8vIERvbid0IHdhcm4gYWJvdXQgZ2V0dGVyL3NldHRlciBwYWlycyBpZiB0aGlzIGlzIGFuIEVTNiBjb25jaXNlIG1ldGhvZAogICAgICAgICAgaWYgKG5leHRWYWwgPT09ICJnZXQiICYmIGkgJiYgcCkgewogICAgICAgICAgICB3YXJuaW5nKCJXMDc2IiwgdCwgcFswXSwgaSk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5leHRWYWwgPT09ICJzZXQiICYmIGkgJiYgZlsiKG1ldHJpY3MpIl0uYXJpdHkgIT09IDEpIHsKICAgICAgICAgICAgd2FybmluZygiVzA3NyIsIHQsIGkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICIqIiAmJiBzdGF0ZS50b2tlbnMubmV4dC50eXBlID09PSAiKHB1bmN0dWF0b3IpIikgewogICAgICAgICAgICBpZiAoIXN0YXRlLmluRVM2KCkpIHsKICAgICAgICAgICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLm5leHQsICJnZW5lcmF0b3IgZnVuY3Rpb25zIiwgIjYiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZHZhbmNlKCIqIik7CiAgICAgICAgICAgIGlzR2VuZXJhdG9yTWV0aG9kID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlzR2VuZXJhdG9yTWV0aG9kID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiWyIpIHsKICAgICAgICAgICAgaSA9IGNvbXB1dGVkUHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgIHN0YXRlLm5hbWVTdGFjay5zZXQoaSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS5uYW1lU3RhY2suc2V0KHN0YXRlLnRva2Vucy5uZXh0KTsKICAgICAgICAgICAgaSA9IHByb3BlcnR5TmFtZSgpOwogICAgICAgICAgICBzYXZlUHJvcGVydHkocHJvcHMsIGksIHN0YXRlLnRva2Vucy5uZXh0KTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgaSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIigiKSB7CiAgICAgICAgICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICAgICAgICAgIHdhcm5pbmcoIlcxMDQiLCBzdGF0ZS50b2tlbnMuY3VyciwgImNvbmNpc2UgbWV0aG9kcyIsICI2Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9GdW5jdGlvbih7IHR5cGU6IGlzR2VuZXJhdG9yTWV0aG9kID8gImdlbmVyYXRvciIgOiBudWxsIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWR2YW5jZSgiOiIpOwogICAgICAgICAgICBleHByZXNzaW9uKDEwKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvdW50TWVtYmVyKGkpOwoKICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIsIikgewogICAgICAgICAgcGFyc2VDb21tYSh7IGFsbG93VHJhaWxpbmc6IHRydWUsIHByb3BlcnR5OiB0cnVlIH0pOwogICAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiLCIpIHsKICAgICAgICAgICAgd2FybmluZygiVzA3MCIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJ9IiAmJiAhc3RhdGUuaW5FUzUoKSkgewogICAgICAgICAgICB3YXJuaW5nKCJXMDcwIiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGIpIHsKICAgICAgICBpbmRlbnQgLT0gc3RhdGUub3B0aW9uLmluZGVudDsKICAgICAgfQogICAgICBhZHZhbmNlKCJ9IiwgdGhpcyk7CgogICAgICBjaGVja1Byb3BlcnRpZXMocHJvcHMpOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgeC5mdWQgPSBmdW5jdGlvbigpIHsKICAgICAgZXJyb3IoIkUwMzYiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICB9OwogIH0oZGVsaW0oInsiKSkpOwoKICBmdW5jdGlvbiBkZXN0cnVjdHVyaW5nUGF0dGVybihvcHRpb25zKSB7CiAgICB2YXIgaXNBc3NpZ25tZW50ID0gb3B0aW9ucyAmJiBvcHRpb25zLmFzc2lnbm1lbnQ7CgogICAgaWYgKCFzdGF0ZS5pbkVTNigpKSB7CiAgICAgIHdhcm5pbmcoIlcxMDQiLCBzdGF0ZS50b2tlbnMuY3VyciwKICAgICAgICBpc0Fzc2lnbm1lbnQgPyAiZGVzdHJ1Y3R1cmluZyBhc3NpZ25tZW50IiA6ICJkZXN0cnVjdHVyaW5nIGJpbmRpbmciLCAiNiIpOwogICAgfQoKICAgIHJldHVybiBkZXN0cnVjdHVyaW5nUGF0dGVyblJlY3Vyc2l2ZShvcHRpb25zKTsKICB9CgogIGZ1bmN0aW9uIGRlc3RydWN0dXJpbmdQYXR0ZXJuUmVjdXJzaXZlKG9wdGlvbnMpIHsKICAgIHZhciBpZHM7CiAgICB2YXIgaWRlbnRpZmllcnMgPSBbXTsKICAgIHZhciBvcGVuaW5nUGFyc2VkID0gb3B0aW9ucyAmJiBvcHRpb25zLm9wZW5pbmdQYXJzZWQ7CiAgICB2YXIgaXNBc3NpZ25tZW50ID0gb3B0aW9ucyAmJiBvcHRpb25zLmFzc2lnbm1lbnQ7CiAgICB2YXIgcmVjdXJzaXZlT3B0aW9ucyA9IGlzQXNzaWdubWVudCA/IHsgYXNzaWdubWVudDogaXNBc3NpZ25tZW50IH0gOiBudWxsOwogICAgdmFyIGZpcnN0VG9rZW4gPSBvcGVuaW5nUGFyc2VkID8gc3RhdGUudG9rZW5zLmN1cnIgOiBzdGF0ZS50b2tlbnMubmV4dDsKCiAgICB2YXIgbmV4dElubmVyREUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGlkZW50OwogICAgICBpZiAoY2hlY2tQdW5jdHVhdG9ycyhzdGF0ZS50b2tlbnMubmV4dCwgWyJbIiwgInsiXSkpIHsKICAgICAgICBpZHMgPSBkZXN0cnVjdHVyaW5nUGF0dGVyblJlY3Vyc2l2ZShyZWN1cnNpdmVPcHRpb25zKTsKICAgICAgICBmb3IgKHZhciBpZCBpbiBpZHMpIHsKICAgICAgICAgIGlkID0gaWRzW2lkXTsKICAgICAgICAgIGlkZW50aWZpZXJzLnB1c2goeyBpZDogaWQuaWQsIHRva2VuOiBpZC50b2tlbiB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLCIpKSB7CiAgICAgICAgaWRlbnRpZmllcnMucHVzaCh7IGlkOiBudWxsLCB0b2tlbjogc3RhdGUudG9rZW5zLmN1cnIgfSk7CiAgICAgIH0gZWxzZSBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiKCIpKSB7CiAgICAgICAgYWR2YW5jZSgiKCIpOwogICAgICAgIG5leHRJbm5lckRFKCk7CiAgICAgICAgYWR2YW5jZSgiKSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpc19yZXN0ID0gY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLi4uIik7CgogICAgICAgIGlmIChpc0Fzc2lnbm1lbnQpIHsKICAgICAgICAgIHZhciBhc3NpZ25UYXJnZXQgPSBleHByZXNzaW9uKDIwKTsKICAgICAgICAgIGlmIChhc3NpZ25UYXJnZXQpIHsKICAgICAgICAgICAgY2hlY2tMZWZ0U2lkZUFzc2lnbihhc3NpZ25UYXJnZXQpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIHRhcmdldCB3YXMgYSBzaW1wbGUgaWRlbnRpZmllciwgYWRkIGl0IHRvIHRoZSBsaXN0IHRvIHJldHVybgogICAgICAgICAgICBpZiAoYXNzaWduVGFyZ2V0LmlkZW50aWZpZXIpIHsKICAgICAgICAgICAgICBpZGVudCA9IGFzc2lnblRhcmdldC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZGVudCA9IGlkZW50aWZpZXIoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlkZW50KSB7CiAgICAgICAgICBpZGVudGlmaWVycy5wdXNoKHsgaWQ6IGlkZW50LCB0b2tlbjogc3RhdGUudG9rZW5zLmN1cnIgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpc19yZXN0OwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICB2YXIgYXNzaWdubWVudFByb3BlcnR5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpZDsKICAgICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIlsiKSkgewogICAgICAgIGFkdmFuY2UoIlsiKTsKICAgICAgICBleHByZXNzaW9uKDEwKTsKICAgICAgICBhZHZhbmNlKCJdIik7CiAgICAgICAgYWR2YW5jZSgiOiIpOwogICAgICAgIG5leHRJbm5lckRFKCk7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICIoc3RyaW5nKSIgfHwKICAgICAgICAgICAgICAgICBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIihudW1iZXIpIikgewogICAgICAgIGFkdmFuY2UoKTsKICAgICAgICBhZHZhbmNlKCI6Iik7CiAgICAgICAgbmV4dElubmVyREUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB0aGlzIGlkIHdpbGwgZWl0aGVyIGJlIHRoZSBwcm9wZXJ0eSBuYW1lIG9yIHRoZSBwcm9wZXJ0eSBuYW1lIGFuZCB0aGUgYXNzaWduaW5nIGlkZW50aWZpZXIKICAgICAgICBpZCA9IGlkZW50aWZpZXIoKTsKICAgICAgICBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiOiIpKSB7CiAgICAgICAgICBhZHZhbmNlKCI6Iik7CiAgICAgICAgICBuZXh0SW5uZXJERSgpOwogICAgICAgIH0gZWxzZSBpZiAoaWQpIHsKICAgICAgICAgIC8vIGluIHRoaXMgY2FzZSB3ZSBhcmUgYXNzaWduaW5nIChub3QgZGVjbGFyaW5nKSwgc28gY2hlY2sgYXNzaWdubWVudAogICAgICAgICAgaWYgKGlzQXNzaWdubWVudCkgewogICAgICAgICAgICBjaGVja0xlZnRTaWRlQXNzaWduKHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICAgIH0KICAgICAgICAgIGlkZW50aWZpZXJzLnB1c2goeyBpZDogaWQsIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGlkLCB2YWx1ZTsKICAgIGlmIChjaGVja1B1bmN0dWF0b3IoZmlyc3RUb2tlbiwgIlsiKSkgewogICAgICBpZiAoIW9wZW5pbmdQYXJzZWQpIHsKICAgICAgICBhZHZhbmNlKCJbIik7CiAgICAgIH0KICAgICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIl0iKSkgewogICAgICAgIHdhcm5pbmcoIlcxMzciLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIH0KICAgICAgdmFyIGVsZW1lbnRfYWZ0ZXJfcmVzdCA9IGZhbHNlOwogICAgICB3aGlsZSAoIWNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIl0iKSkgewogICAgICAgIGlmIChuZXh0SW5uZXJERSgpICYmICFlbGVtZW50X2FmdGVyX3Jlc3QgJiYKICAgICAgICAgICAgY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiLCIpKSB7CiAgICAgICAgICB3YXJuaW5nKCJXMTMwIiwgc3RhdGUudG9rZW5zLm5leHQpOwogICAgICAgICAgZWxlbWVudF9hZnRlcl9yZXN0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIj0iKSkgewogICAgICAgICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMucHJldiwgIi4uLiIpKSB7CiAgICAgICAgICAgIGFkdmFuY2UoIl0iKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkdmFuY2UoIj0iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlkID0gc3RhdGUudG9rZW5zLnByZXY7CiAgICAgICAgICB2YWx1ZSA9IGV4cHJlc3Npb24oMTApOwogICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnR5cGUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwODAiLCBpZCwgaWQudmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIl0iKSkgewogICAgICAgICAgYWR2YW5jZSgiLCIpOwogICAgICAgIH0KICAgICAgfQogICAgICBhZHZhbmNlKCJdIik7CiAgICB9IGVsc2UgaWYgKGNoZWNrUHVuY3R1YXRvcihmaXJzdFRva2VuLCAieyIpKSB7CgogICAgICBpZiAoIW9wZW5pbmdQYXJzZWQpIHsKICAgICAgICBhZHZhbmNlKCJ7Iik7CiAgICAgIH0KICAgICAgaWYgKGNoZWNrUHVuY3R1YXRvcihzdGF0ZS50b2tlbnMubmV4dCwgIn0iKSkgewogICAgICAgIHdhcm5pbmcoIlcxMzciLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIH0KICAgICAgd2hpbGUgKCFjaGVja1B1bmN0dWF0b3Ioc3RhdGUudG9rZW5zLm5leHQsICJ9IikpIHsKICAgICAgICBhc3NpZ25tZW50UHJvcGVydHkoKTsKICAgICAgICBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiPSIpKSB7CiAgICAgICAgICBhZHZhbmNlKCI9Iik7CiAgICAgICAgICBpZCA9IHN0YXRlLnRva2Vucy5wcmV2OwogICAgICAgICAgdmFsdWUgPSBleHByZXNzaW9uKDEwKTsKICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS50eXBlID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB3YXJuaW5nKCJXMDgwIiwgaWQsIGlkLnZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFjaGVja1B1bmN0dWF0b3Ioc3RhdGUudG9rZW5zLm5leHQsICJ9IikpIHsKICAgICAgICAgIGFkdmFuY2UoIiwiKTsKICAgICAgICAgIGlmIChjaGVja1B1bmN0dWF0b3Ioc3RhdGUudG9rZW5zLm5leHQsICJ9IikpIHsKICAgICAgICAgICAgLy8gVHJhaWxpbmcgY29tbWEKICAgICAgICAgICAgLy8gT2JqZWN0QmluZGluZ1BhdHRlcm46IHsgQmluZGluZ1Byb3BlcnR5TGlzdCAsIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGFkdmFuY2UoIn0iKTsKICAgIH0KICAgIHJldHVybiBpZGVudGlmaWVyczsKICB9CgogIGZ1bmN0aW9uIGRlc3RydWN0dXJpbmdQYXR0ZXJuTWF0Y2godG9rZW5zLCB2YWx1ZSkgewogICAgdmFyIGZpcnN0ID0gdmFsdWUuZmlyc3Q7CgogICAgaWYgKCFmaXJzdCkKICAgICAgcmV0dXJuOwoKICAgIF8uemlwKHRva2VucywgQXJyYXkuaXNBcnJheShmaXJzdCkgPyBmaXJzdCA6IFsgZmlyc3QgXSkuZm9yRWFjaChmdW5jdGlvbih2YWwpIHsKICAgICAgdmFyIHRva2VuID0gdmFsWzBdOwogICAgICB2YXIgdmFsdWUgPSB2YWxbMV07CgogICAgICBpZiAodG9rZW4gJiYgdmFsdWUpCiAgICAgICAgdG9rZW4uZmlyc3QgPSB2YWx1ZTsKICAgICAgZWxzZSBpZiAodG9rZW4gJiYgdG9rZW4uZmlyc3QgJiYgIXZhbHVlKQogICAgICAgIHdhcm5pbmcoIlcwODAiLCB0b2tlbi5maXJzdCwgdG9rZW4uZmlyc3QudmFsdWUpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBibG9ja1ZhcmlhYmxlU3RhdGVtZW50KHR5cGUsIHN0YXRlbWVudCwgY29udGV4dCkgewogICAgLy8gdXNlZCBmb3IgYm90aCBsZXQgYW5kIGNvbnN0IHN0YXRlbWVudHMKCiAgICB2YXIgcHJlZml4ID0gY29udGV4dCAmJiBjb250ZXh0LnByZWZpeDsKICAgIHZhciBpbmV4cG9ydCA9IGNvbnRleHQgJiYgY29udGV4dC5pbmV4cG9ydDsKICAgIHZhciBpc0xldCA9IHR5cGUgPT09ICJsZXQiOwogICAgdmFyIGlzQ29uc3QgPSB0eXBlID09PSAiY29uc3QiOwogICAgdmFyIHRva2VucywgbG9uZSwgdmFsdWUsIGxldGJsb2NrOwoKICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLmN1cnIsIHR5cGUsICI2Iik7CiAgICB9CgogICAgaWYgKGlzTGV0ICYmIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiKCIpIHsKICAgICAgaWYgKCFzdGF0ZS5pbk1veigpKSB7CiAgICAgICAgd2FybmluZygiVzExOCIsIHN0YXRlLnRva2Vucy5uZXh0LCAibGV0IGJsb2NrIik7CiAgICAgIH0KICAgICAgYWR2YW5jZSgiKCIpOwogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCk7CiAgICAgIGxldGJsb2NrID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoc3RhdGUuZnVuY3RbIihub2Jsb2Nrc2NvcGVkdmFyKSJdKSB7CiAgICAgIGVycm9yKCJFMDQ4Iiwgc3RhdGUudG9rZW5zLmN1cnIsIGlzQ29uc3QgPyAiQ29uc3QiIDogIkxldCIpOwogICAgfQoKICAgIHN0YXRlbWVudC5maXJzdCA9IFtdOwogICAgZm9yICg7OykgewogICAgICB2YXIgbmFtZXMgPSBbXTsKICAgICAgaWYgKF8uY29udGFpbnMoWyJ7IiwgIlsiXSwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpKSB7CiAgICAgICAgdG9rZW5zID0gZGVzdHJ1Y3R1cmluZ1BhdHRlcm4oKTsKICAgICAgICBsb25lID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9rZW5zID0gWyB7IGlkOiBpZGVudGlmaWVyKCksIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9IF07CiAgICAgICAgbG9uZSA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghcHJlZml4ICYmIGlzQ29uc3QgJiYgc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI9IikgewogICAgICAgIHdhcm5pbmcoIkUwMTIiLCBzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLmN1cnIudmFsdWUpOwogICAgICB9CgogICAgICBmb3IgKHZhciB0IGluIHRva2VucykgewogICAgICAgIGlmICh0b2tlbnMuaGFzT3duUHJvcGVydHkodCkpIHsKICAgICAgICAgIHQgPSB0b2tlbnNbdF07CiAgICAgICAgICBpZiAoc3RhdGUuZnVuY3RbIihzY29wZSkiXS5ibG9jay5pc0dsb2JhbCgpKSB7CiAgICAgICAgICAgIGlmIChwcmVkZWZpbmVkW3QuaWRdID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHdhcm5pbmcoIlcwNzkiLCB0LnRva2VuLCB0LmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHQuaWQgJiYgIXN0YXRlLmZ1bmN0WyIobm9ibG9ja3Njb3BlZHZhcikiXSkgewogICAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmFkZGxhYmVsKHQuaWQsIHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIHRva2VuOiB0LnRva2VuIH0pOwogICAgICAgICAgICBuYW1lcy5wdXNoKHQudG9rZW4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiPSIpIHsKICAgICAgICBhZHZhbmNlKCI9Iik7CiAgICAgICAgaWYgKCFwcmVmaXggJiYgcGVlaygwKS5pZCA9PT0gIj0iICYmIHN0YXRlLnRva2Vucy5uZXh0LmlkZW50aWZpZXIpIHsKICAgICAgICAgIHdhcm5pbmcoIlcxMjAiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgIH0KICAgICAgICB2YXIgaWQgPSBzdGF0ZS50b2tlbnMucHJldjsKICAgICAgICAvLyBkb24ndCBhY2NlcHQgYGluYCBpbiBleHByZXNzaW9uIGlmIHByZWZpeCBpcyB1c2VkIGZvciBGb3JJbi9PZiBsb29wLgogICAgICAgIHZhbHVlID0gZXhwcmVzc2lvbihwcmVmaXggPyAxMjAgOiAxMCk7CiAgICAgICAgaWYgKCFwcmVmaXggJiYgdmFsdWUgJiYgdmFsdWUudHlwZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHdhcm5pbmcoIlcwODAiLCBpZCwgaWQudmFsdWUpOwogICAgICAgIH0KICAgICAgICBpZiAobG9uZSkgewogICAgICAgICAgdG9rZW5zWzBdLmZpcnN0ID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlc3RydWN0dXJpbmdQYXR0ZXJuTWF0Y2gobmFtZXMsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghcHJlZml4KSB7CiAgICAgICAgZm9yICh0IGluIHRva2VucykgewogICAgICAgICAgaWYgKHRva2Vucy5oYXNPd25Qcm9wZXJ0eSh0KSkgewogICAgICAgICAgICB0ID0gdG9rZW5zW3RdOwogICAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmluaXRpYWxpemUodC5pZCk7CgogICAgICAgICAgICBpZiAobG9uZSAmJiBpbmV4cG9ydCkgewogICAgICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc2V0RXhwb3J0ZWQodC50b2tlbi52YWx1ZSwgdC50b2tlbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHN0YXRlbWVudC5maXJzdCA9IHN0YXRlbWVudC5maXJzdC5jb25jYXQobmFtZXMpOwoKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiLCIpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwYXJzZUNvbW1hKCk7CiAgICB9CiAgICBpZiAobGV0YmxvY2spIHsKICAgICAgYWR2YW5jZSgiKSIpOwogICAgICBibG9jayh0cnVlLCB0cnVlKTsKICAgICAgc3RhdGVtZW50LmJsb2NrID0gdHJ1ZTsKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS51bnN0YWNrKCk7CiAgICB9CgogICAgcmV0dXJuIHN0YXRlbWVudDsKICB9CgogIHZhciBjb25zdHN0YXRlbWVudCA9IHN0bXQoImNvbnN0IiwgZnVuY3Rpb24oY29udGV4dCkgewogICAgcmV0dXJuIGJsb2NrVmFyaWFibGVTdGF0ZW1lbnQoImNvbnN0IiwgdGhpcywgY29udGV4dCk7CiAgfSk7CiAgY29uc3RzdGF0ZW1lbnQuZXhwcyA9IHRydWU7CgogIHZhciBsZXRzdGF0ZW1lbnQgPSBzdG10KCJsZXQiLCBmdW5jdGlvbihjb250ZXh0KSB7CiAgICByZXR1cm4gYmxvY2tWYXJpYWJsZVN0YXRlbWVudCgibGV0IiwgdGhpcywgY29udGV4dCk7CiAgfSk7CiAgbGV0c3RhdGVtZW50LmV4cHMgPSB0cnVlOwoKICB2YXIgdmFyc3RhdGVtZW50ID0gc3RtdCgidmFyIiwgZnVuY3Rpb24oY29udGV4dCkgewogICAgdmFyIHByZWZpeCA9IGNvbnRleHQgJiYgY29udGV4dC5wcmVmaXg7CiAgICB2YXIgaW5leHBvcnQgPSBjb250ZXh0ICYmIGNvbnRleHQuaW5leHBvcnQ7CiAgICB2YXIgdG9rZW5zLCBsb25lLCB2YWx1ZTsKCiAgICAvLyBJZiB0aGUgYGltcGxpZWRgIG9wdGlvbiBpcyBzZXQsIGJpbmRpbmdzIGFyZSBzZXQgZGlmZmVyZW50bHkuCiAgICB2YXIgaW1wbGllZCA9IGNvbnRleHQgJiYgY29udGV4dC5pbXBsaWVkOwogICAgdmFyIHJlcG9ydCA9ICEoY29udGV4dCAmJiBjb250ZXh0Lmlnbm9yZSk7CgogICAgdGhpcy5maXJzdCA9IFtdOwogICAgZm9yICg7OykgewogICAgICB2YXIgbmFtZXMgPSBbXTsKICAgICAgaWYgKF8uY29udGFpbnMoWyJ7IiwgIlsiXSwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpKSB7CiAgICAgICAgdG9rZW5zID0gZGVzdHJ1Y3R1cmluZ1BhdHRlcm4oKTsKICAgICAgICBsb25lID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9rZW5zID0gWyB7IGlkOiBpZGVudGlmaWVyKCksIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9IF07CiAgICAgICAgbG9uZSA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghKHByZWZpeCAmJiBpbXBsaWVkKSAmJiByZXBvcnQgJiYgc3RhdGUub3B0aW9uLnZhcnN0bXQpIHsKICAgICAgICB3YXJuaW5nKCJXMTMyIiwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuZmlyc3QgPSB0aGlzLmZpcnN0LmNvbmNhdChuYW1lcyk7CgogICAgICBmb3IgKHZhciB0IGluIHRva2VucykgewogICAgICAgIGlmICh0b2tlbnMuaGFzT3duUHJvcGVydHkodCkpIHsKICAgICAgICAgIHQgPSB0b2tlbnNbdF07CiAgICAgICAgICBpZiAoIWltcGxpZWQgJiYgc3RhdGUuZnVuY3RbIihnbG9iYWwpIl0gJiYgIXN0YXRlLmltcGxpZWRDbG9zdXJlKCkpIHsKICAgICAgICAgICAgaWYgKHByZWRlZmluZWRbdC5pZF0gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgd2FybmluZygiVzA3OSIsIHQudG9rZW4sIHQuaWQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLm9wdGlvbi5mdXR1cmVob3N0aWxlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGlmICgoIXN0YXRlLmluRVM1KCkgJiYgdmFycy5lY21hSWRlbnRpZmllcnNbNV1bdC5pZF0gPT09IGZhbHNlKSB8fAogICAgICAgICAgICAgICAgKCFzdGF0ZS5pbkVTNigpICYmIHZhcnMuZWNtYUlkZW50aWZpZXJzWzZdW3QuaWRdID09PSBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHdhcm5pbmcoIlcxMjkiLCB0LnRva2VuLCB0LmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICh0LmlkKSB7CiAgICAgICAgICAgIGlmIChpbXBsaWVkID09PSAiZm9yIikgewoKICAgICAgICAgICAgICBpZiAoIXN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uaGFzKHQuaWQpKSB7CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0KSB3YXJuaW5nKCJXMDg4IiwgdC50b2tlbiwgdC5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYmxvY2sudXNlKHQuaWQsIHQudG9rZW4pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYWRkbGFiZWwodC5pZCwgewogICAgICAgICAgICAgICAgdHlwZTogInZhciIsCiAgICAgICAgICAgICAgICB0b2tlbjogdC50b2tlbiB9KTsKCiAgICAgICAgICAgICAgaWYgKGxvbmUgJiYgaW5leHBvcnQpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc2V0RXhwb3J0ZWQodC5pZCwgdC50b2tlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5hbWVzLnB1c2godC50b2tlbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICI9IikgewogICAgICAgIHN0YXRlLm5hbWVTdGFjay5zZXQoc3RhdGUudG9rZW5zLmN1cnIpOwoKICAgICAgICBhZHZhbmNlKCI9Iik7CiAgICAgICAgaWYgKHBlZWsoMCkuaWQgPT09ICI9IiAmJiBzdGF0ZS50b2tlbnMubmV4dC5pZGVudGlmaWVyKSB7CiAgICAgICAgICBpZiAoIXByZWZpeCAmJiByZXBvcnQgJiYKICAgICAgICAgICAgICAhc3RhdGUuZnVuY3RbIihwYXJhbXMpIl0gfHwKICAgICAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHBhcmFtcykiXS5pbmRleE9mKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKSA9PT0gLTEpIHsKICAgICAgICAgICAgd2FybmluZygiVzEyMCIsIHN0YXRlLnRva2Vucy5uZXh0LCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBpZCA9IHN0YXRlLnRva2Vucy5wcmV2OwogICAgICAgIC8vIGRvbid0IGFjY2VwdCBgaW5gIGluIGV4cHJlc3Npb24gaWYgcHJlZml4IGlzIHVzZWQgZm9yIEZvckluL09mIGxvb3AuCiAgICAgICAgdmFsdWUgPSBleHByZXNzaW9uKHByZWZpeCA/IDEyMCA6IDEwKTsKICAgICAgICBpZiAodmFsdWUgJiYgIXByZWZpeCAmJiByZXBvcnQgJiYgIXN0YXRlLmZ1bmN0WyIobG9vcGFnZSkiXSAmJiB2YWx1ZS50eXBlID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgd2FybmluZygiVzA4MCIsIGlkLCBpZC52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChsb25lKSB7CiAgICAgICAgICB0b2tlbnNbMF0uZmlyc3QgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVzdHJ1Y3R1cmluZ1BhdHRlcm5NYXRjaChuYW1lcywgdmFsdWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiLCIpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwYXJzZUNvbW1hKCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSk7CiAgdmFyc3RhdGVtZW50LmV4cHMgPSB0cnVlOwoKICBibG9ja3N0bXQoImNsYXNzIiwgZnVuY3Rpb24ocmJwKSB7CiAgICByZXR1cm4gY2xhc3NkZWYuY2FsbCh0aGlzLCByYnAsIHRydWUpOwogIH0pOwoKICBmdW5jdGlvbiBjbGFzc2RlZihyYnAsIGlzU3RhdGVtZW50KSB7CgogICAgLypqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi8KICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJjbGFzcyIsICI2Iik7CiAgICB9CiAgICBpZiAoaXNTdGF0ZW1lbnQpIHsKICAgICAgLy8gQmluZGluZ0lkZW50aWZpZXIKICAgICAgdGhpcy5uYW1lID0gaWRlbnRpZmllcigpOwoKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRsYWJlbCh0aGlzLm5hbWUsIHsKICAgICAgICB0eXBlOiAiY2xhc3MiLAogICAgICAgIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9KTsKCiAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkZW50aWZpZXIgJiYgc3RhdGUudG9rZW5zLm5leHQudmFsdWUgIT09ICJleHRlbmRzIikgewogICAgICAvLyBCaW5kaW5nSWRlbnRpZmllcihvcHQpCiAgICAgIHRoaXMubmFtZSA9IGlkZW50aWZpZXIoKTsKICAgICAgdGhpcy5uYW1lZEV4cHIgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5uYW1lID0gc3RhdGUubmFtZVN0YWNrLmluZmVyKCk7CiAgICB9CgogICAgY2xhc3N0YWlsKHRoaXMpOwoKICAgIGlmIChpc1N0YXRlbWVudCkgewogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmluaXRpYWxpemUodGhpcy5uYW1lKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIGNsYXNzdGFpbChjKSB7CiAgICB2YXIgd2FzSW5DbGFzc0JvZHkgPSBzdGF0ZS5pbkNsYXNzQm9keTsKICAgIC8vIENsYXNzSGVyaXRhZ2Uob3B0KQogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiZXh0ZW5kcyIpIHsKICAgICAgYWR2YW5jZSgiZXh0ZW5kcyIpOwogICAgICBjLmhlcml0YWdlID0gZXhwcmVzc2lvbigxMCk7CiAgICB9CgogICAgc3RhdGUuaW5DbGFzc0JvZHkgPSB0cnVlOwogICAgYWR2YW5jZSgieyIpOwogICAgLy8gQ2xhc3NCb2R5KG9wdCkKICAgIGMuYm9keSA9IGNsYXNzYm9keShjKTsKICAgIGFkdmFuY2UoIn0iKTsKICAgIHN0YXRlLmluQ2xhc3NCb2R5ID0gd2FzSW5DbGFzc0JvZHk7CiAgfQoKICBmdW5jdGlvbiBjbGFzc2JvZHkoYykgewogICAgdmFyIG5hbWU7CiAgICB2YXIgaXNTdGF0aWM7CiAgICB2YXIgaXNHZW5lcmF0b3I7CiAgICB2YXIgZ2V0c2V0OwogICAgdmFyIHByb3BzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHZhciBzdGF0aWNQcm9wcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB2YXIgY29tcHV0ZWQ7CiAgICBmb3IgKHZhciBpID0gMDsgc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICJ9IjsgKytpKSB7CiAgICAgIG5hbWUgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgICAgaXNTdGF0aWMgPSBmYWxzZTsKICAgICAgaXNHZW5lcmF0b3IgPSBmYWxzZTsKICAgICAgZ2V0c2V0ID0gbnVsbDsKCiAgICAgIC8vIFRoZSBFUzYgZ3JhbW1hciBmb3IgQ2xhc3NFbGVtZW50IGluY2x1ZGVzIHRoZSBgO2AgdG9rZW4sIGJ1dCBpdCBpcwogICAgICAvLyBkZWZpbmVkIG9ubHkgYXMgYSBwbGFjZWhvbGRlciB0byBmYWNpbGl0YXRlIGZ1dHVyZSBsYW5ndWFnZQogICAgICAvLyBleHRlbnNpb25zLiBJbiBFUzYgY29kZSwgaXQgc2VydmVzIG5vIHB1cnBvc2UuCiAgICAgIGlmIChuYW1lLmlkID09PSAiOyIpIHsKICAgICAgICB3YXJuaW5nKCJXMDMyIik7CiAgICAgICAgYWR2YW5jZSgiOyIpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZiAobmFtZS5pZCA9PT0gIioiKSB7CiAgICAgICAgaXNHZW5lcmF0b3IgPSB0cnVlOwogICAgICAgIGFkdmFuY2UoIioiKTsKICAgICAgICBuYW1lID0gc3RhdGUudG9rZW5zLm5leHQ7CiAgICAgIH0KICAgICAgaWYgKG5hbWUuaWQgPT09ICJbIikgewogICAgICAgIG5hbWUgPSBjb21wdXRlZFByb3BlcnR5TmFtZSgpOwogICAgICAgIGNvbXB1dGVkID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChpc1Byb3BlcnR5TmFtZShuYW1lKSkgewogICAgICAgIC8vIE5vbi1Db21wdXRlZCBQcm9wZXJ0eU5hbWUKICAgICAgICBhZHZhbmNlKCk7CiAgICAgICAgY29tcHV0ZWQgPSBmYWxzZTsKICAgICAgICBpZiAobmFtZS5pZGVudGlmaWVyICYmIG5hbWUudmFsdWUgPT09ICJzdGF0aWMiKSB7CiAgICAgICAgICBpZiAoY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiKiIpKSB7CiAgICAgICAgICAgIGlzR2VuZXJhdG9yID0gdHJ1ZTsKICAgICAgICAgICAgYWR2YW5jZSgiKiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzUHJvcGVydHlOYW1lKHN0YXRlLnRva2Vucy5uZXh0KSB8fCBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIlsiKSB7CiAgICAgICAgICAgIGNvbXB1dGVkID0gc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJbIjsKICAgICAgICAgICAgaXNTdGF0aWMgPSB0cnVlOwogICAgICAgICAgICBuYW1lID0gc3RhdGUudG9rZW5zLm5leHQ7CiAgICAgICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIlsiKSB7CiAgICAgICAgICAgICAgbmFtZSA9IGNvbXB1dGVkUHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgIH0gZWxzZSBhZHZhbmNlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobmFtZS5pZGVudGlmaWVyICYmIChuYW1lLnZhbHVlID09PSAiZ2V0IiB8fCBuYW1lLnZhbHVlID09PSAic2V0IikpIHsKICAgICAgICAgIGlmIChpc1Byb3BlcnR5TmFtZShzdGF0ZS50b2tlbnMubmV4dCkgfHwgc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJbIikgewogICAgICAgICAgICBjb21wdXRlZCA9IHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiWyI7CiAgICAgICAgICAgIGdldHNldCA9IG5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgICAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiWyIpIHsKICAgICAgICAgICAgICBuYW1lID0gY29tcHV0ZWRQcm9wZXJ0eU5hbWUoKTsKICAgICAgICAgICAgfSBlbHNlIGFkdmFuY2UoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybmluZygiVzA1MiIsIHN0YXRlLnRva2Vucy5uZXh0LCBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSB8fCBzdGF0ZS50b2tlbnMubmV4dC50eXBlKTsKICAgICAgICBhZHZhbmNlKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmICghY2hlY2tQdW5jdHVhdG9yKHN0YXRlLnRva2Vucy5uZXh0LCAiKCIpKSB7CiAgICAgICAgLy8gZXJyb3IgLS0tIGNsYXNzIHByb3BlcnRpZXMgbXVzdCBiZSBtZXRob2RzCiAgICAgICAgZXJyb3IoIkUwNTQiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgIHdoaWxlIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIn0iICYmCiAgICAgICAgICAgICAgICFjaGVja1B1bmN0dWF0b3Ioc3RhdGUudG9rZW5zLm5leHQsICIoIikpIHsKICAgICAgICAgIGFkdmFuY2UoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlICE9PSAiKCIpIHsKICAgICAgICAgIGRvRnVuY3Rpb24oeyBzdGF0ZW1lbnQ6IGMgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWNvbXB1dGVkKSB7CiAgICAgICAgLy8gV2UgZG9uJ3Qga25vdyBob3cgdG8gZGV0ZXJtaW5lIGlmIHdlIGhhdmUgZHVwbGljYXRlIGNvbXB1dGVkIHByb3BlcnR5IG5hbWVzIDooCiAgICAgICAgaWYgKGdldHNldCkgewogICAgICAgICAgc2F2ZUFjY2Vzc29yKAogICAgICAgICAgICBnZXRzZXQudmFsdWUsIGlzU3RhdGljID8gc3RhdGljUHJvcHMgOiBwcm9wcywgbmFtZS52YWx1ZSwgbmFtZSwgdHJ1ZSwgaXNTdGF0aWMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAobmFtZS52YWx1ZSA9PT0gImNvbnN0cnVjdG9yIikgewogICAgICAgICAgICBzdGF0ZS5uYW1lU3RhY2suc2V0KGMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUubmFtZVN0YWNrLnNldChuYW1lKTsKICAgICAgICAgIH0KICAgICAgICAgIHNhdmVQcm9wZXJ0eShpc1N0YXRpYyA/IHN0YXRpY1Byb3BzIDogcHJvcHMsIG5hbWUudmFsdWUsIG5hbWUsIHRydWUsIGlzU3RhdGljKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChnZXRzZXQgJiYgbmFtZS52YWx1ZSA9PT0gImNvbnN0cnVjdG9yIikgewogICAgICAgIHZhciBwcm9wRGVzYyA9IGdldHNldC52YWx1ZSA9PT0gImdldCIgPyAiY2xhc3MgZ2V0dGVyIG1ldGhvZCIgOiAiY2xhc3Mgc2V0dGVyIG1ldGhvZCI7CiAgICAgICAgZXJyb3IoIkUwNDkiLCBuYW1lLCBwcm9wRGVzYywgImNvbnN0cnVjdG9yIik7CiAgICAgIH0gZWxzZSBpZiAobmFtZS52YWx1ZSA9PT0gInByb3RvdHlwZSIpIHsKICAgICAgICBlcnJvcigiRTA0OSIsIG5hbWUsICJjbGFzcyBtZXRob2QiLCAicHJvdG90eXBlIik7CiAgICAgIH0KCiAgICAgIHByb3BlcnR5TmFtZShuYW1lKTsKCiAgICAgIGRvRnVuY3Rpb24oewogICAgICAgIHN0YXRlbWVudDogYywKICAgICAgICB0eXBlOiBpc0dlbmVyYXRvciA/ICJnZW5lcmF0b3IiIDogbnVsbCwKICAgICAgICBjbGFzc0V4cHJCaW5kaW5nOiBjLm5hbWVkRXhwciA/IGMubmFtZSA6IG51bGwKICAgICAgfSk7CiAgICB9CgogICAgY2hlY2tQcm9wZXJ0aWVzKHByb3BzKTsKICB9CgogIGJsb2Nrc3RtdCgiZnVuY3Rpb24iLCBmdW5jdGlvbihjb250ZXh0KSB7CiAgICB2YXIgaW5leHBvcnQgPSBjb250ZXh0ICYmIGNvbnRleHQuaW5leHBvcnQ7CiAgICB2YXIgZ2VuZXJhdG9yID0gZmFsc2U7CiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICIqIikgewogICAgICBhZHZhbmNlKCIqIik7CiAgICAgIGlmIChzdGF0ZS5pbkVTNih0cnVlKSkgewogICAgICAgIGdlbmVyYXRvciA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybmluZygiVzExOSIsIHN0YXRlLnRva2Vucy5jdXJyLCAiZnVuY3Rpb24qIiwgIjYiKTsKICAgICAgfQogICAgfQogICAgaWYgKGluYmxvY2spIHsKICAgICAgd2FybmluZygiVzA4MiIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgIH0KICAgIHZhciBpID0gb3B0aW9uYWxpZGVudGlmaWVyKCk7CgogICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRsYWJlbChpLCB7CiAgICAgIHR5cGU6ICJmdW5jdGlvbiIsCiAgICAgIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9KTsKCiAgICBpZiAoaSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHdhcm5pbmcoIlcwMjUiKTsKICAgIH0gZWxzZSBpZiAoaW5leHBvcnQpIHsKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5zZXRFeHBvcnRlZChpLCBzdGF0ZS50b2tlbnMucHJldik7CiAgICB9CgogICAgZG9GdW5jdGlvbih7CiAgICAgIG5hbWU6IGksCiAgICAgIHN0YXRlbWVudDogdGhpcywKICAgICAgdHlwZTogZ2VuZXJhdG9yID8gImdlbmVyYXRvciIgOiBudWxsLAogICAgICBpZ25vcmVMb29wRnVuYzogaW5ibG9jayAvLyBhIGRlY2xhcmF0aW9uIG1heSBhbHJlYWR5IGhhdmUgd2FybmVkCiAgICB9KTsKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIigiICYmIHN0YXRlLnRva2Vucy5uZXh0LmxpbmUgPT09IHN0YXRlLnRva2Vucy5jdXJyLmxpbmUpIHsKICAgICAgZXJyb3IoIkUwMzkiKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0pOwoKICBwcmVmaXgoImZ1bmN0aW9uIiwgZnVuY3Rpb24oKSB7CiAgICB2YXIgZ2VuZXJhdG9yID0gZmFsc2U7CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiKiIpIHsKICAgICAgaWYgKCFzdGF0ZS5pbkVTNigpKSB7CiAgICAgICAgd2FybmluZygiVzExOSIsIHN0YXRlLnRva2Vucy5jdXJyLCAiZnVuY3Rpb24qIiwgIjYiKTsKICAgICAgfQogICAgICBhZHZhbmNlKCIqIik7CiAgICAgIGdlbmVyYXRvciA9IHRydWU7CiAgICB9CgogICAgdmFyIGkgPSBvcHRpb25hbGlkZW50aWZpZXIoKTsKICAgIGRvRnVuY3Rpb24oeyBuYW1lOiBpLCB0eXBlOiBnZW5lcmF0b3IgPyAiZ2VuZXJhdG9yIiA6IG51bGwgfSk7CiAgICByZXR1cm4gdGhpczsKICB9KTsKCiAgYmxvY2tzdG10KCJpZiIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIGluY3JlYXNlQ29tcGxleGl0eUNvdW50KCk7CiAgICBzdGF0ZS5jb25kaXRpb24gPSB0cnVlOwogICAgYWR2YW5jZSgiKCIpOwogICAgdmFyIGV4cHIgPSBleHByZXNzaW9uKDApOwogICAgY2hlY2tDb25kQXNzaWdubWVudChleHByKTsKCiAgICAvLyBXaGVuIHRoZSBpZiBpcyB3aXRoaW4gYSBmb3ItaW4gbG9vcCwgY2hlY2sgaWYgdGhlIGNvbmRpdGlvbgogICAgLy8gc3RhcnRzIHdpdGggYSBuZWdhdGlvbiBvcGVyYXRvcgogICAgdmFyIGZvcmluaWZjaGVjayA9IG51bGw7CiAgICBpZiAoc3RhdGUub3B0aW9uLmZvcmluICYmIHN0YXRlLmZvcmluaWZjaGVja25lZWRlZCkgewogICAgICBzdGF0ZS5mb3JpbmlmY2hlY2tuZWVkZWQgPSBmYWxzZTsgLy8gV2Ugb25seSBuZWVkIHRvIGFuYWx5emUgdGhlIGZpcnN0IGlmIGluc2lkZSB0aGUgbG9vcAogICAgICBmb3JpbmlmY2hlY2sgPSBzdGF0ZS5mb3JpbmlmY2hlY2tzW3N0YXRlLmZvcmluaWZjaGVja3MubGVuZ3RoIC0gMV07CiAgICAgIGlmIChleHByLnR5cGUgPT09ICIocHVuY3R1YXRvcikiICYmIGV4cHIudmFsdWUgPT09ICIhIikgewogICAgICAgIGZvcmluaWZjaGVjay50eXBlID0gIihuZWdhdGl2ZSkiOwogICAgICB9IGVsc2UgewogICAgICAgIGZvcmluaWZjaGVjay50eXBlID0gIihwb3NpdGl2ZSkiOwogICAgICB9CiAgICB9CgogICAgYWR2YW5jZSgiKSIsIHQpOwogICAgc3RhdGUuY29uZGl0aW9uID0gZmFsc2U7CiAgICB2YXIgcyA9IGJsb2NrKHRydWUsIHRydWUpOwoKICAgIC8vIFdoZW4gdGhlIGlmIGlzIHdpdGhpbiBhIGZvci1pbiBsb29wIGFuZCB0aGUgY29uZGl0aW9uIGhhcyBhIG5lZ2F0aXZlIGZvcm0sCiAgICAvLyBjaGVjayBpZiB0aGUgYm9keSBjb250YWlucyBub3RoaW5nIGJ1dCBhIGNvbnRpbnVlIHN0YXRlbWVudAogICAgaWYgKGZvcmluaWZjaGVjayAmJiBmb3JpbmlmY2hlY2sudHlwZSA9PT0gIihuZWdhdGl2ZSkiKSB7CiAgICAgIGlmIChzICYmIHNbMF0gJiYgc1swXS50eXBlID09PSAiKGlkZW50aWZpZXIpIiAmJiBzWzBdLnZhbHVlID09PSAiY29udGludWUiKSB7CiAgICAgICAgZm9yaW5pZmNoZWNrLnR5cGUgPSAiKG5lZ2F0aXZlLXdpdGgtY29udGludWUpIjsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gImVsc2UiKSB7CiAgICAgIGFkdmFuY2UoImVsc2UiKTsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiaWYiIHx8IHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAic3dpdGNoIikgewogICAgICAgIHN0YXRlbWVudCgpOwogICAgICB9IGVsc2UgewogICAgICAgIGJsb2NrKHRydWUsIHRydWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KTsKCiAgYmxvY2tzdG10KCJ0cnkiLCBmdW5jdGlvbigpIHsKICAgIHZhciBiOwoKICAgIGZ1bmN0aW9uIGRvQ2F0Y2goKSB7CiAgICAgIGFkdmFuY2UoImNhdGNoIik7CiAgICAgIGFkdmFuY2UoIigiKTsKCiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc3RhY2soImNhdGNocGFyYW1zIik7CgogICAgICBpZiAoY2hlY2tQdW5jdHVhdG9ycyhzdGF0ZS50b2tlbnMubmV4dCwgWyJbIiwgInsiXSkpIHsKICAgICAgICB2YXIgdG9rZW5zID0gZGVzdHJ1Y3R1cmluZ1BhdHRlcm4oKTsKICAgICAgICBfLmVhY2godG9rZW5zLCBmdW5jdGlvbih0b2tlbikgewogICAgICAgICAgaWYgKHRva2VuLmlkKSB7CiAgICAgICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYWRkUGFyYW0odG9rZW4uaWQsIHRva2VuLCAiZXhjZXB0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUudG9rZW5zLm5leHQudHlwZSAhPT0gIihpZGVudGlmaWVyKSIpIHsKICAgICAgICB3YXJuaW5nKCJFMDMwIiwgc3RhdGUudG9rZW5zLm5leHQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBvbmx5IGFkdmFuY2UgaWYgd2UgaGF2ZSBhbiBpZGVudGlmaWVyIHNvIHdlIGNhbiBjb250aW51ZSBwYXJzaW5nIGluIHRoZSBtb3N0IGNvbW1vbiBlcnJvciAtIHRoYXQgbm8gcGFyYW0gaXMgZ2l2ZW4uCiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRQYXJhbShpZGVudGlmaWVyKCksIHN0YXRlLnRva2Vucy5jdXJyLCAiZXhjZXB0aW9uIik7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gImlmIikgewogICAgICAgIGlmICghc3RhdGUuaW5Nb3ooKSkgewogICAgICAgICAgd2FybmluZygiVzExOCIsIHN0YXRlLnRva2Vucy5jdXJyLCAiY2F0Y2ggZmlsdGVyIik7CiAgICAgICAgfQogICAgICAgIGFkdmFuY2UoImlmIik7CiAgICAgICAgZXhwcmVzc2lvbigwKTsKICAgICAgfQoKICAgICAgYWR2YW5jZSgiKSIpOwoKICAgICAgYmxvY2soZmFsc2UpOwoKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS51bnN0YWNrKCk7CiAgICB9CgogICAgYmxvY2sodHJ1ZSk7CgogICAgd2hpbGUgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiY2F0Y2giKSB7CiAgICAgIGluY3JlYXNlQ29tcGxleGl0eUNvdW50KCk7CiAgICAgIGlmIChiICYmICghc3RhdGUuaW5Nb3ooKSkpIHsKICAgICAgICB3YXJuaW5nKCJXMTE4Iiwgc3RhdGUudG9rZW5zLm5leHQsICJtdWx0aXBsZSBjYXRjaCBibG9ja3MiKTsKICAgICAgfQogICAgICBkb0NhdGNoKCk7CiAgICAgIGIgPSB0cnVlOwogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gImZpbmFsbHkiKSB7CiAgICAgIGFkdmFuY2UoImZpbmFsbHkiKTsKICAgICAgYmxvY2sodHJ1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWIpIHsKICAgICAgZXJyb3IoIkUwMjEiLCBzdGF0ZS50b2tlbnMubmV4dCwgImNhdGNoIiwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0pOwoKICBibG9ja3N0bXQoIndoaWxlIiwgZnVuY3Rpb24oKSB7CiAgICB2YXIgdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgc3RhdGUuZnVuY3RbIihicmVha2FnZSkiXSArPSAxOwogICAgc3RhdGUuZnVuY3RbIihsb29wYWdlKSJdICs9IDE7CiAgICBpbmNyZWFzZUNvbXBsZXhpdHlDb3VudCgpOwogICAgYWR2YW5jZSgiKCIpOwogICAgY2hlY2tDb25kQXNzaWdubWVudChleHByZXNzaW9uKDApKTsKICAgIGFkdmFuY2UoIikiLCB0KTsKICAgIGJsb2NrKHRydWUsIHRydWUpOwogICAgc3RhdGUuZnVuY3RbIihicmVha2FnZSkiXSAtPSAxOwogICAgc3RhdGUuZnVuY3RbIihsb29wYWdlKSJdIC09IDE7CiAgICByZXR1cm4gdGhpczsKICB9KS5sYWJlbGxlZCA9IHRydWU7CgogIGJsb2Nrc3RtdCgid2l0aCIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIGlmIChzdGF0ZS5pc1N0cmljdCgpKSB7CiAgICAgIGVycm9yKCJFMDEwIiwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgfSBlbHNlIGlmICghc3RhdGUub3B0aW9uLndpdGhzdG10KSB7CiAgICAgIHdhcm5pbmcoIlcwODUiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICB9CgogICAgYWR2YW5jZSgiKCIpOwogICAgZXhwcmVzc2lvbigwKTsKICAgIGFkdmFuY2UoIikiLCB0KTsKICAgIGJsb2NrKHRydWUsIHRydWUpOwoKICAgIHJldHVybiB0aGlzOwogIH0pOwoKICBibG9ja3N0bXQoInN3aXRjaCIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIHZhciBnID0gZmFsc2U7CiAgICB2YXIgbm9pbmRlbnQgPSBmYWxzZTsKCiAgICBzdGF0ZS5mdW5jdFsiKGJyZWFrYWdlKSJdICs9IDE7CiAgICBhZHZhbmNlKCIoIik7CiAgICBjaGVja0NvbmRBc3NpZ25tZW50KGV4cHJlc3Npb24oMCkpOwogICAgYWR2YW5jZSgiKSIsIHQpOwogICAgdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgYWR2YW5jZSgieyIpOwoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5mcm9tID09PSBpbmRlbnQpCiAgICAgIG5vaW5kZW50ID0gdHJ1ZTsKCiAgICBpZiAoIW5vaW5kZW50KQogICAgICBpbmRlbnQgKz0gc3RhdGUub3B0aW9uLmluZGVudDsKCiAgICB0aGlzLmNhc2VzID0gW107CgogICAgZm9yICg7OykgewogICAgICBzd2l0Y2ggKHN0YXRlLnRva2Vucy5uZXh0LmlkKSB7CiAgICAgIGNhc2UgImNhc2UiOgogICAgICAgIHN3aXRjaCAoc3RhdGUuZnVuY3RbIih2ZXJiKSJdKSB7CiAgICAgICAgY2FzZSAieWllbGQiOgogICAgICAgIGNhc2UgImJyZWFrIjoKICAgICAgICBjYXNlICJjYXNlIjoKICAgICAgICBjYXNlICJjb250aW51ZSI6CiAgICAgICAgY2FzZSAicmV0dXJuIjoKICAgICAgICBjYXNlICJzd2l0Y2giOgogICAgICAgIGNhc2UgInRocm93IjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAvLyBZb3UgY2FuIHRlbGwgSlNIaW50IHRoYXQgeW91IGRvbid0IHVzZSBicmVhayBpbnRlbnRpb25hbGx5IGJ5CiAgICAgICAgICAvLyBhZGRpbmcgYSBjb21tZW50IC8qIGZhbGxzIHRocm91Z2ggKi8gb24gYSBsaW5lIGp1c3QgYmVmb3JlCiAgICAgICAgICAvLyB0aGUgbmV4dCBgY2FzZWAuCiAgICAgICAgICBpZiAoIXN0YXRlLnRva2Vucy5jdXJyLmNhc2VGYWxsc1Rocm91Z2gpIHsKICAgICAgICAgICAgd2FybmluZygiVzA4NiIsIHN0YXRlLnRva2Vucy5jdXJyLCAiY2FzZSIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYWR2YW5jZSgiY2FzZSIpOwogICAgICAgIHRoaXMuY2FzZXMucHVzaChleHByZXNzaW9uKDApKTsKICAgICAgICBpbmNyZWFzZUNvbXBsZXhpdHlDb3VudCgpOwogICAgICAgIGcgPSB0cnVlOwogICAgICAgIGFkdmFuY2UoIjoiKTsKICAgICAgICBzdGF0ZS5mdW5jdFsiKHZlcmIpIl0gPSAiY2FzZSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImRlZmF1bHQiOgogICAgICAgIHN3aXRjaCAoc3RhdGUuZnVuY3RbIih2ZXJiKSJdKSB7CiAgICAgICAgY2FzZSAieWllbGQiOgogICAgICAgIGNhc2UgImJyZWFrIjoKICAgICAgICBjYXNlICJjb250aW51ZSI6CiAgICAgICAgY2FzZSAicmV0dXJuIjoKICAgICAgICBjYXNlICJ0aHJvdyI6CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgLy8gRG8gbm90IGRpc3BsYXkgYSB3YXJuaW5nIGlmICdkZWZhdWx0JyBpcyB0aGUgZmlyc3Qgc3RhdGVtZW50IG9yIGlmCiAgICAgICAgICAvLyB0aGVyZSBpcyBhIHNwZWNpYWwgLyogZmFsbHMgdGhyb3VnaCAqLyBjb21tZW50LgogICAgICAgICAgaWYgKHRoaXMuY2FzZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICghc3RhdGUudG9rZW5zLmN1cnIuY2FzZUZhbGxzVGhyb3VnaCkgewogICAgICAgICAgICAgIHdhcm5pbmcoIlcwODYiLCBzdGF0ZS50b2tlbnMuY3VyciwgImRlZmF1bHQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYWR2YW5jZSgiZGVmYXVsdCIpOwogICAgICAgIGcgPSB0cnVlOwogICAgICAgIGFkdmFuY2UoIjoiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAifSI6CiAgICAgICAgaWYgKCFub2luZGVudCkKICAgICAgICAgIGluZGVudCAtPSBzdGF0ZS5vcHRpb24uaW5kZW50OwoKICAgICAgICBhZHZhbmNlKCJ9IiwgdCk7CiAgICAgICAgc3RhdGUuZnVuY3RbIihicmVha2FnZSkiXSAtPSAxOwogICAgICAgIHN0YXRlLmZ1bmN0WyIodmVyYikiXSA9IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm47CiAgICAgIGNhc2UgIihlbmQpIjoKICAgICAgICBlcnJvcigiRTAyMyIsIHN0YXRlLnRva2Vucy5uZXh0LCAifSIpOwogICAgICAgIHJldHVybjsKICAgICAgZGVmYXVsdDoKICAgICAgICBpbmRlbnQgKz0gc3RhdGUub3B0aW9uLmluZGVudDsKICAgICAgICBpZiAoZykgewogICAgICAgICAgc3dpdGNoIChzdGF0ZS50b2tlbnMuY3Vyci5pZCkgewogICAgICAgICAgY2FzZSAiLCI6CiAgICAgICAgICAgIGVycm9yKCJFMDQwIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgIjoiOgogICAgICAgICAgICBnID0gZmFsc2U7CiAgICAgICAgICAgIHN0YXRlbWVudHMoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBlcnJvcigiRTAyNSIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoc3RhdGUudG9rZW5zLmN1cnIuaWQgPT09ICI6IikgewogICAgICAgICAgICBhZHZhbmNlKCI6Iik7CiAgICAgICAgICAgIGVycm9yKCJFMDI0Iiwgc3RhdGUudG9rZW5zLmN1cnIsICI6Iik7CiAgICAgICAgICAgIHN0YXRlbWVudHMoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVycm9yKCJFMDIxIiwgc3RhdGUudG9rZW5zLm5leHQsICJjYXNlIiwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGluZGVudCAtPSBzdGF0ZS5vcHRpb24uaW5kZW50OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KS5sYWJlbGxlZCA9IHRydWU7CgogIHN0bXQoImRlYnVnZ2VyIiwgZnVuY3Rpb24oKSB7CiAgICBpZiAoIXN0YXRlLm9wdGlvbi5kZWJ1ZykgewogICAgICB3YXJuaW5nKCJXMDg3IiwgdGhpcyk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KS5leHBzID0gdHJ1ZTsKCiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIHggPSBzdG10KCJkbyIsIGZ1bmN0aW9uKCkgewogICAgICBzdGF0ZS5mdW5jdFsiKGJyZWFrYWdlKSJdICs9IDE7CiAgICAgIHN0YXRlLmZ1bmN0WyIobG9vcGFnZSkiXSArPSAxOwogICAgICBpbmNyZWFzZUNvbXBsZXhpdHlDb3VudCgpOwoKICAgICAgdGhpcy5maXJzdCA9IGJsb2NrKHRydWUsIHRydWUpOwogICAgICBhZHZhbmNlKCJ3aGlsZSIpOwogICAgICB2YXIgdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgICBhZHZhbmNlKCIoIik7CiAgICAgIGNoZWNrQ29uZEFzc2lnbm1lbnQoZXhwcmVzc2lvbigwKSk7CiAgICAgIGFkdmFuY2UoIikiLCB0KTsKICAgICAgc3RhdGUuZnVuY3RbIihicmVha2FnZSkiXSAtPSAxOwogICAgICBzdGF0ZS5mdW5jdFsiKGxvb3BhZ2UpIl0gLT0gMTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KTsKICAgIHgubGFiZWxsZWQgPSB0cnVlOwogICAgeC5leHBzID0gdHJ1ZTsKICB9KCkpOwoKICBibG9ja3N0bXQoImZvciIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHMsIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgIHZhciBsZXRzY29wZSA9IGZhbHNlOwogICAgdmFyIGZvcmVhY2h0b2sgPSBudWxsOwoKICAgIGlmICh0LnZhbHVlID09PSAiZWFjaCIpIHsKICAgICAgZm9yZWFjaHRvayA9IHQ7CiAgICAgIGFkdmFuY2UoImVhY2giKTsKICAgICAgaWYgKCFzdGF0ZS5pbk1veigpKSB7CiAgICAgICAgd2FybmluZygiVzExOCIsIHN0YXRlLnRva2Vucy5jdXJyLCAiZm9yIGVhY2giKTsKICAgICAgfQogICAgfQoKICAgIGluY3JlYXNlQ29tcGxleGl0eUNvdW50KCk7CiAgICBhZHZhbmNlKCIoIik7CgogICAgLy8gd2hhdCBraW5kIG9mIGZvcijigKYpIHN0YXRlbWVudCBpdCBpcz8gZm9yKOKApm9m4oCmKT8gZm9yKOKApmlu4oCmKT8gZm9yKOKApjvigKY74oCmKT8KICAgIHZhciBuZXh0b3A7IC8vIGNvbnRhaW5zIHRoZSB0b2tlbiBvZiB0aGUgImluIiBvciAib2YiIG9wZXJhdG9yCiAgICB2YXIgaSA9IDA7CiAgICB2YXIgaW5vZiA9IFsiaW4iLCAib2YiXTsKICAgIHZhciBsZXZlbCA9IDA7IC8vIEJpbmRpbmdQYXR0ZXJuICJsZXZlbCIgLS0tIGxldmVsIDAgPT09IG5vIEJpbmRpbmdQYXR0ZXJuCiAgICB2YXIgY29tbWE7IC8vIEZpcnN0IGNvbW1hIHB1bmN0dWF0b3IgYXQgbGV2ZWwgMAogICAgdmFyIGluaXRpYWxpemVyOyAvLyBGaXJzdCBpbml0aWFsaXplciBhdCBsZXZlbCAwCiAgICB2YXIgYmluZGluZ1Bvd2VyOwoKICAgIC8vIElmIGluaXRpYWwgdG9rZW4gaXMgYSBCaW5kaW5nUGF0dGVybiwgY291bnQgaXQgYXMgc3VjaC4KICAgIGlmIChjaGVja1B1bmN0dWF0b3JzKHN0YXRlLnRva2Vucy5uZXh0LCBbInsiLCAiWyJdKSkgKytsZXZlbDsKICAgIGRvIHsKICAgICAgbmV4dG9wID0gcGVlayhpKTsKICAgICAgKytpOwogICAgICBpZiAoY2hlY2tQdW5jdHVhdG9ycyhuZXh0b3AsIFsieyIsICJbIl0pKSArK2xldmVsOwogICAgICBlbHNlIGlmIChjaGVja1B1bmN0dWF0b3JzKG5leHRvcCwgWyJ9IiwgIl0iXSkpIC0tbGV2ZWw7CiAgICAgIGlmIChsZXZlbCA8IDApIGJyZWFrOwogICAgICBpZiAobGV2ZWwgPT09IDApIHsKICAgICAgICBpZiAoIWNvbW1hICYmIGNoZWNrUHVuY3R1YXRvcihuZXh0b3AsICIsIikpIGNvbW1hID0gbmV4dG9wOwogICAgICAgIGVsc2UgaWYgKCFpbml0aWFsaXplciAmJiBjaGVja1B1bmN0dWF0b3IobmV4dG9wLCAiPSIpKSBpbml0aWFsaXplciA9IG5leHRvcDsKICAgICAgfQogICAgfSB3aGlsZSAobGV2ZWwgPiAwIHx8ICFfLmNvbnRhaW5zKGlub2YsIG5leHRvcC52YWx1ZSkgJiYgbmV4dG9wLnZhbHVlICE9PSAiOyIgJiYKICAgIG5leHRvcC50eXBlICE9PSAiKGVuZCkiKTsgLy8gSXMgdGhpcyBhIEpTQ1MgYnVnPyBUaGlzIGxvb2tzIHJlYWxseSB3ZWlyZC4KCiAgICAvLyBpZiB3ZSdyZSBpbiBhIGZvciAo4oCmIGlufG9mIOKApikgc3RhdGVtZW50CiAgICBpZiAoXy5jb250YWlucyhpbm9mLCBuZXh0b3AudmFsdWUpKSB7CiAgICAgIGlmIChuZXh0b3AudmFsdWUgPT09ICJvZiIpIHsKICAgICAgICBiaW5kaW5nUG93ZXIgPSAyMDsKICAgICAgICBpZiAoIXN0YXRlLmluRVM2KCkpIHsKICAgICAgICAgIHdhcm5pbmcoIlcxMDQiLCBuZXh0b3AsICJmb3Igb2YiLCAiNiIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBiaW5kaW5nUG93ZXIgPSAwOwogICAgICB9CgogICAgICB2YXIgb2sgPSAhKGluaXRpYWxpemVyIHx8IGNvbW1hKTsKICAgICAgaWYgKGluaXRpYWxpemVyKSB7CiAgICAgICAgZXJyb3IoIlcxMzMiLCBjb21tYSwgbmV4dG9wLnZhbHVlLCAiaW5pdGlhbGl6ZXIgaXMgZm9yYmlkZGVuIik7CiAgICAgIH0KCiAgICAgIGlmIChjb21tYSkgewogICAgICAgIGVycm9yKCJXMTMzIiwgY29tbWEsIG5leHRvcC52YWx1ZSwgIm1vcmUgdGhhbiBvbmUgRm9yQmluZGluZyIpOwogICAgICB9CgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJ2YXIiKSB7CiAgICAgICAgYWR2YW5jZSgidmFyIik7CiAgICAgICAgc3RhdGUudG9rZW5zLmN1cnIuZnVkKHsgcHJlZml4OiB0cnVlIH0pOwogICAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAibGV0IiB8fCBzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gImNvbnN0IikgewogICAgICAgIGFkdmFuY2Uoc3RhdGUudG9rZW5zLm5leHQuaWQpOwogICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBibG9jayBzY29wZQogICAgICAgIGxldHNjb3BlID0gdHJ1ZTsKICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnN0YWNrKCk7CiAgICAgICAgc3RhdGUudG9rZW5zLmN1cnIuZnVkKHsgcHJlZml4OiB0cnVlIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFBhcnNlIGFzIGEgdmFyIHN0YXRlbWVudCwgd2l0aCBpbXBsaWVkIGJpbmRpbmdzLiBJZ25vcmUgZXJyb3JzIGlmIGFuIGVycm9yCiAgICAgICAgLy8gd2FzIGFscmVhZHkgcmVwb3J0ZWQKICAgICAgICBPYmplY3QuY3JlYXRlKHZhcnN0YXRlbWVudCkuZnVkKHsgcHJlZml4OiB0cnVlLCBpbXBsaWVkOiAiZm9yIiwgaWdub3JlOiAhb2sgfSk7CiAgICAgIH0KICAgICAgYWR2YW5jZShuZXh0b3AudmFsdWUpOwogICAgICAvLyBUaGUgYmluZGluZyBwb3dlciBpcyB2YXJpYWJsZSBiZWNhdXNlIGZvci1pbiBzdGF0ZW1lbnRzIGFjY2VwdCBhbnkKICAgICAgLy8gRXhwcmVzc2lvbiBpbiB0aGlzIHBvc2l0aW9uLCB3aGlsZSBmb3Itb2Ygc3RhdGVtZW50cyBhcmUgbGltaXRlZCB0bwogICAgICAvLyBBc3NpZ25tZW50RXhwcmVzc2lvbnMuIEZvciBleGFtcGxlOgogICAgICAvLwogICAgICAvLyAgICAgZm9yICggTGVmdEhhbmRTaWRlRXhwcmVzc2lvbiBpbiBFeHByZXNzaW9uICkgU3RhdGVtZW50CiAgICAgIC8vICAgICBmb3IgKCBMZWZ0SGFuZFNpZGVFeHByZXNzaW9uIG9mIEFzc2lnbm1lbnRFeHByZXNzaW9uICkgU3RhdGVtZW50CiAgICAgIGV4cHJlc3Npb24oYmluZGluZ1Bvd2VyKTsKICAgICAgYWR2YW5jZSgiKSIsIHQpOwoKICAgICAgaWYgKG5leHRvcC52YWx1ZSA9PT0gImluIiAmJiBzdGF0ZS5vcHRpb24uZm9yaW4pIHsKICAgICAgICBzdGF0ZS5mb3JpbmlmY2hlY2tuZWVkZWQgPSB0cnVlOwoKICAgICAgICBpZiAoc3RhdGUuZm9yaW5pZmNoZWNrcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzdGF0ZS5mb3JpbmlmY2hlY2tzID0gW107CiAgICAgICAgfQoKICAgICAgICAvLyBQdXNoIGEgbmV3IGZvci1pbi1pZiBjaGVjayBvbnRvIHRoZSBzdGFjay4gVGhlIHR5cGUgd2lsbCBiZSBtb2RpZmllZAogICAgICAgIC8vIHdoZW4gdGhlIGxvb3AncyBib2R5IGlzIHBhcnNlZCBhbmQgYSBzdWl0YWJsZSBpZiBzdGF0ZW1lbnQgZXhpc3RzLgogICAgICAgIHN0YXRlLmZvcmluaWZjaGVja3MucHVzaCh7CiAgICAgICAgICB0eXBlOiAiKG5vbmUpIgogICAgICAgIH0pOwogICAgICB9CgogICAgICBzdGF0ZS5mdW5jdFsiKGJyZWFrYWdlKSJdICs9IDE7CiAgICAgIHN0YXRlLmZ1bmN0WyIobG9vcGFnZSkiXSArPSAxOwoKICAgICAgcyA9IGJsb2NrKHRydWUsIHRydWUpOwoKICAgICAgaWYgKG5leHRvcC52YWx1ZSA9PT0gImluIiAmJiBzdGF0ZS5vcHRpb24uZm9yaW4pIHsKICAgICAgICBpZiAoc3RhdGUuZm9yaW5pZmNoZWNrcyAmJiBzdGF0ZS5mb3JpbmlmY2hlY2tzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBjaGVjayA9IHN0YXRlLmZvcmluaWZjaGVja3MucG9wKCk7CgogICAgICAgICAgaWYgKC8vIE5vIGlmIHN0YXRlbWVudCBvciBub3QgdGhlIGZpcnN0IHN0YXRlbWVudCBpbiBsb29wIGJvZHkKICAgICAgICAgICAgICBzICYmIHMubGVuZ3RoID4gMCAmJiAodHlwZW9mIHNbMF0gIT09ICJvYmplY3QiIHx8IHNbMF0udmFsdWUgIT09ICJpZiIpIHx8CiAgICAgICAgICAgICAgLy8gUG9zaXRpdmUgaWYgc3RhdGVtZW50IGlzIG5vdCB0aGUgb25seSBvbmUgaW4gbG9vcCBib2R5CiAgICAgICAgICAgICAgY2hlY2sudHlwZSA9PT0gIihwb3NpdGl2ZSkiICYmIHMubGVuZ3RoID4gMSB8fAogICAgICAgICAgICAgIC8vIE5lZ2F0aXZlIGlmIHN0YXRlbWVudCBidXQgbm8gY29udGludWUKICAgICAgICAgICAgICBjaGVjay50eXBlID09PSAiKG5lZ2F0aXZlKSIpIHsKICAgICAgICAgICAgd2FybmluZygiVzA4OSIsIHRoaXMpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVzZXQgdGhlIGZsYWcgaW4gY2FzZSBubyBpZiBzdGF0ZW1lbnQgd2FzIGNvbnRhaW5lZCBpbiB0aGUgbG9vcCBib2R5CiAgICAgICAgc3RhdGUuZm9yaW5pZmNoZWNrbmVlZGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHN0YXRlLmZ1bmN0WyIoYnJlYWthZ2UpIl0gLT0gMTsKICAgICAgc3RhdGUuZnVuY3RbIihsb29wYWdlKSJdIC09IDE7CiAgICB9IGVsc2UgewogICAgICBpZiAoZm9yZWFjaHRvaykgewogICAgICAgIGVycm9yKCJFMDQ1IiwgZm9yZWFjaHRvayk7CiAgICAgIH0KICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiOyIpIHsKICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJ2YXIiKSB7CiAgICAgICAgICBhZHZhbmNlKCJ2YXIiKTsKICAgICAgICAgIHN0YXRlLnRva2Vucy5jdXJyLmZ1ZCgpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgPT09ICJsZXQiKSB7CiAgICAgICAgICBhZHZhbmNlKCJsZXQiKTsKICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBibG9jayBzY29wZQogICAgICAgICAgbGV0c2NvcGUgPSB0cnVlOwogICAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5zdGFjaygpOwogICAgICAgICAgc3RhdGUudG9rZW5zLmN1cnIuZnVkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgZXhwcmVzc2lvbigwLCAiZm9yIik7CiAgICAgICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIiwiKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFyc2VDb21tYSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBub2xpbmVicmVhayhzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIGFkdmFuY2UoIjsiKTsKCiAgICAgIC8vIHN0YXJ0IGxvb3BhZ2UgYWZ0ZXIgdGhlIGZpcnN0IDsgYXMgdGhlIG5leHQgdHdvIGV4cHJlc3Npb25zIGFyZSBleGVjdXRlZAogICAgICAvLyBvbiBldmVyeSBsb29wCiAgICAgIHN0YXRlLmZ1bmN0WyIobG9vcGFnZSkiXSArPSAxOwogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI7IikgewogICAgICAgIGNoZWNrQ29uZEFzc2lnbm1lbnQoZXhwcmVzc2lvbigwKSk7CiAgICAgIH0KICAgICAgbm9saW5lYnJlYWsoc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICBhZHZhbmNlKCI7Iik7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIjsiKSB7CiAgICAgICAgZXJyb3IoIkUwMjEiLCBzdGF0ZS50b2tlbnMubmV4dCwgIikiLCAiOyIpOwogICAgICB9CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIikiKSB7CiAgICAgICAgZm9yICg7OykgewogICAgICAgICAgZXhwcmVzc2lvbigwLCAiZm9yIik7CiAgICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIsIikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ29tbWEoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYWR2YW5jZSgiKSIsIHQpOwogICAgICBzdGF0ZS5mdW5jdFsiKGJyZWFrYWdlKSJdICs9IDE7CiAgICAgIGJsb2NrKHRydWUsIHRydWUpOwogICAgICBzdGF0ZS5mdW5jdFsiKGJyZWFrYWdlKSJdIC09IDE7CiAgICAgIHN0YXRlLmZ1bmN0WyIobG9vcGFnZSkiXSAtPSAxOwoKICAgIH0KICAgIC8vIHVuc3RhY2sgbG9vcCBibG9ja3Njb3BlCiAgICBpZiAobGV0c2NvcGUpIHsKICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS51bnN0YWNrKCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9KS5sYWJlbGxlZCA9IHRydWU7CgoKICBzdG10KCJicmVhayIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHYgPSBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZTsKCiAgICBpZiAoIXN0YXRlLm9wdGlvbi5hc2kpCiAgICAgIG5vbGluZWJyZWFrKHRoaXMpOwoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIjsiICYmICFzdGF0ZS50b2tlbnMubmV4dC5yZWFjaCAmJgogICAgICAgIHN0YXRlLnRva2Vucy5jdXJyLmxpbmUgPT09IHN0YXJ0TGluZShzdGF0ZS50b2tlbnMubmV4dCkpIHsKICAgICAgaWYgKCFzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmZ1bmN0Lmhhc0JyZWFrTGFiZWwodikpIHsKICAgICAgICB3YXJuaW5nKCJXMDkwIiwgc3RhdGUudG9rZW5zLm5leHQsIHYpOwogICAgICB9CiAgICAgIHRoaXMuZmlyc3QgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgICAgYWR2YW5jZSgpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHN0YXRlLmZ1bmN0WyIoYnJlYWthZ2UpIl0gPT09IDApCiAgICAgICAgd2FybmluZygiVzA1MiIsIHN0YXRlLnRva2Vucy5uZXh0LCB0aGlzLnZhbHVlKTsKICAgIH0KCiAgICByZWFjaGFibGUodGhpcyk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSkuZXhwcyA9IHRydWU7CgoKICBzdG10KCJjb250aW51ZSIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHYgPSBzdGF0ZS50b2tlbnMubmV4dC52YWx1ZTsKCiAgICBpZiAoc3RhdGUuZnVuY3RbIihicmVha2FnZSkiXSA9PT0gMCB8fCAhc3RhdGUuZnVuY3RbIihsb29wYWdlKSJdKSB7CiAgICAgIHdhcm5pbmcoIlcwNTIiLCBzdGF0ZS50b2tlbnMubmV4dCwgdGhpcy52YWx1ZSk7CiAgICB9CgogICAgaWYgKCFzdGF0ZS5vcHRpb24uYXNpKQogICAgICBub2xpbmVicmVhayh0aGlzKTsKCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI7IiAmJiAhc3RhdGUudG9rZW5zLm5leHQucmVhY2gpIHsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5jdXJyLmxpbmUgPT09IHN0YXJ0TGluZShzdGF0ZS50b2tlbnMubmV4dCkpIHsKICAgICAgICBpZiAoIXN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uZnVuY3QuaGFzQnJlYWtMYWJlbCh2KSkgewogICAgICAgICAgd2FybmluZygiVzA5MCIsIHN0YXRlLnRva2Vucy5uZXh0LCB2KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5maXJzdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgICAgIGFkdmFuY2UoKTsKICAgICAgfQogICAgfQoKICAgIHJlYWNoYWJsZSh0aGlzKTsKCiAgICByZXR1cm4gdGhpczsKICB9KS5leHBzID0gdHJ1ZTsKCgogIHN0bXQoInJldHVybiIsIGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMubGluZSA9PT0gc3RhcnRMaW5lKHN0YXRlLnRva2Vucy5uZXh0KSkgewogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI7IiAmJiAhc3RhdGUudG9rZW5zLm5leHQucmVhY2gpIHsKICAgICAgICB0aGlzLmZpcnN0ID0gZXhwcmVzc2lvbigwKTsKCiAgICAgICAgaWYgKHRoaXMuZmlyc3QgJiYKICAgICAgICAgICAgdGhpcy5maXJzdC50eXBlID09PSAiKHB1bmN0dWF0b3IpIiAmJiB0aGlzLmZpcnN0LnZhbHVlID09PSAiPSIgJiYKICAgICAgICAgICAgIXRoaXMuZmlyc3QucGFyZW4gJiYgIXN0YXRlLm9wdGlvbi5ib3NzKSB7CiAgICAgICAgICB3YXJuaW5nQXQoIlcwOTMiLCB0aGlzLmZpcnN0LmxpbmUsIHRoaXMuZmlyc3QuY2hhcmFjdGVyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC50eXBlID09PSAiKHB1bmN0dWF0b3IpIiAmJgogICAgICAgIFsiWyIsICJ7IiwgIisiLCAiLSJdLmluZGV4T2Yoc3RhdGUudG9rZW5zLm5leHQudmFsdWUpID4gLTEpIHsKICAgICAgICBub2xpbmVicmVhayh0aGlzKTsgLy8gYWx3YXlzIHdhcm4gKExpbmUgYnJlYWtpbmcgZXJyb3IpCiAgICAgIH0KICAgIH0KCiAgICByZWFjaGFibGUodGhpcyk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSkuZXhwcyA9IHRydWU7CgogIChmdW5jdGlvbih4KSB7CiAgICB4LmV4cHMgPSB0cnVlOwogICAgeC5sYnAgPSAyNTsKICAgIHgubHRCb3VuZGFyeSA9ICJhZnRlciI7CiAgfShwcmVmaXgoInlpZWxkIiwgZnVuY3Rpb24oKSB7CiAgICBpZiAoc3RhdGUuaW5Nb3ooKSkgewogICAgICByZXR1cm4gbW96WWllbGQuY2FsbCh0aGlzKTsKICAgIH0KICAgIHZhciBwcmV2ID0gc3RhdGUudG9rZW5zLnByZXY7CgogICAgaWYgKCF0aGlzLmJlZ2luc1N0bXQgJiYgcHJldi5sYnAgPiAzMCAmJiAhY2hlY2tQdW5jdHVhdG9ycyhwcmV2LCBbIigiXSkpIHsKICAgICAgZXJyb3IoIkUwNjEiLCB0aGlzKTsKICAgIH0KCiAgICBpZiAoc3RhdGUuaW5FUzYodHJ1ZSkgJiYgIXN0YXRlLmZ1bmN0WyIoZ2VuZXJhdG9yKSJdKSB7CiAgICAgIC8vIElmIGl0J3MgYSB5aWVsZCB3aXRoaW4gYSBjYXRjaCBjbGF1c2UgaW5zaWRlIGEgZ2VuZXJhdG9yIHRoZW4gdGhhdCdzIG9rCiAgICAgIGlmICghKCIoY2F0Y2gpIiA9PT0gc3RhdGUuZnVuY3RbIihuYW1lKSJdICYmIHN0YXRlLmZ1bmN0WyIoY29udGV4dCkiXVsiKGdlbmVyYXRvcikiXSkpIHsKICAgICAgICBlcnJvcigiRTA0NiIsIHN0YXRlLnRva2Vucy5jdXJyLCAieWllbGQiKTsKICAgICAgfQogICAgfSBlbHNlIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJ5aWVsZCIsICI2Iik7CiAgICB9CiAgICBzdGF0ZS5mdW5jdFsiKGdlbmVyYXRvcikiXSA9ICJ5aWVsZGVkIjsKICAgIHZhciBkZWxlZ2F0aW5nWWllbGQgPSBmYWxzZTsKCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICIqIikgewogICAgICBkZWxlZ2F0aW5nWWllbGQgPSB0cnVlOwogICAgICBhZHZhbmNlKCIqIik7CiAgICB9CgogICAgLy8gUGFyc2Ugb3BlcmFuZAogICAgaWYgKCFpc0VuZE9mRXhwcigpICYmIHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiLCIpIHsKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0Lm51ZCkgewoKICAgICAgICBub2JyZWFrbm9uYWRqYWNlbnQoc3RhdGUudG9rZW5zLmN1cnIsIHN0YXRlLnRva2Vucy5uZXh0KTsKICAgICAgICB0aGlzLmZpcnN0ID0gZXhwcmVzc2lvbigxMCk7CgogICAgICAgIGlmICh0aGlzLmZpcnN0LnR5cGUgPT09ICIocHVuY3R1YXRvcikiICYmIHRoaXMuZmlyc3QudmFsdWUgPT09ICI9IiAmJgogICAgICAgICAgICAhdGhpcy5maXJzdC5wYXJlbiAmJiAhc3RhdGUub3B0aW9uLmJvc3MpIHsKICAgICAgICAgIHdhcm5pbmdBdCgiVzA5MyIsIHRoaXMuZmlyc3QubGluZSwgdGhpcy5maXJzdC5jaGFyYWN0ZXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5sZWQpIHsKICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIsIikgewogICAgICAgICAgZXJyb3IoIlcwMTciLCBzdGF0ZS50b2tlbnMubmV4dCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSkpKTsKCiAgLyoqCiAgICogUGFyc2luZyBsb2dpYyBmb3Igbm9uLXN0YW5kYXJkIE1vemlsbGEgaW1wbGVtZW50YXRpb24gb2YgYHlpZWxkYAogICAqIGV4cHJlc3Npb25zLgogICAqLwogIHZhciBtb3pZaWVsZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHByZXYgPSBzdGF0ZS50b2tlbnMucHJldjsKICAgIGlmIChzdGF0ZS5pbkVTNih0cnVlKSAmJiAhc3RhdGUuZnVuY3RbIihnZW5lcmF0b3IpIl0pIHsKICAgICAgLy8gSWYgaXQncyBhIHlpZWxkIHdpdGhpbiBhIGNhdGNoIGNsYXVzZSBpbnNpZGUgYSBnZW5lcmF0b3IgdGhlbiB0aGF0J3Mgb2sKICAgICAgaWYgKCEoIihjYXRjaCkiID09PSBzdGF0ZS5mdW5jdFsiKG5hbWUpIl0gJiYgc3RhdGUuZnVuY3RbIihjb250ZXh0KSJdWyIoZ2VuZXJhdG9yKSJdKSkgewogICAgICAgIGVycm9yKCJFMDQ2Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJ5aWVsZCIpOwogICAgICB9CiAgICB9CiAgICBzdGF0ZS5mdW5jdFsiKGdlbmVyYXRvcikiXSA9ICJ5aWVsZGVkIjsKICAgIHZhciBkZWxlZ2F0aW5nWWllbGQgPSBmYWxzZTsKCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICIqIikgewogICAgICBkZWxlZ2F0aW5nWWllbGQgPSB0cnVlOwogICAgICBhZHZhbmNlKCIqIik7CiAgICB9CgogICAgaWYgKHRoaXMubGluZSA9PT0gc3RhcnRMaW5lKHN0YXRlLnRva2Vucy5uZXh0KSkgewogICAgICBpZiAoZGVsZWdhdGluZ1lpZWxkIHx8CiAgICAgICAgICAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICI7IiAmJiAhc3RhdGUub3B0aW9uLmFzaSAmJgogICAgICAgICAgICFzdGF0ZS50b2tlbnMubmV4dC5yZWFjaCAmJiBzdGF0ZS50b2tlbnMubmV4dC5udWQpKSB7CgogICAgICAgIG5vYnJlYWtub25hZGphY2VudChzdGF0ZS50b2tlbnMuY3Vyciwgc3RhdGUudG9rZW5zLm5leHQpOwogICAgICAgIHRoaXMuZmlyc3QgPSBleHByZXNzaW9uKDEwKTsKCiAgICAgICAgaWYgKHRoaXMuZmlyc3QudHlwZSA9PT0gIihwdW5jdHVhdG9yKSIgJiYgdGhpcy5maXJzdC52YWx1ZSA9PT0gIj0iICYmCiAgICAgICAgICAgICF0aGlzLmZpcnN0LnBhcmVuICYmICFzdGF0ZS5vcHRpb24uYm9zcykgewogICAgICAgICAgd2FybmluZ0F0KCJXMDkzIiwgdGhpcy5maXJzdC5saW5lLCB0aGlzLmZpcnN0LmNoYXJhY3Rlcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIpIiAmJgogICAgICAgICAgKHByZXYubGJwID4gMzAgfHwgKCFwcmV2LmFzc2lnbiAmJiAhaXNFbmRPZkV4cHIoKSkgfHwgcHJldi5pZCA9PT0gInlpZWxkIikpIHsKICAgICAgICBlcnJvcigiRTA1MCIsIHRoaXMpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCFzdGF0ZS5vcHRpb24uYXNpKSB7CiAgICAgIG5vbGluZWJyZWFrKHRoaXMpOyAvLyBhbHdheXMgd2FybiAoTGluZSBicmVha2luZyBlcnJvcikKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH07CgogIHN0bXQoInRocm93IiwgZnVuY3Rpb24oKSB7CiAgICBub2xpbmVicmVhayh0aGlzKTsKICAgIHRoaXMuZmlyc3QgPSBleHByZXNzaW9uKDIwKTsKCiAgICByZWFjaGFibGUodGhpcyk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSkuZXhwcyA9IHRydWU7CgogIHN0bXQoImltcG9ydCIsIGZ1bmN0aW9uKCkgewogICAgaWYgKCFzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmJsb2NrLmlzR2xvYmFsKCkpIHsKICAgICAgZXJyb3IoIkUwNTMiLCBzdGF0ZS50b2tlbnMuY3VyciwgIkltcG9ydCIpOwogICAgfQoKICAgIGlmICghc3RhdGUuaW5FUzYoKSkgewogICAgICB3YXJuaW5nKCJXMTE5Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJpbXBvcnQiLCAiNiIpOwogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC50eXBlID09PSAiKHN0cmluZykiKSB7CiAgICAgIC8vIE1vZHVsZVNwZWNpZmllciA6OiBTdHJpbmdMaXRlcmFsCiAgICAgIGFkdmFuY2UoIihzdHJpbmcpIik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZGVudGlmaWVyKSB7CiAgICAgIC8vIEltcG9ydENsYXVzZSA6OiBJbXBvcnRlZERlZmF1bHRCaW5kaW5nCiAgICAgIHRoaXMubmFtZSA9IGlkZW50aWZpZXIoKTsKICAgICAgLy8gSW1wb3J0IGJpbmRpbmdzIGFyZSBpbW11dGFibGUgKHNlZSBFUzYgOC4xLjEuNS41KQogICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmFkZGxhYmVsKHRoaXMubmFtZSwgewogICAgICAgIHR5cGU6ICJjb25zdCIsCiAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgdG9rZW46IHN0YXRlLnRva2Vucy5jdXJyIH0pOwoKICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiLCIpIHsKICAgICAgICAvLyBJbXBvcnRDbGF1c2UgOjogSW1wb3J0ZWREZWZhdWx0QmluZGluZyAsIE5hbWVTcGFjZUltcG9ydAogICAgICAgIC8vIEltcG9ydENsYXVzZSA6OiBJbXBvcnRlZERlZmF1bHRCaW5kaW5nICwgTmFtZWRJbXBvcnRzCiAgICAgICAgYWR2YW5jZSgiLCIpOwogICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIHdlIGludGVudGlvbmFsbHkgZmFsbCB0aHJvdWdoIHRvIGNvbnRpbnVlIG1hdGNoaW5nCiAgICAgICAgLy8gZWl0aGVyIE5hbWVTcGFjZUltcG9ydCBvciBOYW1lZEltcG9ydHMuCiAgICAgICAgLy8gRGlzY3Vzc2lvbjoKICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vanNoaW50L2pzaGludC9wdWxsLzIxNDQjZGlzY3Vzc2lvbl9yMjM5Nzg0MDYKICAgICAgfSBlbHNlIHsKICAgICAgICBhZHZhbmNlKCJmcm9tIik7CiAgICAgICAgYWR2YW5jZSgiKHN0cmluZykiKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIioiKSB7CiAgICAgIC8vIEltcG9ydENsYXVzZSA6OiBOYW1lU3BhY2VJbXBvcnQKICAgICAgYWR2YW5jZSgiKiIpOwogICAgICBhZHZhbmNlKCJhcyIpOwogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWRlbnRpZmllcikgewogICAgICAgIHRoaXMubmFtZSA9IGlkZW50aWZpZXIoKTsKICAgICAgICAvLyBJbXBvcnQgYmluZGluZ3MgYXJlIGltbXV0YWJsZSAoc2VlIEVTNiA4LjEuMS41LjUpCiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRsYWJlbCh0aGlzLm5hbWUsIHsKICAgICAgICAgIHR5cGU6ICJjb25zdCIsCiAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgIHRva2VuOiBzdGF0ZS50b2tlbnMuY3VyciB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gSW1wb3J0Q2xhdXNlIDo6IE5hbWVkSW1wb3J0cwogICAgICBhZHZhbmNlKCJ7Iik7CiAgICAgIGZvciAoOzspIHsKICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICJ9IikgewogICAgICAgICAgYWR2YW5jZSgifSIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHZhciBpbXBvcnROYW1lOwogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC50eXBlID09PSAiZGVmYXVsdCIpIHsKICAgICAgICAgIGltcG9ydE5hbWUgPSAiZGVmYXVsdCI7CiAgICAgICAgICBhZHZhbmNlKCJkZWZhdWx0Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGltcG9ydE5hbWUgPSBpZGVudGlmaWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gImFzIikgewogICAgICAgICAgYWR2YW5jZSgiYXMiKTsKICAgICAgICAgIGltcG9ydE5hbWUgPSBpZGVudGlmaWVyKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBJbXBvcnQgYmluZGluZ3MgYXJlIGltbXV0YWJsZSAoc2VlIEVTNiA4LjEuMS41LjUpCiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRsYWJlbChpbXBvcnROYW1lLCB7CiAgICAgICAgICB0eXBlOiAiY29uc3QiLAogICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgICB0b2tlbjogc3RhdGUudG9rZW5zLmN1cnIgfSk7CgogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIiwiKSB7CiAgICAgICAgICBhZHZhbmNlKCIsIik7CiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIn0iKSB7CiAgICAgICAgICBhZHZhbmNlKCJ9Iik7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXJyb3IoIkUwMjQiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gRnJvbUNsYXVzZQogICAgYWR2YW5jZSgiZnJvbSIpOwogICAgYWR2YW5jZSgiKHN0cmluZykiKTsKICAgIHJldHVybiB0aGlzOwogIH0pLmV4cHMgPSB0cnVlOwoKICBzdG10KCJleHBvcnQiLCBmdW5jdGlvbigpIHsKICAgIHZhciBvayA9IHRydWU7CiAgICB2YXIgdG9rZW47CiAgICB2YXIgaWRlbnRpZmllcjsKCiAgICBpZiAoIXN0YXRlLmluRVM2KCkpIHsKICAgICAgd2FybmluZygiVzExOSIsIHN0YXRlLnRva2Vucy5jdXJyLCAiZXhwb3J0IiwgIjYiKTsKICAgICAgb2sgPSBmYWxzZTsKICAgIH0KCiAgICBpZiAoIXN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uYmxvY2suaXNHbG9iYWwoKSkgewogICAgICBlcnJvcigiRTA1MyIsIHN0YXRlLnRva2Vucy5jdXJyLCAiRXhwb3J0Iik7CiAgICAgIG9rID0gZmFsc2U7CiAgICB9CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiKiIpIHsKICAgICAgLy8gRXhwb3J0RGVjbGFyYXRpb24gOjogZXhwb3J0ICogRnJvbUNsYXVzZQogICAgICBhZHZhbmNlKCIqIik7CiAgICAgIGFkdmFuY2UoImZyb20iKTsKICAgICAgYWR2YW5jZSgiKHN0cmluZykiKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnR5cGUgPT09ICJkZWZhdWx0IikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OgogICAgICAvLyAgICAgIGV4cG9ydCBkZWZhdWx0IFtsb29rYWhlYWQg4oiJIHsgZnVuY3Rpb24sIGNsYXNzIH1dIEFzc2lnbm1lbnRFeHByZXNzaW9uW0luXSA7CiAgICAgIC8vICAgICAgZXhwb3J0IGRlZmF1bHQgSG9pc3RhYmxlRGVjbGFyYXRpb24KICAgICAgLy8gICAgICBleHBvcnQgZGVmYXVsdCBDbGFzc0RlY2xhcmF0aW9uCiAgICAgIHN0YXRlLm5hbWVTdGFjay5zZXQoc3RhdGUudG9rZW5zLm5leHQpOwogICAgICBhZHZhbmNlKCJkZWZhdWx0Iik7CiAgICAgIHZhciBleHBvcnRUeXBlID0gc3RhdGUudG9rZW5zLm5leHQuaWQ7CiAgICAgIGlmIChleHBvcnRUeXBlID09PSAiZnVuY3Rpb24iIHx8IGV4cG9ydFR5cGUgPT09ICJjbGFzcyIpIHsKICAgICAgICB0aGlzLmJsb2NrID0gdHJ1ZTsKICAgICAgfQoKICAgICAgdG9rZW4gPSBwZWVrKCk7CgogICAgICBleHByZXNzaW9uKDEwKTsKCiAgICAgIGlkZW50aWZpZXIgPSB0b2tlbi52YWx1ZTsKCiAgICAgIGlmICh0aGlzLmJsb2NrKSB7CiAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5hZGRsYWJlbChpZGVudGlmaWVyLCB7CiAgICAgICAgICB0eXBlOiBleHBvcnRUeXBlLAogICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgICB0b2tlbjogdG9rZW4gfSk7CgogICAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc2V0RXhwb3J0ZWQoaWRlbnRpZmllciwgdG9rZW4pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICJ7IikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OiBleHBvcnQgRXhwb3J0Q2xhdXNlCiAgICAgIGFkdmFuY2UoInsiKTsKICAgICAgdmFyIGV4cG9ydGVkVG9rZW5zID0gW107CiAgICAgIGZvciAoOzspIHsKICAgICAgICBpZiAoIXN0YXRlLnRva2Vucy5uZXh0LmlkZW50aWZpZXIpIHsKICAgICAgICAgIGVycm9yKCJFMDMwIiwgc3RhdGUudG9rZW5zLm5leHQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYWR2YW5jZSgpOwoKICAgICAgICBleHBvcnRlZFRva2Vucy5wdXNoKHN0YXRlLnRva2Vucy5jdXJyKTsKCiAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiYXMiKSB7CiAgICAgICAgICBhZHZhbmNlKCJhcyIpOwogICAgICAgICAgaWYgKCFzdGF0ZS50b2tlbnMubmV4dC5pZGVudGlmaWVyKSB7CiAgICAgICAgICAgIGVycm9yKCJFMDMwIiwgc3RhdGUudG9rZW5zLm5leHQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGFkdmFuY2UoKTsKICAgICAgICB9CgogICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIiwiKSB7CiAgICAgICAgICBhZHZhbmNlKCIsIik7CiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gIn0iKSB7CiAgICAgICAgICBhZHZhbmNlKCJ9Iik7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXJyb3IoIkUwMjQiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC52YWx1ZSA9PT0gImZyb20iKSB7CiAgICAgICAgLy8gRXhwb3J0RGVjbGFyYXRpb24gOjogZXhwb3J0IEV4cG9ydENsYXVzZSBGcm9tQ2xhdXNlCiAgICAgICAgYWR2YW5jZSgiZnJvbSIpOwogICAgICAgIGFkdmFuY2UoIihzdHJpbmcpIik7CiAgICAgIH0gZWxzZSBpZiAob2spIHsKICAgICAgICBleHBvcnRlZFRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLnNldEV4cG9ydGVkKHRva2VuLnZhbHVlLCB0b2tlbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAidmFyIikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OiBleHBvcnQgVmFyaWFibGVTdGF0ZW1lbnQKICAgICAgYWR2YW5jZSgidmFyIik7CiAgICAgIHN0YXRlLnRva2Vucy5jdXJyLmZ1ZCh7IGluZXhwb3J0OnRydWUgfSk7CiAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAibGV0IikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OiBleHBvcnQgVmFyaWFibGVTdGF0ZW1lbnQKICAgICAgYWR2YW5jZSgibGV0Iik7CiAgICAgIHN0YXRlLnRva2Vucy5jdXJyLmZ1ZCh7IGluZXhwb3J0OnRydWUgfSk7CiAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiY29uc3QiKSB7CiAgICAgIC8vIEV4cG9ydERlY2xhcmF0aW9uIDo6IGV4cG9ydCBWYXJpYWJsZVN0YXRlbWVudAogICAgICBhZHZhbmNlKCJjb25zdCIpOwogICAgICBzdGF0ZS50b2tlbnMuY3Vyci5mdWQoeyBpbmV4cG9ydDp0cnVlIH0pOwogICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OiBleHBvcnQgRGVjbGFyYXRpb24KICAgICAgdGhpcy5ibG9jayA9IHRydWU7CiAgICAgIGFkdmFuY2UoImZ1bmN0aW9uIik7CiAgICAgIHN0YXRlLnN5bnRheFsiZnVuY3Rpb24iXS5mdWQoeyBpbmV4cG9ydDp0cnVlIH0pOwogICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gImNsYXNzIikgewogICAgICAvLyBFeHBvcnREZWNsYXJhdGlvbiA6OiBleHBvcnQgRGVjbGFyYXRpb24KICAgICAgdGhpcy5ibG9jayA9IHRydWU7CiAgICAgIGFkdmFuY2UoImNsYXNzIik7CiAgICAgIHZhciBjbGFzc05hbWVUb2tlbiA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgICBzdGF0ZS5zeW50YXhbImNsYXNzIl0uZnVkKCk7CiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0uc2V0RXhwb3J0ZWQoY2xhc3NOYW1lVG9rZW4udmFsdWUsIGNsYXNzTmFtZVRva2VuKTsKICAgIH0gZWxzZSB7CiAgICAgIGVycm9yKCJFMDI0Iiwgc3RhdGUudG9rZW5zLm5leHQsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9KS5leHBzID0gdHJ1ZTsKCiAgLy8gRnV0dXJlIFJlc2VydmVkIFdvcmRzCgogIEZ1dHVyZVJlc2VydmVkV29yZCgiYWJzdHJhY3QiKTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoImF3YWl0IiwgeyBlczU6IHRydWUsIG1vZHVsZU9ubHk6IHRydWUgfSk7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJib29sZWFuIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJieXRlIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJjaGFyIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJjbGFzcyIsIHsgZXM1OiB0cnVlLCBudWQ6IGNsYXNzZGVmIH0pOwogIEZ1dHVyZVJlc2VydmVkV29yZCgiZG91YmxlIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJlbnVtIiwgeyBlczU6IHRydWUgfSk7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJleHBvcnQiLCB7IGVzNTogdHJ1ZSB9KTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoImV4dGVuZHMiLCB7IGVzNTogdHJ1ZSB9KTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoImZpbmFsIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJmbG9hdCIpOwogIEZ1dHVyZVJlc2VydmVkV29yZCgiZ290byIpOwogIEZ1dHVyZVJlc2VydmVkV29yZCgiaW1wbGVtZW50cyIsIHsgZXM1OiB0cnVlLCBzdHJpY3RPbmx5OiB0cnVlIH0pOwogIEZ1dHVyZVJlc2VydmVkV29yZCgiaW1wb3J0IiwgeyBlczU6IHRydWUgfSk7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJpbnQiKTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoImludGVyZmFjZSIsIHsgZXM1OiB0cnVlLCBzdHJpY3RPbmx5OiB0cnVlIH0pOwogIEZ1dHVyZVJlc2VydmVkV29yZCgibG9uZyIpOwogIEZ1dHVyZVJlc2VydmVkV29yZCgibmF0aXZlIik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJwYWNrYWdlIiwgeyBlczU6IHRydWUsIHN0cmljdE9ubHk6IHRydWUgfSk7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJwcml2YXRlIiwgeyBlczU6IHRydWUsIHN0cmljdE9ubHk6IHRydWUgfSk7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJwcm90ZWN0ZWQiLCB7IGVzNTogdHJ1ZSwgc3RyaWN0T25seTogdHJ1ZSB9KTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoInB1YmxpYyIsIHsgZXM1OiB0cnVlLCBzdHJpY3RPbmx5OiB0cnVlIH0pOwogIEZ1dHVyZVJlc2VydmVkV29yZCgic2hvcnQiKTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoInN0YXRpYyIsIHsgZXM1OiB0cnVlLCBzdHJpY3RPbmx5OiB0cnVlIH0pOwogIEZ1dHVyZVJlc2VydmVkV29yZCgic3VwZXIiLCB7IGVzNTogdHJ1ZSB9KTsKICBGdXR1cmVSZXNlcnZlZFdvcmQoInN5bmNocm9uaXplZCIpOwogIEZ1dHVyZVJlc2VydmVkV29yZCgidHJhbnNpZW50Iik7CiAgRnV0dXJlUmVzZXJ2ZWRXb3JkKCJ2b2xhdGlsZSIpOwoKICAvLyB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBzcXVhcmVicmFja2V0IG9yIGEgY3VybHlicmFja2V0CiAgLy8gZXhwcmVzc2lvbiBpcyBhIGNvbXByZWhlbnNpb24gYXJyYXksIGRlc3RydWN0dXJpbmcgYXNzaWdubWVudCBvciBhIGpzb24gdmFsdWUuCgogIHZhciBsb29rdXBCbG9ja1R5cGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBwbiwgcG4xLCBwcmV2OwogICAgdmFyIGkgPSAtMTsKICAgIHZhciBicmFja2V0U3RhY2sgPSAwOwogICAgdmFyIHJldCA9IHt9OwogICAgaWYgKGNoZWNrUHVuY3R1YXRvcnMoc3RhdGUudG9rZW5zLmN1cnIsIFsiWyIsICJ7Il0pKSB7CiAgICAgIGJyYWNrZXRTdGFjayArPSAxOwogICAgfQogICAgZG8gewogICAgICBwcmV2ID0gaSA9PT0gLTEgPyBzdGF0ZS50b2tlbnMuY3VyciA6IHBuOwogICAgICBwbiA9IGkgPT09IC0xID8gc3RhdGUudG9rZW5zLm5leHQgOiBwZWVrKGkpOwogICAgICBwbjEgPSBwZWVrKGkgKyAxKTsKICAgICAgaSA9IGkgKyAxOwogICAgICBpZiAoY2hlY2tQdW5jdHVhdG9ycyhwbiwgWyJbIiwgInsiXSkpIHsKICAgICAgICBicmFja2V0U3RhY2sgKz0gMTsKICAgICAgfSBlbHNlIGlmIChjaGVja1B1bmN0dWF0b3JzKHBuLCBbIl0iLCAifSJdKSkgewogICAgICAgIGJyYWNrZXRTdGFjayAtPSAxOwogICAgICB9CiAgICAgIGlmIChicmFja2V0U3RhY2sgPT09IDEgJiYgcG4uaWRlbnRpZmllciAmJiBwbi52YWx1ZSA9PT0gImZvciIgJiYKICAgICAgICAgICFjaGVja1B1bmN0dWF0b3IocHJldiwgIi4iKSkgewogICAgICAgIHJldC5pc0NvbXBBcnJheSA9IHRydWU7CiAgICAgICAgcmV0Lm5vdEpzb24gPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChicmFja2V0U3RhY2sgPT09IDAgJiYgY2hlY2tQdW5jdHVhdG9ycyhwbiwgWyJ9IiwgIl0iXSkpIHsKICAgICAgICBpZiAocG4xLnZhbHVlID09PSAiPSIpIHsKICAgICAgICAgIHJldC5pc0Rlc3RBc3NpZ24gPSB0cnVlOwogICAgICAgICAgcmV0Lm5vdEpzb24gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSBlbHNlIGlmIChwbjEudmFsdWUgPT09ICIuIikgewogICAgICAgICAgcmV0Lm5vdEpzb24gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjaGVja1B1bmN0dWF0b3IocG4sICI7IikpIHsKICAgICAgICByZXQuaXNCbG9jayA9IHRydWU7CiAgICAgICAgcmV0Lm5vdEpzb24gPSB0cnVlOwogICAgICB9CiAgICB9IHdoaWxlIChicmFja2V0U3RhY2sgPiAwICYmIHBuLmlkICE9PSAiKGVuZCkiKTsKICAgIHJldHVybiByZXQ7CiAgfTsKCiAgZnVuY3Rpb24gc2F2ZVByb3BlcnR5KHByb3BzLCBuYW1lLCB0a24sIGlzQ2xhc3MsIGlzU3RhdGljKSB7CiAgICB2YXIgbXNnID0gWyJrZXkiLCAiY2xhc3MgbWV0aG9kIiwgInN0YXRpYyBjbGFzcyBtZXRob2QiXTsKICAgIG1zZyA9IG1zZ1soaXNDbGFzcyB8fCBmYWxzZSkgKyAoaXNTdGF0aWMgfHwgZmFsc2UpXTsKICAgIGlmICh0a24uaWRlbnRpZmllcikgewogICAgICBuYW1lID0gdGtuLnZhbHVlOwogICAgfQoKICAgIGlmIChwcm9wc1tuYW1lXSAmJiBuYW1lICE9PSAiX19wcm90b19fIikgewogICAgICB3YXJuaW5nKCJXMDc1Iiwgc3RhdGUudG9rZW5zLm5leHQsIG1zZywgbmFtZSk7CiAgICB9IGVsc2UgewogICAgICBwcm9wc1tuYW1lXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9CgogICAgcHJvcHNbbmFtZV0uYmFzaWMgPSB0cnVlOwogICAgcHJvcHNbbmFtZV0uYmFzaWN0a24gPSB0a247CiAgfQoKICAvKioKICAgKiBAcGFyYW0ge3N0cmluZ30gYWNjZXNzb3JUeXBlIC0gRWl0aGVyICJnZXQiIG9yICJzZXQiCiAgICogQHBhcmFtIHtvYmplY3R9IHByb3BzIC0gYSBjb2xsZWN0aW9uIG9mIGFsbCBwcm9wZXJ0aWVzIG9mIHRoZSBvYmplY3QgdG8KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB3aGljaCB0aGUgY3VycmVudCBhY2Nlc3NvciBpcyBiZWluZyBhc3NpZ25lZAogICAqIEBwYXJhbSB7b2JqZWN0fSB0a24gLSB0aGUgaWRlbnRpZmllciB0b2tlbiByZXByZXNlbnRpbmcgdGhlIGFjY2Vzc29yIG5hbWUKICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzQ2xhc3MgLSB3aGV0aGVyIHRoZSBhY2Nlc3NvciBpcyBwYXJ0IG9mIGFuIEVTNiBDbGFzcwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluaXRpb24KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzU3RhdGljIC0gd2hldGhlciB0aGUgYWNjZXNzb3IgaXMgYSBzdGF0aWMgbWV0aG9kCiAgICovCiAgZnVuY3Rpb24gc2F2ZUFjY2Vzc29yKGFjY2Vzc29yVHlwZSwgcHJvcHMsIG5hbWUsIHRrbiwgaXNDbGFzcywgaXNTdGF0aWMpIHsKICAgIHZhciBmbGFnTmFtZSA9IGFjY2Vzc29yVHlwZSA9PT0gImdldCIgPyAiZ2V0dGVyVG9rZW4iIDogInNldHRlclRva2VuIjsKICAgIHZhciBtc2cgPSAiIjsKCiAgICBpZiAoaXNDbGFzcykgewogICAgICBpZiAoaXNTdGF0aWMpIHsKICAgICAgICBtc2cgKz0gInN0YXRpYyAiOwogICAgICB9CiAgICAgIG1zZyArPSBhY2Nlc3NvclR5cGUgKyAidGVyIG1ldGhvZCI7CiAgICB9IGVsc2UgewogICAgICBtc2cgPSAia2V5IjsKICAgIH0KCiAgICBzdGF0ZS50b2tlbnMuY3Vyci5hY2Nlc3NvclR5cGUgPSBhY2Nlc3NvclR5cGU7CiAgICBzdGF0ZS5uYW1lU3RhY2suc2V0KHRrbik7CgogICAgaWYgKHByb3BzW25hbWVdKSB7CiAgICAgIGlmICgocHJvcHNbbmFtZV0uYmFzaWMgfHwgcHJvcHNbbmFtZV1bZmxhZ05hbWVdKSAmJiBuYW1lICE9PSAiX19wcm90b19fIikgewogICAgICAgIHdhcm5pbmcoIlcwNzUiLCBzdGF0ZS50b2tlbnMubmV4dCwgbXNnLCBuYW1lKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcHJvcHNbbmFtZV0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQoKICAgIHByb3BzW25hbWVdW2ZsYWdOYW1lXSA9IHRrbjsKICB9CgogIGZ1bmN0aW9uIGNvbXB1dGVkUHJvcGVydHlOYW1lKCkgewogICAgYWR2YW5jZSgiWyIpOwogICAgaWYgKCFzdGF0ZS5pbkVTNigpKSB7CiAgICAgIHdhcm5pbmcoIlcxMTkiLCBzdGF0ZS50b2tlbnMuY3VyciwgImNvbXB1dGVkIHByb3BlcnR5IG5hbWVzIiwgIjYiKTsKICAgIH0KICAgIHZhciB2YWx1ZSA9IGV4cHJlc3Npb24oMTApOwogICAgYWR2YW5jZSgiXSIpOwogICAgcmV0dXJuIHZhbHVlOwogIH0KCiAgLyoqCiAgICogVGVzdCB3aGV0aGVyIGEgZ2l2ZW4gdG9rZW4gaXMgYSBwdW5jdHVhdG9yIG1hdGNoaW5nIG9uZSBvZiB0aGUgc3BlY2lmaWVkIHZhbHVlcwogICAqIEBwYXJhbSB7VG9rZW59IHRva2VuCiAgICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gdmFsdWVzCiAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICovCiAgZnVuY3Rpb24gY2hlY2tQdW5jdHVhdG9ycyh0b2tlbiwgdmFsdWVzKSB7CiAgICBpZiAodG9rZW4udHlwZSA9PT0gIihwdW5jdHVhdG9yKSIpIHsKICAgICAgcmV0dXJuIF8uY29udGFpbnModmFsdWVzLCB0b2tlbi52YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBUZXN0IHdoZXRoZXIgYSBnaXZlbiB0b2tlbiBpcyBhIHB1bmN0dWF0b3IgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCB2YWx1ZQogICAqIEBwYXJhbSB7VG9rZW59IHRva2VuCiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICovCiAgZnVuY3Rpb24gY2hlY2tQdW5jdHVhdG9yKHRva2VuLCB2YWx1ZSkgewogICAgcmV0dXJuIHRva2VuLnR5cGUgPT09ICIocHVuY3R1YXRvcikiICYmIHRva2VuLnZhbHVlID09PSB2YWx1ZTsKICB9CgogIC8vIENoZWNrIHdoZXRoZXIgdGhpcyBmdW5jdGlvbiBoYXMgYmVlbiByZWFjaGVkIGZvciBhIGRlc3RydWN0dXJpbmcgYXNzaWduIHdpdGggdW5kZWNsYXJlZCB2YWx1ZXMKICBmdW5jdGlvbiBkZXN0cnVjdHVyaW5nQXNzaWduT3JKc29uVmFsdWUoKSB7CiAgICAvLyBsb29rdXAgZm9yIHRoZSBhc3NpZ25tZW50IChFQ01BU2NyaXB0IDYgb25seSkKICAgIC8vIGlmIGl0IGhhcyBzZW1pY29sb25zLCBpdCBpcyBhIGJsb2NrLCBzbyBnbyBwYXJzZSBpdCBhcyBhIGJsb2NrCiAgICAvLyBvciBpdCdzIG5vdCBhIGJsb2NrLCBidXQgdGhlcmUgYXJlIGFzc2lnbm1lbnRzLCBjaGVjayBmb3IgdW5kZWNsYXJlZCB2YXJpYWJsZXMKCiAgICB2YXIgYmxvY2sgPSBsb29rdXBCbG9ja1R5cGUoKTsKICAgIGlmIChibG9jay5ub3RKc29uKSB7CiAgICAgIGlmICghc3RhdGUuaW5FUzYoKSAmJiBibG9jay5pc0Rlc3RBc3NpZ24pIHsKICAgICAgICB3YXJuaW5nKCJXMTA0Iiwgc3RhdGUudG9rZW5zLmN1cnIsICJkZXN0cnVjdHVyaW5nIGFzc2lnbm1lbnQiLCAiNiIpOwogICAgICB9CiAgICAgIHN0YXRlbWVudHMoKTsKICAgIC8vIG90aGVyd2lzZSBwYXJzZSBqc29uIHZhbHVlCiAgICB9IGVsc2UgewogICAgICBzdGF0ZS5vcHRpb24ubGF4YnJlYWsgPSB0cnVlOwogICAgICBzdGF0ZS5qc29uTW9kZSA9IHRydWU7CiAgICAgIGpzb25WYWx1ZSgpOwogICAgfQogIH0KCiAgLy8gYXJyYXkgY29tcHJlaGVuc2lvbiBwYXJzaW5nIGZ1bmN0aW9uCiAgLy8gcGFyc2VzIGFuZCBkZWZpbmVzIHRoZSB0aHJlZSBzdGF0ZXMgb2YgdGhlIGxpc3QgY29tcHJlaGVuc2lvbiBpbiBvcmRlcgogIC8vIHRvIGF2b2lkIGRlZmluaW5nIGdsb2JhbCB2YXJpYWJsZXMsIGJ1dCBrZWVwaW5nIHRoZW0gdG8gdGhlIGxpc3QgY29tcHJlaGVuc2lvbiBzY29wZQogIC8vIG9ubHkuIFRoZSBvcmRlciBvZiB0aGUgc3RhdGVzIGFyZSBhcyBmb2xsb3dzOgogIC8vICAqICJ1c2UiIHdoaWNoIHdpbGwgYmUgdGhlIHJldHVybmVkIGl0ZXJhdGl2ZSBwYXJ0IG9mIHRoZSBsaXN0IGNvbXByZWhlbnNpb24KICAvLyAgKiAiZGVmaW5lIiB3aGljaCB3aWxsIGRlZmluZSB0aGUgdmFyaWFibGVzIGxvY2FsIHRvIHRoZSBsaXN0IGNvbXByZWhlbnNpb24KICAvLyAgKiAiZmlsdGVyIiB3aGljaCB3aWxsIGhlbHAgZmlsdGVyIG91dCB2YWx1ZXMKCiAgdmFyIGFycmF5Q29tcHJlaGVuc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIENvbXBBcnJheSA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm1vZGUgPSAidXNlIjsKICAgICAgdGhpcy52YXJpYWJsZXMgPSBbXTsKICAgIH07CiAgICB2YXIgX2NhcnJheXMgPSBbXTsKICAgIHZhciBfY3VycmVudDsKICAgIGZ1bmN0aW9uIGRlY2xhcmUodikgewogICAgICB2YXIgbCA9IF9jdXJyZW50LnZhcmlhYmxlcy5maWx0ZXIoZnVuY3Rpb24oZWx0KSB7CiAgICAgICAgLy8gaWYgaXQgaGFzLCBjaGFuZ2UgaXRzIHVuZGVmIHN0YXRlCiAgICAgICAgaWYgKGVsdC52YWx1ZSA9PT0gdikgewogICAgICAgICAgZWx0LnVuZGVmID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9CiAgICAgIH0pLmxlbmd0aDsKICAgICAgcmV0dXJuIGwgIT09IDA7CiAgICB9CiAgICBmdW5jdGlvbiB1c2UodikgewogICAgICB2YXIgbCA9IF9jdXJyZW50LnZhcmlhYmxlcy5maWx0ZXIoZnVuY3Rpb24oZWx0KSB7CiAgICAgICAgLy8gYW5kIGlmIGl0IGhhcyBiZWVuIGRlZmluZWQKICAgICAgICBpZiAoZWx0LnZhbHVlID09PSB2ICYmICFlbHQudW5kZWYpIHsKICAgICAgICAgIGlmIChlbHQudW51c2VkID09PSB0cnVlKSB7CiAgICAgICAgICAgIGVsdC51bnVzZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KICAgICAgfSkubGVuZ3RoOwogICAgICAvLyBvdGhlcndpc2Ugd2Ugd2FybiBhYm91dCBpdAogICAgICByZXR1cm4gKGwgPT09IDApOwogICAgfQogICAgcmV0dXJuIHsgc3RhY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgX2N1cnJlbnQgPSBuZXcgQ29tcEFycmF5KCk7CiAgICAgICAgICBfY2FycmF5cy5wdXNoKF9jdXJyZW50KTsKICAgICAgICB9LAogICAgICAgIHVuc3RhY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgX2N1cnJlbnQudmFyaWFibGVzLmZpbHRlcihmdW5jdGlvbih2KSB7CiAgICAgICAgICAgIGlmICh2LnVudXNlZCkKICAgICAgICAgICAgICB3YXJuaW5nKCJXMDk4Iiwgdi50b2tlbiwgdi5yYXdfdGV4dCB8fCB2LnZhbHVlKTsKICAgICAgICAgICAgaWYgKHYudW5kZWYpCiAgICAgICAgICAgICAgc3RhdGUuZnVuY3RbIihzY29wZSkiXS5ibG9jay51c2Uodi52YWx1ZSwgdi50b2tlbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIF9jYXJyYXlzLnNwbGljZSgtMSwgMSk7CiAgICAgICAgICBfY3VycmVudCA9IF9jYXJyYXlzW19jYXJyYXlzLmxlbmd0aCAtIDFdOwogICAgICAgIH0sCiAgICAgICAgc2V0U3RhdGU6IGZ1bmN0aW9uKHMpIHsKICAgICAgICAgIGlmIChfLmNvbnRhaW5zKFsidXNlIiwgImRlZmluZSIsICJnZW5lcmF0ZSIsICJmaWx0ZXIiXSwgcykpCiAgICAgICAgICAgIF9jdXJyZW50Lm1vZGUgPSBzOwogICAgICAgIH0sCiAgICAgICAgY2hlY2s6IGZ1bmN0aW9uKHYpIHsKICAgICAgICAgIGlmICghX2N1cnJlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gInVzZSIgc3RhdGUgb2YgdGhlIGxpc3QgY29tcCwgd2UgZW5xdWV1ZSB0aGF0IHZhcgogICAgICAgICAgaWYgKF9jdXJyZW50ICYmIF9jdXJyZW50Lm1vZGUgPT09ICJ1c2UiKSB7CiAgICAgICAgICAgIGlmICh1c2UodikpIHsKICAgICAgICAgICAgICBfY3VycmVudC52YXJpYWJsZXMucHVzaCh7CiAgICAgICAgICAgICAgICBmdW5jdDogc3RhdGUuZnVuY3QsCiAgICAgICAgICAgICAgICB0b2tlbjogc3RhdGUudG9rZW5zLmN1cnIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdiwKICAgICAgICAgICAgICAgIHVuZGVmOiB0cnVlLAogICAgICAgICAgICAgICAgdW51c2VkOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gImRlZmluZSIgc3RhdGUgb2YgdGhlIGxpc3QgY29tcCwKICAgICAgICAgIH0gZWxzZSBpZiAoX2N1cnJlbnQgJiYgX2N1cnJlbnQubW9kZSA9PT0gImRlZmluZSIpIHsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHZhcmlhYmxlIGhhcyBiZWVuIHVzZWQgcHJldmlvdXNseQogICAgICAgICAgICBpZiAoIWRlY2xhcmUodikpIHsKICAgICAgICAgICAgICBfY3VycmVudC52YXJpYWJsZXMucHVzaCh7CiAgICAgICAgICAgICAgICBmdW5jdDogc3RhdGUuZnVuY3QsCiAgICAgICAgICAgICAgICB0b2tlbjogc3RhdGUudG9rZW5zLmN1cnIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdiwKICAgICAgICAgICAgICAgIHVuZGVmOiBmYWxzZSwKICAgICAgICAgICAgICAgIHVudXNlZDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gdGhlICJnZW5lcmF0ZSIgc3RhdGUgb2YgdGhlIGxpc3QgY29tcCwKICAgICAgICAgIH0gZWxzZSBpZiAoX2N1cnJlbnQgJiYgX2N1cnJlbnQubW9kZSA9PT0gImdlbmVyYXRlIikgewogICAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmJsb2NrLnVzZSh2LCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gImZpbHRlciIgc3RhdGUsCiAgICAgICAgICB9IGVsc2UgaWYgKF9jdXJyZW50ICYmIF9jdXJyZW50Lm1vZGUgPT09ICJmaWx0ZXIiKSB7CiAgICAgICAgICAgIC8vIHdlIGNoZWNrIHdoZXRoZXIgY3VycmVudCB2YXJpYWJsZSBoYXMgYmVlbiBkZWNsYXJlZAogICAgICAgICAgICBpZiAodXNlKHYpKSB7CiAgICAgICAgICAgICAgLy8gaWYgbm90IHdlIHdhcm4gYWJvdXQgaXQKICAgICAgICAgICAgICBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmJsb2NrLnVzZSh2LCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIH07CiAgfTsKCgogIC8vIFBhcnNlIEpTT04KCiAgZnVuY3Rpb24ganNvblZhbHVlKCkgewogICAgZnVuY3Rpb24ganNvbk9iamVjdCgpIHsKICAgICAgdmFyIG8gPSB7fSwgdCA9IHN0YXRlLnRva2Vucy5uZXh0OwogICAgICBhZHZhbmNlKCJ7Iik7CiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIn0iKSB7CiAgICAgICAgZm9yICg7OykgewogICAgICAgICAgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiKGVuZCkiKSB7CiAgICAgICAgICAgIGVycm9yKCJFMDI2Iiwgc3RhdGUudG9rZW5zLm5leHQsIHQubGluZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAifSIpIHsKICAgICAgICAgICAgd2FybmluZygiVzA5NCIsIHN0YXRlLnRva2Vucy5jdXJyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkID09PSAiLCIpIHsKICAgICAgICAgICAgZXJyb3IoIkUwMjgiLCBzdGF0ZS50b2tlbnMubmV4dCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLnRva2Vucy5uZXh0LmlkICE9PSAiKHN0cmluZykiKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwOTUiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9bc3RhdGUudG9rZW5zLm5leHQudmFsdWVdID09PSB0cnVlKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwNzUiLCBzdGF0ZS50b2tlbnMubmV4dCwgImtleSIsIHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlKTsKICAgICAgICAgIH0gZWxzZSBpZiAoKHN0YXRlLnRva2Vucy5uZXh0LnZhbHVlID09PSAiX19wcm90b19fIiAmJgogICAgICAgICAgICAhc3RhdGUub3B0aW9uLnByb3RvKSB8fCAoc3RhdGUudG9rZW5zLm5leHQudmFsdWUgPT09ICJfX2l0ZXJhdG9yX18iICYmCiAgICAgICAgICAgICFzdGF0ZS5vcHRpb24uaXRlcmF0b3IpKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwOTYiLCBzdGF0ZS50b2tlbnMubmV4dCwgc3RhdGUudG9rZW5zLm5leHQudmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb1tzdGF0ZS50b2tlbnMubmV4dC52YWx1ZV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgYWR2YW5jZSgpOwogICAgICAgICAgYWR2YW5jZSgiOiIpOwogICAgICAgICAganNvblZhbHVlKCk7CiAgICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIsIikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGFkdmFuY2UoIiwiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYWR2YW5jZSgifSIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGpzb25BcnJheSgpIHsKICAgICAgdmFyIHQgPSBzdGF0ZS50b2tlbnMubmV4dDsKICAgICAgYWR2YW5jZSgiWyIpOwogICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICJdIikgewogICAgICAgIGZvciAoOzspIHsKICAgICAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIihlbmQpIikgewogICAgICAgICAgICBlcnJvcigiRTAyNyIsIHN0YXRlLnRva2Vucy5uZXh0LCB0LmxpbmUpOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIl0iKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwOTQiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCA9PT0gIiwiKSB7CiAgICAgICAgICAgIGVycm9yKCJFMDI4Iiwgc3RhdGUudG9rZW5zLm5leHQpOwogICAgICAgICAgfQogICAgICAgICAganNvblZhbHVlKCk7CiAgICAgICAgICBpZiAoc3RhdGUudG9rZW5zLm5leHQuaWQgIT09ICIsIikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGFkdmFuY2UoIiwiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYWR2YW5jZSgiXSIpOwogICAgfQoKICAgIHN3aXRjaCAoc3RhdGUudG9rZW5zLm5leHQuaWQpIHsKICAgIGNhc2UgInsiOgogICAgICBqc29uT2JqZWN0KCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiWyI6CiAgICAgIGpzb25BcnJheSgpOwogICAgICBicmVhazsKICAgIGNhc2UgInRydWUiOgogICAgY2FzZSAiZmFsc2UiOgogICAgY2FzZSAibnVsbCI6CiAgICBjYXNlICIobnVtYmVyKSI6CiAgICBjYXNlICIoc3RyaW5nKSI6CiAgICAgIGFkdmFuY2UoKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICItIjoKICAgICAgYWR2YW5jZSgiLSIpOwogICAgICBhZHZhbmNlKCIobnVtYmVyKSIpOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIGVycm9yKCJFMDAzIiwgc3RhdGUudG9rZW5zLm5leHQpOwogICAgfQogIH0KCiAgLyoqCiAgICogTGludCBkeW5hbWljYWxseS1ldmFsdWF0ZWQgY29kZSwgYXBwZW5kaW5nIGFueSByZXN1bHRpbmcgZXJyb3JzL3dhcm5pbmdzCiAgICogaW50byB0aGUgZ2xvYmFsIGBlcnJvcnNgIGFycmF5LgogICAqCiAgICogQHBhcmFtIHthcnJheX0gaW50ZXJuYWxzIC0gY29sbGVjdGlvbiBvZiAiaW50ZXJuYWxzIiBvYmplY3RzIGRlc2NyaWJpbmcKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdG9rZW5zIHRoYXQgY29udGFpbiBldmFsdWF0ZWQgY29kZQogICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gbGludGluZyBvcHRpb25zIHRvIGFwcGx5CiAgICogQHBhcmFtIHtvYmplY3R9IGdsb2JhbHMgLSBnbG9iYWxseS1kZWZpbmVkIGJpbmRpbmdzIGZvciB0aGUgZXZhbHVhdGVkIGNvZGUKICAgKi8KICBmdW5jdGlvbiBsaW50RXZhbENvZGUoaW50ZXJuYWxzLCBvcHRpb25zLCBnbG9iYWxzKSB7CiAgICB2YXIgcHJpb3JFcnJvckNvdW50LCBpZHgsIGpkeCwgaW50ZXJuYWw7CgogICAgZm9yIChpZHggPSAwOyBpZHggPCBpbnRlcm5hbHMubGVuZ3RoOyBpZHggKz0gMSkgewogICAgICBpbnRlcm5hbCA9IGludGVybmFsc1tpZHhdOwogICAgICBvcHRpb25zLnNjb3BlID0gaW50ZXJuYWwuZWxlbTsKICAgICAgcHJpb3JFcnJvckNvdW50ID0gSlNISU5ULmVycm9ycy5sZW5ndGg7CgogICAgICBpdHNlbGYoaW50ZXJuYWwuY29kZSwgb3B0aW9ucywgZ2xvYmFscyk7CgogICAgICBmb3IgKGpkeCA9IHByaW9yRXJyb3JDb3VudDsgamR4IDwgSlNISU5ULmVycm9ycy5sZW5ndGg7IGpkeCArPSAxKSB7CiAgICAgICAgSlNISU5ULmVycm9yc1tqZHhdLmxpbmUgKz0gaW50ZXJuYWwudG9rZW4ubGluZSAtIDE7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBlc2NhcGVSZWdleCA9IGZ1bmN0aW9uKHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLVwvXFxeJCorPy4oKXxbXF17fV0vZywgIlxcJCYiKTsKICB9OwoKICAvLyBUaGUgYWN0dWFsIEpTSElOVCBmdW5jdGlvbiBpdHNlbGYuCiAgdmFyIGl0c2VsZiA9IGZ1bmN0aW9uKHMsIG8sIGcpIHsKICAgIHZhciB4LCByZUlnbm9yZVN0ciwgcmVJZ25vcmU7CiAgICB2YXIgb3B0aW9uS2V5czsKICAgIHZhciBuZXdPcHRpb25PYmogPSB7fTsKICAgIHZhciBuZXdJZ25vcmVkT2JqID0ge307CgogICAgbyA9IF8uY2xvbmUobyk7CiAgICBzdGF0ZS5yZXNldCgpOwoKICAgIGlmIChvICYmIG8uc2NvcGUpIHsKICAgICAgSlNISU5ULnNjb3BlID0gby5zY29wZTsKICAgIH0gZWxzZSB7CiAgICAgIEpTSElOVC5lcnJvcnMgPSBbXTsKICAgICAgSlNISU5ULnVuZGVmcyA9IFtdOwogICAgICBKU0hJTlQuaW50ZXJuYWxzID0gW107CiAgICAgIEpTSElOVC5ibGFja2xpc3QgPSB7fTsKICAgICAgSlNISU5ULnNjb3BlID0gIihtYWluKSI7CiAgICB9CgogICAgcHJlZGVmaW5lZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb21iaW5lKHByZWRlZmluZWQsIHZhcnMuZWNtYUlkZW50aWZpZXJzWzNdKTsKICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgdmFycy5yZXNlcnZlZFZhcnMpOwoKICAgIGNvbWJpbmUocHJlZGVmaW5lZCwgZyB8fCB7fSk7CgogICAgZGVjbGFyZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdmFyIGV4cG9ydGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsgLy8gVmFyaWFibGVzIHRoYXQgbGl2ZSBvdXRzaWRlIHRoZSBjdXJyZW50IGZpbGUKCiAgICBmdW5jdGlvbiBlYWNoKG9iaiwgY2IpIHsKICAgICAgaWYgKCFvYmopCiAgICAgICAgcmV0dXJuOwoKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9iaikgJiYgdHlwZW9mIG9iaiA9PT0gIm9iamVjdCIpCiAgICAgICAgb2JqID0gT2JqZWN0LmtleXMob2JqKTsKCiAgICAgIG9iai5mb3JFYWNoKGNiKTsKICAgIH0KCiAgICBpZiAobykgewogICAgICBlYWNoKG8ucHJlZGVmIHx8IG51bGwsIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICB2YXIgc2xpY2UsIHByb3A7CgogICAgICAgIGlmIChpdGVtWzBdID09PSAiLSIpIHsKICAgICAgICAgIHNsaWNlID0gaXRlbS5zbGljZSgxKTsKICAgICAgICAgIEpTSElOVC5ibGFja2xpc3Rbc2xpY2VdID0gc2xpY2U7CiAgICAgICAgICAvLyByZW1vdmUgZnJvbSBwcmVkZWZpbmVkIGlmIHRoZXJlCiAgICAgICAgICBkZWxldGUgcHJlZGVmaW5lZFtzbGljZV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb3AgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG8ucHJlZGVmLCBpdGVtKTsKICAgICAgICAgIHByZWRlZmluZWRbaXRlbV0gPSBwcm9wID8gcHJvcC52YWx1ZSA6IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBlYWNoKG8uZXhwb3J0ZWQgfHwgbnVsbCwgZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGV4cG9ydGVkW2l0ZW1dID0gdHJ1ZTsKICAgICAgfSk7CgogICAgICBkZWxldGUgby5wcmVkZWY7CiAgICAgIGRlbGV0ZSBvLmV4cG9ydGVkOwoKICAgICAgb3B0aW9uS2V5cyA9IE9iamVjdC5rZXlzKG8pOwogICAgICBmb3IgKHggPSAwOyB4IDwgb3B0aW9uS2V5cy5sZW5ndGg7IHgrKykgewogICAgICAgIGlmICgvXi1XXGR7M30kL2cudGVzdChvcHRpb25LZXlzW3hdKSkgewogICAgICAgICAgbmV3SWdub3JlZE9ialtvcHRpb25LZXlzW3hdLnNsaWNlKDEpXSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBvcHRpb25LZXkgPSBvcHRpb25LZXlzW3hdOwogICAgICAgICAgbmV3T3B0aW9uT2JqW29wdGlvbktleV0gPSBvW29wdGlvbktleV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3RhdGUub3B0aW9uID0gbmV3T3B0aW9uT2JqOwogICAgc3RhdGUuaWdub3JlZCA9IG5ld0lnbm9yZWRPYmo7CgogICAgc3RhdGUub3B0aW9uLmluZGVudCA9IHN0YXRlLm9wdGlvbi5pbmRlbnQgfHwgNDsKICAgIHN0YXRlLm9wdGlvbi5tYXhlcnIgPSBzdGF0ZS5vcHRpb24ubWF4ZXJyIHx8IDUwOwoKICAgIGluZGVudCA9IDE7CgogICAgdmFyIHNjb3BlTWFuYWdlckluc3QgPSBzY29wZU1hbmFnZXIoc3RhdGUsIHByZWRlZmluZWQsIGV4cG9ydGVkLCBkZWNsYXJlZCk7CiAgICBzY29wZU1hbmFnZXJJbnN0Lm9uKCJ3YXJuaW5nIiwgZnVuY3Rpb24oZXYpIHsKICAgICAgd2FybmluZy5hcHBseShudWxsLCBbIGV2LmNvZGUsIGV2LnRva2VuXS5jb25jYXQoZXYuZGF0YSkpOwogICAgfSk7CgogICAgc2NvcGVNYW5hZ2VySW5zdC5vbigiZXJyb3IiLCBmdW5jdGlvbihldikgewogICAgICBlcnJvci5hcHBseShudWxsLCBbIGV2LmNvZGUsIGV2LnRva2VuIF0uY29uY2F0KGV2LmRhdGEpKTsKICAgIH0pOwoKICAgIHN0YXRlLmZ1bmN0ID0gZnVuY3RvcigiKGdsb2JhbCkiLCBudWxsLCB7CiAgICAgICIoZ2xvYmFsKSIgICAgOiB0cnVlLAogICAgICAiKHNjb3BlKSIgICAgIDogc2NvcGVNYW5hZ2VySW5zdCwKICAgICAgIihjb21wYXJyYXkpIiA6IGFycmF5Q29tcHJlaGVuc2lvbigpLAogICAgICAiKG1ldHJpY3MpIiAgIDogY3JlYXRlTWV0cmljcyhzdGF0ZS50b2tlbnMubmV4dCkKICAgIH0pOwoKICAgIGZ1bmN0aW9ucyA9IFtzdGF0ZS5mdW5jdF07CiAgICB1cmxzID0gW107CiAgICBzdGFjayA9IG51bGw7CiAgICBtZW1iZXIgPSB7fTsKICAgIG1lbWJlcnNPbmx5ID0gbnVsbDsKICAgIGluYmxvY2sgPSBmYWxzZTsKICAgIGxvb2thaGVhZCA9IFtdOwoKICAgIGlmICghaXNTdHJpbmcocykgJiYgIUFycmF5LmlzQXJyYXkocykpIHsKICAgICAgZXJyb3JBdCgiRTAwNCIsIDApOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgYXBpID0gewogICAgICBnZXQgaXNKU09OKCkgewogICAgICAgIHJldHVybiBzdGF0ZS5qc29uTW9kZTsKICAgICAgfSwKCiAgICAgIGdldE9wdGlvbjogZnVuY3Rpb24obmFtZSkgewogICAgICAgIHJldHVybiBzdGF0ZS5vcHRpb25bbmFtZV0gfHwgbnVsbDsKICAgICAgfSwKCiAgICAgIGdldENhY2hlOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlLmNhY2hlW25hbWVdOwogICAgICB9LAoKICAgICAgc2V0Q2FjaGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgc3RhdGUuY2FjaGVbbmFtZV0gPSB2YWx1ZTsKICAgICAgfSwKCiAgICAgIHdhcm46IGZ1bmN0aW9uKGNvZGUsIGRhdGEpIHsKICAgICAgICB3YXJuaW5nQXQuYXBwbHkobnVsbCwgWyBjb2RlLCBkYXRhLmxpbmUsIGRhdGEuY2hhciBdLmNvbmNhdChkYXRhLmRhdGEpKTsKICAgICAgfSwKCiAgICAgIG9uOiBmdW5jdGlvbihuYW1lcywgbGlzdGVuZXIpIHsKICAgICAgICBuYW1lcy5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgZW1pdHRlci5vbihuYW1lLCBsaXN0ZW5lcik7CiAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgfTsKCiAgICBlbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpOwogICAgKGV4dHJhTW9kdWxlcyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbihmdW5jKSB7CiAgICAgIGZ1bmMoYXBpKTsKICAgIH0pOwoKICAgIHN0YXRlLnRva2Vucy5wcmV2ID0gc3RhdGUudG9rZW5zLmN1cnIgPSBzdGF0ZS50b2tlbnMubmV4dCA9IHN0YXRlLnN5bnRheFsiKGJlZ2luKSJdOwoKICAgIGlmIChvICYmIG8uaWdub3JlRGVsaW1pdGVycykgewoKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG8uaWdub3JlRGVsaW1pdGVycykpIHsKICAgICAgICBvLmlnbm9yZURlbGltaXRlcnMgPSBbby5pZ25vcmVEZWxpbWl0ZXJzXTsKICAgICAgfQoKICAgICAgby5pZ25vcmVEZWxpbWl0ZXJzLmZvckVhY2goZnVuY3Rpb24oZGVsaW1pdGVyUGFpcikgewogICAgICAgIGlmICghZGVsaW1pdGVyUGFpci5zdGFydCB8fCAhZGVsaW1pdGVyUGFpci5lbmQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgcmVJZ25vcmVTdHIgPSBlc2NhcGVSZWdleChkZWxpbWl0ZXJQYWlyLnN0YXJ0KSArCiAgICAgICAgICAgICAgICAgICAgICAiW1xcc1xcU10qPyIgKwogICAgICAgICAgICAgICAgICAgICAgZXNjYXBlUmVnZXgoZGVsaW1pdGVyUGFpci5lbmQpOwoKICAgICAgICByZUlnbm9yZSA9IG5ldyBSZWdFeHAocmVJZ25vcmVTdHIsICJpZyIpOwoKICAgICAgICBzID0gcy5yZXBsYWNlKHJlSWdub3JlLCBmdW5jdGlvbihtYXRjaCkgewogICAgICAgICAgcmV0dXJuIG1hdGNoLnJlcGxhY2UoLy4vZywgIiAiKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgbGV4ID0gbmV3IExleGVyKHMpOwoKICAgIGxleC5vbigid2FybmluZyIsIGZ1bmN0aW9uKGV2KSB7CiAgICAgIHdhcm5pbmdBdC5hcHBseShudWxsLCBbIGV2LmNvZGUsIGV2LmxpbmUsIGV2LmNoYXJhY3Rlcl0uY29uY2F0KGV2LmRhdGEpKTsKICAgIH0pOwoKICAgIGxleC5vbigiZXJyb3IiLCBmdW5jdGlvbihldikgewogICAgICBlcnJvckF0LmFwcGx5KG51bGwsIFsgZXYuY29kZSwgZXYubGluZSwgZXYuY2hhcmFjdGVyIF0uY29uY2F0KGV2LmRhdGEpKTsKICAgIH0pOwoKICAgIGxleC5vbigiZmF0YWwiLCBmdW5jdGlvbihldikgewogICAgICBxdWl0KCJFMDQxIiwgZXYpOwogICAgfSk7CgogICAgbGV4Lm9uKCJJZGVudGlmaWVyIiwgZnVuY3Rpb24oZXYpIHsKICAgICAgZW1pdHRlci5lbWl0KCJJZGVudGlmaWVyIiwgZXYpOwogICAgfSk7CgogICAgbGV4Lm9uKCJTdHJpbmciLCBmdW5jdGlvbihldikgewogICAgICBlbWl0dGVyLmVtaXQoIlN0cmluZyIsIGV2KTsKICAgIH0pOwoKICAgIGxleC5vbigiTnVtYmVyIiwgZnVuY3Rpb24oZXYpIHsKICAgICAgZW1pdHRlci5lbWl0KCJOdW1iZXIiLCBldik7CiAgICB9KTsKCiAgICAvLyBDaGVjayBvcHRpb25zCiAgICBmb3IgKHZhciBuYW1lIGluIG8pIHsKICAgICAgaWYgKF8uaGFzKG8sIG5hbWUpKSB7CiAgICAgICAgY2hlY2tPcHRpb24obmFtZSwgc3RhdGUudG9rZW5zLmN1cnIpOwogICAgICB9CiAgICB9CgogICAgdHJ5IHsKICAgICAgYXNzdW1lKCk7CgogICAgICAvLyBjb21iaW5lIHRoZSBwYXNzZWQgZ2xvYmFscyBhZnRlciB3ZSd2ZSBhc3N1bWVkIGFsbCBvdXIgb3B0aW9ucwogICAgICBjb21iaW5lKHByZWRlZmluZWQsIGcgfHwge30pOwoKICAgICAgLy9yZXNldCB2YWx1ZXMKICAgICAgcGFyc2VDb21tYS5maXJzdCA9IHRydWU7CgogICAgICBhZHZhbmNlKCk7CiAgICAgIHN3aXRjaCAoc3RhdGUudG9rZW5zLm5leHQuaWQpIHsKICAgICAgY2FzZSAieyI6CiAgICAgIGNhc2UgIlsiOgogICAgICAgIGRlc3RydWN0dXJpbmdBc3NpZ25Pckpzb25WYWx1ZSgpOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGRpcmVjdGl2ZXMoKTsKCiAgICAgICAgaWYgKHN0YXRlLmRpcmVjdGl2ZVsidXNlIHN0cmljdCJdKSB7CiAgICAgICAgICBpZiAoIXN0YXRlLmFsbG93c0dsb2JhbFVzZCgpKSB7CiAgICAgICAgICAgIHdhcm5pbmcoIlcwOTciLCBzdGF0ZS50b2tlbnMucHJldik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzdGF0ZW1lbnRzKCk7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS50b2tlbnMubmV4dC5pZCAhPT0gIihlbmQpIikgewogICAgICAgIHF1aXQoIkUwNDEiLCBzdGF0ZS50b2tlbnMuY3Vycik7CiAgICAgIH0KCiAgICAgIHN0YXRlLmZ1bmN0WyIoc2NvcGUpIl0udW5zdGFjaygpOwoKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBpZiAoZXJyICYmIGVyci5uYW1lID09PSAiSlNIaW50RXJyb3IiKSB7CiAgICAgICAgdmFyIG50ID0gc3RhdGUudG9rZW5zLm5leHQgfHwge307CiAgICAgICAgSlNISU5ULmVycm9ycy5wdXNoKHsKICAgICAgICAgIHNjb3BlICAgICA6ICIobWFpbikiLAogICAgICAgICAgcmF3ICAgICAgIDogZXJyLnJhdywKICAgICAgICAgIGNvZGUgICAgICA6IGVyci5jb2RlLAogICAgICAgICAgcmVhc29uICAgIDogZXJyLnJlYXNvbiwKICAgICAgICAgIGxpbmUgICAgICA6IGVyci5saW5lIHx8IG50LmxpbmUsCiAgICAgICAgICBjaGFyYWN0ZXIgOiBlcnIuY2hhcmFjdGVyIHx8IG50LmZyb20KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0KICAgIH0KCiAgICAvLyBMb29wIG92ZXIgdGhlIGxpc3RlZCAiaW50ZXJuYWxzIiwgYW5kIGNoZWNrIHRoZW0gYXMgd2VsbC4KICAgIGlmIChKU0hJTlQuc2NvcGUgPT09ICIobWFpbikiKSB7CiAgICAgIGxpbnRFdmFsQ29kZShKU0hJTlQuaW50ZXJuYWxzLCBvIHx8IHt9LCBnKTsKICAgIH0KCiAgICByZXR1cm4gSlNISU5ULmVycm9ycy5sZW5ndGggPT09IDA7CiAgfTsKCiAgLy8gTW9kdWxlcy4KICBpdHNlbGYuYWRkTW9kdWxlID0gZnVuY3Rpb24oZnVuYykgewogICAgZXh0cmFNb2R1bGVzLnB1c2goZnVuYyk7CiAgfTsKCiAgaXRzZWxmLmFkZE1vZHVsZShzdHlsZS5yZWdpc3Rlcik7CgogIC8vIERhdGEgc3VtbWFyeS4KICBpdHNlbGYuZGF0YSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGRhdGEgPSB7CiAgICAgIGZ1bmN0aW9uczogW10sCiAgICAgIG9wdGlvbnM6IHN0YXRlLm9wdGlvbgogICAgfTsKCiAgICB2YXIgZnUsIGYsIGksIGosIG4sIGdsb2JhbHM7CgogICAgaWYgKGl0c2VsZi5lcnJvcnMubGVuZ3RoKSB7CiAgICAgIGRhdGEuZXJyb3JzID0gaXRzZWxmLmVycm9yczsKICAgIH0KCiAgICBpZiAoc3RhdGUuanNvbk1vZGUpIHsKICAgICAgZGF0YS5qc29uID0gdHJ1ZTsKICAgIH0KCiAgICB2YXIgaW1wbGllZEdsb2JhbHMgPSBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmdldEltcGxpZWRHbG9iYWxzKCk7CiAgICBpZiAoaW1wbGllZEdsb2JhbHMubGVuZ3RoID4gMCkgewogICAgICBkYXRhLmltcGxpZWRzID0gaW1wbGllZEdsb2JhbHM7CiAgICB9CgogICAgaWYgKHVybHMubGVuZ3RoID4gMCkgewogICAgICBkYXRhLnVybHMgPSB1cmxzOwogICAgfQoKICAgIGdsb2JhbHMgPSBzdGF0ZS5mdW5jdFsiKHNjb3BlKSJdLmdldFVzZWRPckRlZmluZWRHbG9iYWxzKCk7CiAgICBpZiAoZ2xvYmFscy5sZW5ndGggPiAwKSB7CiAgICAgIGRhdGEuZ2xvYmFscyA9IGdsb2JhbHM7CiAgICB9CgogICAgZm9yIChpID0gMTsgaSA8IGZ1bmN0aW9ucy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBmID0gZnVuY3Rpb25zW2ldOwogICAgICBmdSA9IHt9OwoKICAgICAgZm9yIChqID0gMDsgaiA8IGZ1bmN0aW9uaWNpdHkubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICBmdVtmdW5jdGlvbmljaXR5W2pdXSA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGogPSAwOyBqIDwgZnVuY3Rpb25pY2l0eS5sZW5ndGg7IGogKz0gMSkgewogICAgICAgIGlmIChmdVtmdW5jdGlvbmljaXR5W2pdXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBmdVtmdW5jdGlvbmljaXR5W2pdXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1Lm5hbWUgPSBmWyIobmFtZSkiXTsKICAgICAgZnUucGFyYW0gPSBmWyIocGFyYW1zKSJdOwogICAgICBmdS5saW5lID0gZlsiKGxpbmUpIl07CiAgICAgIGZ1LmNoYXJhY3RlciA9IGZbIihjaGFyYWN0ZXIpIl07CiAgICAgIGZ1Lmxhc3QgPSBmWyIobGFzdCkiXTsKICAgICAgZnUubGFzdGNoYXJhY3RlciA9IGZbIihsYXN0Y2hhcmFjdGVyKSJdOwoKICAgICAgZnUubWV0cmljcyA9IHsKICAgICAgICBjb21wbGV4aXR5OiBmWyIobWV0cmljcykiXS5Db21wbGV4aXR5Q291bnQsCiAgICAgICAgcGFyYW1ldGVyczogZlsiKG1ldHJpY3MpIl0uYXJpdHksCiAgICAgICAgc3RhdGVtZW50czogZlsiKG1ldHJpY3MpIl0uc3RhdGVtZW50Q291bnQKICAgICAgfTsKCiAgICAgIGRhdGEuZnVuY3Rpb25zLnB1c2goZnUpOwogICAgfQoKICAgIHZhciB1bnVzZWRzID0gc3RhdGUuZnVuY3RbIihzY29wZSkiXS5nZXRVbnVzZWRzKCk7CiAgICBpZiAodW51c2Vkcy5sZW5ndGggPiAwKSB7CiAgICAgIGRhdGEudW51c2VkID0gdW51c2VkczsKICAgIH0KCiAgICBmb3IgKG4gaW4gbWVtYmVyKSB7CiAgICAgIGlmICh0eXBlb2YgbWVtYmVyW25dID09PSAibnVtYmVyIikgewogICAgICAgIGRhdGEubWVtYmVyID0gbWVtYmVyOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRhdGE7CiAgfTsKCiAgaXRzZWxmLmpzaGludCA9IGl0c2VsZjsKCiAgcmV0dXJuIGl0c2VsZjsKfSgpKTsKCi8vIE1ha2UgSlNISU5UIGEgTm9kZSBtb2R1bGUsIGlmIHBvc3NpYmxlLgppZiAodHlwZW9mIGV4cG9ydHMgPT09ICJvYmplY3QiICYmIGV4cG9ydHMpIHsKICBleHBvcnRzLkpTSElOVCA9IEpTSElOVDsKfQo=</text>
      </register>
      <register name="c" type="4">
        <text>foo</text>
      </register>
      <register name="-" type="4">
        <text>,</text>
      </register>
      <register name="/" type="4">
        <text>code</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">LyoqCiAqIEBkZXNjcmlwdGlvbgo=</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICAvLyB7aGlnaGxpZ2h0U2VsZWN0aW9uTWF0Y2hlczoge3Nob3dUb2tlbjogL1x3LywgYW5ub3RhdGVTY3JvbGxiYXI6IHRydWUsIGRlbGF5OiAxMDB9fSwK</text>
      </register>
      <register name="q" type="4">
        <text />
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICB7bGluZVdyYXBwaW5nOiBmYWxzZX0K</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICBsaW5lV3JhcHBpbmc6IGZhbHNlCg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICAgICAgY29uc29sZS5sb2cob3B0aW9ucyk7Cg==</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogQm9yZGVyUmFkaXVzLmFsbChSYWRpdXMuY2lyY3VsYXIoNS4wKSksCg==</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgICAgICAgICAgCg==</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICAgYXBrCg==</text>
      </register>
      <register name="w" type="4">
        <text />
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgICAgICAK</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICAgICAgY29udGVudFBhZGRpbmc6IEVkZ2VJbnNldHMuYWxsKDEwLjApLAo=</text>
      </register>
      <register name=":" type="4">
        <text>w</text>
      </register>
    </registers>
    <search>
      <last-search>code</last-search>
      <last-offset />
      <last-pattern>code</last-pattern>
      <last-replace>#FFFFFF</last-replace>
      <last-substitute>\$ring-palette-white-text</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>trans</entry>
        <entry>\$ring-palette-grey-text</entry>
        <entry>\$ring-palette-white-text</entry>
        <entry>firstWhere</entry>
        <entry>color</entry>
        <entry>name</entry>
        <entry>print</entry>
        <entry encoding="base64">XDxpZFw+</entry>
        <entry encoding="base64">XDxfZ2V0SXNzdWVGaWVsZENvbG9yQnlJZFw+</entry>
        <entry encoding="base64">XDxfZ2V0UHJpb3JpdHlJc3N1ZUZpZWxkQ29sb3JcPg==</entry>
        <entry encoding="base64">XDxfZ2V0Q29sb3JGcm9tUGFsZXR0ZUJ5SWRcPg==</entry>
        <entry>circle</entry>
        <entry>reca</entry>
        <entry>size</entry>
        <entry>Sized</entry>
        <entry encoding="base64">XDxib3JkZXJcPg==</entry>
        <entry>soft</entry>
        <entry>wrap</entry>
        <entry>lineWrap</entry>
        <entry>code</entry>
      </history-search>
      <history-cmd>
        <entry>77</entry>
        <entry>isModifiedAndUnsaved\(true</entry>
        <entry>%s/$ctrl.updateDraft/$ctrl.onChange/gc</entry>
        <entry>%s/$ctrl.saveDraftDelayed/saveDraftDelayed/gc</entry>
        <entry>%s/$ctrl.(isModifiedAndUnsaved)/$q/gc</entry>
        <entry>%s/$ctrl.(isModifiedAndUnsaved\)/$1/gc</entry>
        <entry>%s/$ctrl.\(isModifiedAndUnsaved\)/$1/gc</entry>
        <entry>%s/$ctrl.\(isModifiedAndUnsaved\)/\1/gc</entry>
        <entry>%s/$ctrl.\(waitWhenDraftIsSaved\)/\1/gc</entry>
        <entry>%s/isSticky/isStuck/gc</entry>
        <entry>%s/$ctrl.isStuck/Stuck/gc</entry>
        <entry>%s/$ctrl.isStuck/isStuck/gc</entry>
        <entry>s</entry>
        <entry>e</entry>
        <entry>%s/\$ctrl\.currentIndex/currentIndex/gc</entry>
        <entry>45</entry>
        <entry>%s/\$ring-palette-grey-text/#444444/gc</entry>
        <entry>%s/\$ring-palette-white-text/#FFFFFF/gc</entry>
        <entry>action AceAction</entry>
        <entry>w</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed O</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed Q</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed E</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed H</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed G</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed Y</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed X</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed BACK_SLASH</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed M</text>
      </shortcut-conflict>
    </shortcut-conflicts>
    <editor>
      <key-repeat enabled="false" />
    </editor>
  </component>
</application>